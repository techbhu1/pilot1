<html lang="en-US">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<title>6-Configuring Spanning Tree Parameters</title>
<link href="../../rhstylemapping.css" rel="stylesheet" type="text/css" />
<link href="../os8_nt___Web.css" rel="stylesheet" type="text/css" />
<link href="../../editstyle.css" rel="stylesheet" type="text/css" /><script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
p.WebHelpNavBar { text-align:right; }
-->
</style>
 <meta name="generator" content="Adobe FrameMaker v16.0" />
<script type="text/javascript" src="../../template/scripts/rh.min.js"></script>
<script type="text/javascript" src="../../template/scripts/common.min.js"></script>
<script type="text/javascript" src="../../template/scripts/topic.min.js"></script>
<script type="text/javascript" src="../../template/scripts/constants.js"></script>
<script type="text/javascript" src="../../template/scripts/utils.js"></script>
<script type="text/javascript" src="../../template/scripts/mhutils.js"></script>
<script type="text/javascript" src="../../template/scripts/mhlang.js"></script>
<script type="text/javascript" src="../../template/scripts/mhver.js"></script>
<script type="text/javascript" src="../../template/scripts/settings.js"></script>
<script type="text/javascript" src="../../template/scripts/XmlJsReader.js"></script>
<script type="text/javascript" src="../../template/scripts/loadparentdata.js"></script>
<script type="text/javascript" src="../../template/scripts/loadscreen.js"></script>
<script type="text/javascript" src="../../template/scripts/loadprojdata.js"></script>
<script type="text/javascript" src="../../template/scripts/mhtopic.js"></script>
 <link rel="stylesheet" type="text/css" href="../../template/styles/topic.min.css">
<script type="text/javascript" >
gRootRelPath = "../..";
gCommonRootRelPath = "../..";
gTopicId = "0_8";
</script>
</head>
<body dir="ltr">
<script type="text/javascript" src="../../ehlpdhtm.js"></script>
<div class="FLOW_A" dir="ltr"><p class="Chapter_Title" id="1004854">6    <a id="XREF_15243__1_Configuring_Spanning_Tree_Parameters159" name="XREF_15243__1_Configuring_Spanning_Tree_Parameters159"></a>Configuring Spanning Tree Parameters</p><p class="text" id="1108640">The <a id="index_1108639" name="index_1108639"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol" id="Spanning_Tree_Algorithm_and_Protocol" name="Spanning_Tree_Algorithm_and_Protocol"></a>Spanning Tree Algorithm and Protocol (STP) is a self&#x2D;configuring algorithm that maintains a loop&#x2D;free topology on a network. STP helps to provide data path redundancy and network scalability. The OmniSwitch STP implementation, based on the IEEE 8&#x30;2.1D standard, distributes the Spanning Tree load between the primary management module and the network interface modules. This functionality improves network robustness by providing a Spanning Tree that continues to respond to BPDUs (Bridge Protocol Data Unit) and port link up and down states in the event of a fail over to a backup management module or switch.</p><p class="text" id="1108647">The OmniSwitch implementation also incorporates the following Spanning Tree features&#x3A;</p><p class="bullet" id="1114260"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Configures a physical topology into a single Spanning Tree to ensure that there is only one data path between any two switches.</p><p class="bullet" id="1114261"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Supports fault tolerance within the network topology. The Spanning Tree is reconfigured in the event of a data path or bridge failure or when a new switch is added to the topology.</p><p class="bullet" id="1114262"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Supports two Spanning Tree operating modes&#x3A; <span class="Times_italics" style="font-style:Italic;background-color:transparent;">flat</span> (single STP instance per switch) and <span class="Times_italics" style="font-style:Italic;background-color:transparent;">per&#x2D;VLAN</span> (single STP instance per VLAN). The per&#x2D;VLAN mode can be configured to interoperate with the proprietary Per&#x2D;Vlan Spanning Tree (PVST+) feature of Cisco.</p><p class="bullet" id="1092514"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Supports three Spanning Tree Algorithms; 8&#x30;2.1D (STP), 8&#x30;2.1w (RSTP), and 8&#x30;2.1Q 2&#x30;&#x30;5 (MSTP). </p><p class="bullet" id="1024261"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Allows 8&#x30;2.1Q tagged ports and link aggregate logical ports to participate in the calculation of the STP topology.</p><p class="bullet" id="1122086"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Provides loop&#x2D;guard security to prevent network loops caused due to inconsistencies in data traffic.</p><p class="text" id="1058869">The Distributed Spanning Tree software is active on all switches by default. As a result, a loop&#x2D;free network topology is automatically calculated based on default Spanning Tree bridge, VLAN, and port parameter values. It is only necessary to configure the Spanning Tree parameters to change how the topology is calculated and maintained.</p><p class="heading1" id="1077825">In This Chapter</p><p class="text" id="1127660">This chapter provides an overview about how Spanning Tree works and how to configure Spanning Tree parameters through the Command Line Interface (CLI). CLI commands are used in the configuration examples; for more details about the syntax of commands, see the <span class="Times_italics" style="font-style:Italic;background-color:transparent;"><span data-keyref="CLI Reference Guide">OmniSwitch AOS Release 8 CLI Reference Guide</span></span>.</p><p class="text" id="1127664">Configuration procedures described in this chapter include&#x3A;</p><p class="bullet" id="1127668"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_33590__Spanning_Tree_Operating_Modes159" style="color:#0000ff;background-color:transparent;">Spanning Tree Operating Modes</a>.</p><p class="bullet" id="1127657"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_10950__Configuring_STP_VLAN_Parameters159" style="color:#0000ff;background-color:transparent;">Using Spanning Tree Configuration Commands</a>.</p><p class="bullet" id="1058905"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_80803__Configuring_STP_Port_Parameters159" style="color:#0000ff;background-color:transparent;">Configuring STP Port Parameters</a>.</p><p class="bullet" id="1071096"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_37212__RRSTP_Overview159" style="color:#0000ff;background-color:transparent;">Sample Spanning Tree Configuration</a>.</p><p class="heading1" id="1095675"><a id="index_1095595" name="index_1095595"></a><a data-indexterm="Spanning%20Tree%20Bridge%20:%20defaults" id="Spanning_Tree_Bridge___defaults" name="Spanning_Tree_Bridge___defaults"></a><a data-indexterm="defaults%20:Spanning%20Tree%20Bridge" id="defaults__Spanning_Tree_Bridge_" name="defaults__Spanning_Tree_Bridge_"></a>Spanning Tree Bridge Parameter Defaults <div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="192.00px"/><col width="208.80px"/><col width="196.20px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1095598">Parameter Description</p></th><th><p class="CellHeading" id="1095600">Command</p></th><th><p class="CellHeading" id="1095602">Default</p></th></tr></thead><tr height="39.33px"><td><p class="CellBody" id="1095604">Spanning Tree operating mode</p></td><td><p class="CellBody" id="1095609"><a href="../c_stp/c_stp.htm#XREF_43473__bridge_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mode</a>&#160;</p></td><td><p class="CellBody" id="1095611">Per&#x2D;VLAN (a separate Spanning Tree instance for each VLAN)</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1104185">PVST+ status</p></td><td><p class="CellBody" id="1119513"><a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a></p></td><td><p class="CellBody" id="1119507">Disabled</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1114358">Spanning Tree status for a VLAN instance</p></td><td><p class="CellBody" id="1114360"><a href="../c_stp/c_stp.htm#XREF_62748__spantree_vlan_admin-state" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan admin-state</a></p></td><td><p class="CellBody" id="1114362">Enabled</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1114373">Spanning Tree protocol</p></td><td><p class="CellBody" id="1114378"><a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree protocol</a></p></td><td><p class="CellBody" id="1114380">RSTP (8&#x30;2.1w) </p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1095622">BPDU switching status</p></td><td><p class="CellBody" id="1095627"><a href="../c_stp/c_stp.htm#XREF_22333__bridge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree bpdu-switching</a></p></td><td><p class="CellBody" id="1095629">Disabled</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1095631">Priority value for the Spanning Tree instance</p></td><td><p class="CellBody" id="1095636"><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a></p></td><td><p class="CellBody" id="1095638">32768</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1095640">Hello time interval between each BPDU transmission</p></td><td><p class="CellBody" id="1095645"><a href="../c_stp/c_stp.htm#XREF_97193__bridge_hello_time" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree hello-time</a></p></td><td><p class="CellBody" id="1095647">2 seconds</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1095649">Maximum aging time allowed for Spanning Tree information learned from the network</p></td><td><p class="CellBody" id="1095654"><a href="../c_stp/c_stp.htm#XREF_17450__spantree_max-age" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree max-age</a></p></td><td><p class="CellBody" id="1095656">2&#x30; seconds</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1095658">Spanning Tree port state transition time</p></td><td><p class="CellBody" id="1095663" style="text-decoration: line-through;"><a href="../c_stp/c_stp.htm#XREF_83537__spantree_forward-delay" style="font-weight:Bold;text-decoration:none;color:#0000ff;background-color:transparent;">spantree forward-delay</a></p></td><td><p class="CellBody" id="1095665">15 seconds</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1114345">Path cost mode</p></td><td><p class="CellBody" id="1114350"><a href="../c_stp/c_stp.htm#XREF_97321__bridge_path_cost_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree path-cost-mode</a></p></td><td><p class="CellBody" id="1114352">Auto (16&#x2D;bit in per&#x2D;VLAN mode and STP or RSTP flat mode, 32&#x2D;bit in MSTP flat mode)</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1095667">Automatic VLAN Containment</p></td><td><p class="CellBody" id="1095672"><a href="../c_stp/c_stp.htm#XREF_97899__bridge_auto-vlan-containment" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree auto-vlan-containment</a></p></td><td><p class="CellBody" id="1095674">Disabled</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1122109">Spanning Tree loop&#x2D;guard</p></td><td><p class="CellBody" id="1122114"><a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree loop-guard</a></p></td><td><p class="CellBody" id="1122116">Disabled</p></td></tr></table></div></p><p class="heading1" id="1095738"><a id="index_1095676" name="index_1095676"></a><a data-indexterm="Spanning%20Tree%20Port:%20defaults" id="Spanning_Tree_Port__defaults" name="Spanning_Tree_Port__defaults"></a><a data-indexterm="defaults:Spanning%20Tree%20Port" id="_defaults_Spanning_Tree_Port" name="_defaults_Spanning_Tree_Port"></a>Spanning Tree Port Parameter Defaults<div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="240.00px"/><col width="172.80px"/><col width="187.20px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1095679">Parameter Description </p></th><th><p class="CellHeading" id="1095681">Command</p></th><th><p class="CellHeading" id="1095683">Default</p></th></tr></thead><tr height="23.33px"><td><p class="CellBody" id="1113911">Status for a specific VLAN instance</p></td><td><p class="CellBody" id="1113896"><a href="../c_stp/c_stp.htm#XREF_54312__bridge_1x1_slot/port" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan</a></p></td><td><p class="CellBody" id="1113898">Enabled</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1113735">Path cost for a specific VLAN instance</p></td><td><p class="CellBody" id="1113737"><a href="../c_stp/c_stp.htm#XREF_33850__bridge_1x1_slot/port_path_cost" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan path-cost</a></p></td><td><p class="CellBody" id="1113739">&#x30;</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1095721">Port state management mode</p></td><td><p class="CellBody" id="1095726"><a href="../c_stp/c_stp.htm#XREF_38782__bridge_cist_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist mode</a></p><p class="CellBody" id="1114381"><a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree loop-guard</a></p></td><td><p class="CellBody" id="1095728">Dynamic (Spanning Tree Algorithm determines port state)</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1113712">Port priority value</p></td><td><p class="CellBody" id="1113714"><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a></p></td><td><p class="CellBody" id="1113716">7</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1113785">Port connection type for a specific VLAN instance</p></td><td><p class="CellBody" id="1113770"><a href="../c_stp/c_stp.htm#XREF_13508__bridge_1x1_slot/port_connection" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan connection</a></p></td><td><p class="CellBody" id="1113772">auto point to point</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1098929">Type of BPDU to be used on a port when per vlan PVST+ mode is enabled</p></td><td><p class="CellBody" id="1111498" style="color:#ff00ff;"><span style="color:#000000;"><a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a></span></p></td><td><p class="CellBody" id="1098933">auto (<span class="Times_italics" style="font-style:normal;background-color:transparent;">IEEE BPDUs are used until a PVST+ BPDU is detected)</span></p></td></tr></table></div></p><p class="heading1" id="1092770"><a id="index_1094782" name="index_1094782"></a><a data-indexterm="Multiple%20Spanning%20Tree:defaults" id="Multiple_Spanning_Tree_defaults" name="Multiple_Spanning_Tree_defaults"></a><a data-indexterm="defaults:Multiple%20Spanning%20Tree" id="_defaults_Multiple_Spanning_Tree" name="_defaults_Multiple_Spanning_Tree"></a>Multiple Spanning Tree (MST) Region Defaults</p><p>Although the following parameter values are specific to MSTP, they are configurable regardless of which mode (flat or per&#x2D;VLAN) or protocol is active on the switch. <div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="240.00px"/><col width="172.80px"/><col width="187.20px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1078015">Parameter Description</p></th><th><p class="CellHeading" id="1078017">Command</p></th><th><p class="CellHeading" id="1078019">Default</p></th></tr></thead><tr height="23.33px"><td><p class="CellBody" id="1078021">The MST region name</p></td><td><p class="CellBody" id="1078026"><a href="../c_stp/c_stp.htm#XREF_97745__bridge_mst_region_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region name</a></p></td><td><p class="CellBody" id="1078028">blank</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1078030">The revision level for the MST region</p></td><td><p class="CellBody" id="1078034"><a href="../c_stp/c_stp.htm#XREF_44131__bridge_mst_region_revision_level" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region revision-level</a></p></td><td><p class="CellBody" id="1078037">&#x30;</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1078039">The maximum number of hops authorized for the region </p></td><td><p class="CellBody" id="1111806"><a href="../c_stp/c_stp.htm#XREF_62399__bridge_mst_region_max_hops" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region max-hops</a></p></td><td><p class="CellBody" id="1078046">2&#x30;</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1078048">The number of Multiple Spanning Tree Instances (MSTI)</p></td><td><p class="CellBody" id="1078053"><a href="../c_stp/c_stp.htm#XREF_25471__bridge_msti" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti</a></p></td><td><p class="CellBody" id="1078055">&#x30; (flat mode instance)</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1078057">The VLAN to MSTI mapping</p></td><td><p class="CellBody" id="1078062"><a href="../c_stp/c_stp.htm#XREF_38500__bridge_msti_vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti vlan</a></p></td><td><p class="CellBody" id="1078064">All VLANs are mapped to the Common Internal Spanning Tree (CIST) instance</p></td></tr></table></div></p><p class="heading1" id="1059056"><a id="index_1094783" name="index_1094783"></a><a data-indexterm="rrstp:defaults" id="RRSTP_defaults" name="RRSTP_defaults"></a><a data-indexterm="defaults:RRSTP" id="_defaults_RRSTP" name="_defaults_RRSTP"></a>Spanning Tree Overview</p><p class="text" id="1078073">The OmniSwitch supports the use of the 8&#x30;2.1D Spanning Tree Algorithm and Protocol (STP), the <a id="index_1078072" name="index_1078072"></a><a data-indexterm="RSTP" id="RSTP" name="RSTP"></a><a data-indexterm="Fast%20Spanning%20Tree" id="Fast_Spanning_Tree" name="Fast_Spanning_Tree"></a><a data-indexterm="%3C$nopage%3ERapid%20Spanning%20Tree%20Algorithm%20and%20Protocol:%3Csee%20also%3Esee%3Cdefault%20para%20font%3E%20RSTP" id="%3C$nopage%3ERapid_Spanning_Tree_Algorithm_and_Protocol_%3Csee_also%3Esee%3Cdefault_para_font%3E_RSTP" name="%3C$nopage%3ERapid_Spanning_Tree_Algorithm_and_Protocol_%3Csee_also%3Esee%3Cdefault_para_font%3E_RSTP"></a>8&#x30;2.1w Rapid Spanning Tree Algorithm and Protocol (RSTP), and the 8&#x30;2.1Q 2&#x30;&#x30;5 Multiple Spanning Tree Protocol (MSTP). </p><p class="text" id="1078074">RSTP expedites topology changes by allowing blocked ports to transition directly into a forwarding state, bypassing listening and learning states. This provides rapid reconfiguration of the Spanning Tree in the event of a network path or device failure. </p><p class="text" id="1078075">The 8&#x30;2.1w standard is an amendment to the 8&#x30;2.1D document, thus RSTP is based on STP. Regardless of which one of these two protocols a switch or VLAN is running, it can successfully interoperate with other switches or VLANs. </p><p class="text" id="1095341">8&#x30;2.1Q 2&#x30;&#x30;5 is a new version of MSTP that combines the 8&#x30;2.1D 2&#x30;&#x30;4 and 8&#x30;2.1S protocols. This implementation of 8&#x30;2.1Q 2&#x30;&#x30;5 also includes improvements to edge port configuration and provides administrative control to restrict port role assignment and the propagation of topology change information through bridge ports.</p><p class="text" id="1078076">MSTP is an enhancement to the 8&#x30;2.1Q Common Spanning Tree (CST), which is provided when a switch is running in the flat Spanning Tree operating mode. The flat mode applies a single spanning tree instance across all VLAN port connections on a switch. MSTP allows the configuration of Multiple Spanning Tree Instances (MSTIs) in addition to the CST instance. Each MSTI is mapped to a set of VLANs. As a result, the flat mode can now support the forwarding of VLAN traffic over separate data paths.</p><p class="text" id="1111283">This section provides a Spanning Tree overview based on RSTP operation and terminology. Although MSTP is based on RSTP, see <a  href="#XREF_34979__MST_General_Overview159" style="color:#0000ff;background-color:transparent;">MST General Overview</a> for specific information about configuring MSTP. </p><p class="heading2" id="1111290">How the Spanning Tree Topology is Calculated</p><p class="text" id="1078094">The <span class="Times_italics" style="font-style:Italic;background-color:transparent;">tree</span> consists of links and bridges that provide a single data path that spans the bridged network. At the base of the tree is a <a id="index_1078095" name="index_1078095"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:root%20bridge" id="Spanning_Tree_Algorithm_and_Protocol_root_bridge" name="Spanning_Tree_Algorithm_and_Protocol_root_bridge"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:topology" id="Spanning_Tree_Algorithm_and_Protocol_topology" name="Spanning_Tree_Algorithm_and_Protocol_topology"></a><span class="Times_italics" style="font-style:Italic;background-color:transparent;">root bridge</span>. One bridge is elected by all the bridges participating in the network to serve as the root of the tree. After the root bridge is identified, STP calculates the best path that leads from each bridge back to the root and blocks any connections that would cause a network loop.</p><p class="text" id="1078097">To determine the best path to the root, STP uses the <a id="index_1078096" name="index_1078096"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20path%20cost" id="Spanning_Tree_Algorithm_and_Protocol_port_path_cost" name="Spanning_Tree_Algorithm_and_Protocol_port_path_cost"></a><span class="Times_italics" style="font-style:Italic;background-color:transparent;">path cost</span> value, which is associated with every port on each bridge in the network. This value is a configurable weighted measure that indicates the contribution of the port connection to the entire path leading from the bridge to the root. </p><p class="text" id="1078099">In addition, a <a id="index_1078098" name="index_1078098"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:root%20path%20cost" id="Spanning_Tree_Algorithm_and_Protocol_root_path_cost" name="Spanning_Tree_Algorithm_and_Protocol_root_path_cost"></a><span class="Times_italics" style="font-style:Italic;background-color:transparent;">root path cost</span> value is associated with every bridge. This value is the sum of the path costs for the port that receives frames on the best path to the root (this value is zero for the root bridge). The bridge with the lowest root path cost becomes the <a id="index_1078100" name="index_1078100"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:designated%20bridge" id="Spanning_Tree_Algorithm_and_Protocol_designated_bridge" name="Spanning_Tree_Algorithm_and_Protocol_designated_bridge"></a><span class="Times_italics" style="font-style:Italic;background-color:transparent;">designated bridge</span> for the LAN, as it provides the shortest path to the root for all bridges connected to the LAN.</p><p class="text" id="1118757">During the process of calculating the Spanning Tree topology, each port on every bridge is assigned a <a id="index_1118756" name="index_1118756"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20roles" id="Spanning_Tree_Algorithm_and_Protocol_port_roles" name="Spanning_Tree_Algorithm_and_Protocol_port_roles"></a><span class="Times_italics" style="font-style:Italic;background-color:transparent;">port role</span> based on how the port and&#47;or its bridge participates in the active Spanning Tree topology.</p><p>The following table provides a list of port role types and the port and&#47;or bridge properties that the Spanning Tree Algorithm examines to determine which role to assign to the port.<div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="144.00px"/><col width="456.00px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1118761">Role</p></th><th><p class="CellHeading" id="1118763">Port&#47;Bridge Properties</p></th></tr></thead><tr height="39.33px"><td><p class="CellBody" id="1118765">Root Port</p></td><td><p class="CellBody" id="1118767">Port connection that provides the shortest path (lowest path cost value) to the root. The root bridge does not have a root port.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1118769">Designated Port</p></td><td><p class="CellBody" id="1118771">The designated bridge provides the LAN with the shortest path to the root. The designated port connects the LAN to this bridge.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1118773">Backup Port</p></td><td><p class="CellBody" id="1118775">Any operational port on the designated bridge that is not a root or designated port. Provides a backup connection for the designated port. A backup port can only exist when there are redundant designated port connections to the LAN.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1118777">Alternate Port</p></td><td><p class="CellBody" id="1118779">Any operational port that is not the root port for its bridge and its bridge is not the designated bridge for the LAN. An alternate port offers an alternate path to the root bridge if the root port on its own bridge goes down.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1118781">Disabled Port</p></td><td><p class="CellBody" id="1118783">Port is not operational. If an active connection does come up on the port, it is assigned an appropriate role.</p></td></tr></table></div><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1119530"><span class="Bold">Note.  </span>The distinction between a backup port and an alternate port was introduced with the IEEE 8&#x30;2.1w standard to help define rapid transition of an alternate port to a root port.</p></td></tr></table></div></p><p class="text" id="1092064">The role a port plays or can potentially play in the active Spanning Tree topology determines the <a id="index_1091998" name="index_1091998"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20states" id="Spanning_Tree_Algorithm_and_Protocol_port_states" name="Spanning_Tree_Algorithm_and_Protocol_port_states"></a>port operating state; <span class="Times_italics" style="font-style:Italic;background-color:transparent;">discarding, learning, </span>or <span class="Times_italics" style="font-style:Italic;background-color:transparent;">forwarding</span>. The <span class="Times_italics" style="font-style:Italic;background-color:transparent;">port state</span> is also configurable and it is possible to enable or disable the administrative status of a port and&#47;or specify a forwarding or blocking state that is only changed through user intervention.</p><p>The Spanning Tree Algorithm only includes ports in its calculations that are operational (link is up) and have an enabled administrative status. The following table compares and defines 8&#x30;2.1D and 8&#x30;2.1w port states and their associated port roles&#x3A;<div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="110.40px"/><col width="120.00px"/><col width="259.20px"/><col width="110.40px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1092004">STP Port State</p></th><th><p class="CellHeading" id="1092006">RSTP Port State</p></th><th><p class="CellHeading" id="1092008">Port State Definition</p></th><th><p class="CellHeading" id="1092010">Port Role</p></th></tr></thead><tr height="39.33px"><td><p class="CellBody" id="1092012">Disabled</p></td><td><p class="CellBody" id="1092014">Discarding</p></td><td><p class="CellBody" id="1092016">Port is down or administratively disabled and is not included in the topology.</p></td><td><p class="CellBody" id="1092018">Disabled</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1092020">Blocking</p></td><td><p class="CellBody" id="1092022">Discarding</p></td><td><p class="CellBody" id="1092024">Frames are dropped, nothing is learned or forwarded on the port. Port is temporarily excluded from topology.</p></td><td><p class="CellBody" id="1092026">Alternate, Backup</p></td></tr><tr height="71.33px"><td><p class="CellBody" id="1092028">Learning</p></td><td><p class="CellBody" id="1092030">Learning</p></td><td><p class="CellBody" id="1092032">Port is learning MAC addresses that are seen on the port and adding them to the bridge forwarding table, but not transmitting any data. Port is included in the active topology.</p></td><td><p class="CellBody" id="1092034">Root, Designated</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1092036">Forwarding</p></td><td><p class="CellBody" id="1092038">Forwarding</p></td><td><p class="CellBody" id="1092040">Port is transmitting and receiving data and is included in the active topology.</p></td><td><p class="CellBody" id="1092042">Root, Designated</p></td></tr></table></div></p><p class="text" id="1091863">Once the Spanning Tree is calculated, there is only one root bridge, one designated bridge for each LAN, and one root port on each bridge (except for the root bridge). Data travels back and forth between bridges over forwarding port connections that form the best, non&#x2D;redundant path to the root. The active topology ensures that network loops do not exist.</p><p class="heading3" id="1091872">Bridge Protocol Data Units (BPDU)</p><p class="text" id="1078187">Switches send layer 2 frames, referred to as Configuration <a id="index_1078186" name="index_1078186"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Bridge%20Protocol%20Data%20Units" id="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units" name="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units"></a><a data-indexterm="Bridge%20Protocol%20Data%20Units:contents" id="Bridge_Protocol_Data_Units_contents" name="Bridge_Protocol_Data_Units_contents"></a><a data-indexterm="%3C$nopage%3EBPDU:%3Csee%20also%3Esee%3Cdefault%20para%20font%3E%20Bridge%20Protocol%20Data%20Units" id="%3C$nopage%3EBPDU_%3Csee_also%3Esee%3Cdefault_para_font%3E_Bridge_Protocol_Data_Units" name="%3C$nopage%3EBPDU_%3Csee_also%3Esee%3Cdefault_para_font%3E_Bridge_Protocol_Data_Units"></a>Bridge Protocol Data Units (BPDU), to relay information to other switches. The information in these BPDU is used to calculate and reconfigure the Spanning Tree topology. A Configuration BPDU contains the following information that pertains to the bridge transmitting the BPDU&#x3A;<div align="left"><table class="Cmds_Overview" style="max-width: 100% ;height: auto;"><col width="100.80px"/><col width="499.20px"/><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1078190">Root ID</p></td><td><p class="CellBody" id="1078192">The Bridge ID for the bridge that this bridge believes is the root.</p></td></tr><tr height="86.00px"><td><p class="CellBody_cli_cmd" id="1078194">Root Path Cost</p></td><td><p class="CellBody" id="1078196">The sum of the Path Costs that lead from the root bridge to this bridge port.</p><p class="CellBody" id="1119561"><br/></p><p class="CellBody" id="1119563">The Path Cost is a configurable parameter value. The IEEE 8&#x30;2.1D standard specifies a default value that is based on port speed. See <a  href="#XREF_44531__Configuring_Port_Path_Cost159" style="color:#0000ff;background-color:transparent;">Configuring Port Path Cost</a> for more information.</p></td></tr><tr height="134.00px"><td><p class="CellBody_cli_cmd" id="1078202"><a id="index_1078201" name="index_1078201"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:bridge%20ID" id="Spanning_Tree_Algorithm_and_Protocol_bridge_ID" name="Spanning_Tree_Algorithm_and_Protocol_bridge_ID"></a>Bridge ID</p></td><td><p class="CellBody" id="1078204">An eight&#x2D;byte hex value that identifies this bridge within the Spanning Tree. The first two bytes contain a configurable priority value and the remaining six bytes contain a bridge MAC address. See <a  href="#XREF_52388__Configuring_VLAN_Bridge_Priority159" style="color:#0000ff;background-color:transparent;">Configuring the Bridge Priority</a> for more information.</p><p class="CellBody" id="1119566"><br/></p><p class="CellBody" id="1119568">Each switch chassis is assigned a dedicated base MAC address. This is the MAC address that is combined with the priority value to provide a unique Bridge ID for the switch. For more information about the base MAC address, see the appropriate Hardware Users Guide for the switch.</p></td></tr><tr height="54.00px"><td><p class="CellBody_cli_cmd" id="1078210"><a id="index_1078209" name="index_1078209"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Port%20ID" id="Spanning_Tree_Algorithm_and_Protocol_Port_ID" name="Spanning_Tree_Algorithm_and_Protocol_Port_ID"></a>Port ID</p></td><td><p class="CellBody" id="1078212">A 16&#x2D;bit hex value that identifies the bridge port that transmitted this BPDU. The first 4 bits contain a configurable priority value and the remaining 12 bits contain the physical switch port number. See <a  href="#XREF_11777__Configuring_Port_Priority159" style="color:#0000ff;background-color:transparent;">Configuring Port Priority</a> for more information.</p></td></tr></table></div></p><p class="text" id="1078217">The sending and receiving of Configuration BPDU between switches participating in the bridged network constitute the root bridge election; the best path to the root is determined and then advertised to the rest of the network. BPDU provide enough information for the STP software running on each switch to determine the following&#x3A;</p><p class="bullet" id="1078218"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Which bridge serves as the root bridge.</p><p class="bullet" id="1078219"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The shortest path between each bridge and the root bridge.</p><p class="bullet" id="1078220"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Which bridge serves as the designated bridge for the LAN.</p><p class="bullet" id="1078221"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Which port on each bridge serves as the root port.</p><p class="bullet" id="1078222"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The port state (forwarding or discarding) for each bridge port based on the role the port plays in the active Spanning Tree topology.</p><p class="text" id="1078223">The following events trigger the transmitting and&#47;or processing of BPDU in order to discover and maintain the Spanning Tree topology&#x3A;</p><p class="bullet" id="1118787"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When a bridge first comes up, it assumes it is the root and starts transmitting Configuration BPDU on all its active ports advertising its own bridge ID as the root bridge ID.</p><p class="bullet" id="1118788"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When a bridge receives BPDU on its root port that contains more attractive information (higher priority parameters and&#47;or lower path costs), it forwards this information on to other LANs to which it is connected for consideration.</p><p class="bullet" id="1078226"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When a bridge receives BPDU on its designated port that contains information that is less attractive (lower priority values and&#47;or higher path costs), it forwards its own information to other LANs to which it is connected for consideration.</p><p class="text" id="1078227">STP evaluates BPDU parameter values to select the best BPDU based on the following order of precedence&#x3A;</p><p class="step_first" id="1078228"><span class="Futura_Bold">1&#160;&#160;&#160; </span>The lowest root bridge ID (lowest priority value, then lowest MAC address).</p><p class="step_next" id="1078229"><span class="Futura_Bold">2&#160;&#160;&#160; </span>The best root path cost.</p><p class="step_next" id="1078230"><span class="Futura_Bold">3&#160;&#160;&#160; </span>If root path costs are equal, the bridge ID of the bridge sending the BPDU.</p><p class="step_next" id="1078231"><span class="Futura_Bold">4&#160;&#160;&#160; </span>If the previous three values tie, then the port ID (lowest priority value, then lowest port number).</p><p class="heading3" id="1096052">Topology Change Notification</p><p class="text" id="1125441">When a topology change occurs, such as when a link goes down or a switch is added to the network, the affected bridge sends a <a id="index_1125442" name="index_1125442"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Topology%20Change%20Notification" id="Spanning_Tree_Algorithm_and_Protocol_Topology_Change_Notification" name="Spanning_Tree_Algorithm_and_Protocol_Topology_Change_Notification"></a><a data-indexterm="Topology%20Change%20Notification%20BPDU" id="Topology_Change_Notification_BPDU" name="Topology_Change_Notification_BPDU"></a><a data-indexterm="%3C$nopage%3ETCN%20BPDU:%3Csee%20also%3Esee%3Cdefault%20para%20font%3E%20Topology%20Change%20Notification%20BPDU" id="%3C$nopage%3ETCN_BPDU_%3Csee_also%3Esee%3Cdefault_para_font%3E_Topology_Change_Notification_BPDU" name="%3C$nopage%3ETCN_BPDU_%3Csee_also%3Esee%3Cdefault_para_font%3E_Topology_Change_Notification_BPDU"></a>Topology Change Notification (TCN) BPDU to the designated bridge for its LAN. The designated bridge then forwards the TCN to the root bridge. The root then sends out a Configuration BPDU and sets a Topology Change (TC) flag within the BPDU to notify other bridges that there is a change in the configuration information. Once this change is propagated throughout the Spanning Tree network, the root stops sending BPDU with the TC flag set and the Spanning Tree returns to an active, stable topology.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1125445"><span class="Bold">Note.  </span>You can restrict the propagation of TCNs on a port. See <a  href="#XREF_96134__Restricting_TCN_Propagation159" style="font-kerning:none;color:#0000ff;background-color:transparent;">Restricting TCN Propagation</a> for more information.</p></td></tr></table></div></p><p class="heading4" id="1125449">Detecting the Source of Topology Changes</p><p class="text" id="1125450">The following information and logging mechanisms are available on each switch to help identify the source of topology changes within an active network&#x3A;</p><p class="bullet" id="1127142"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The port on which the last TCN was received on the local switch. The &#x201c;Topology Change Port&#x201d; field of the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show spantree vlan</span>, <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show spantree cist</span>, and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show spantree msti</span> commands displays the switch port on which the last TCN was received. This information can be used to track down the switch that triggered the topology change in an active RSTP or MSTP topology (not supported for STP topologies).</p><p class="bullet" id="1126847"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Switch logging entries to identify root port and root bridge changes for all Spanning Tree protocols (STP, RSTP, and MSTP). For example&#x3A;</p><p class="example1" id="1126848">2&#x30;14 May 19 15&#x3A;26&#x3A;44 U28E_7_12_7 swlogd&#x3A; stpCmm _TRPt info(5) TRAP&#x3A;newRoot stp&#x3D;&#x30;</p><p class="example2" id="1126849">2&#x30;14 May 19 15&#x3A;39&#x3A;54 U28E_7_12_7 swlogd&#x3A; stpCmm _TRPt info(5) TRAP&#x3A;newRootPort stp&#x3D;&#x30; port&#x3D;1&#x30;1&#x30;&#x30;5</p><p class="indented1" id="1127211">For more information about the switch logging utility, see <a href="../n_slog/n_slog.htm#XREF_56315__1_Using_Switch_Logging266" style="color:#0000ff;background-color:transparent;">Chapter&#160;41&#44; “Using Switch Logging.”</a></p><p class="bullet" id="1125642"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Topology change storm detection to identify excessive topology changes for all Spanning Tree protocols (STP, RSTP, and MSTP). The switch uses internal calculations based on the number of topology changes within a specific period of time to determine if the number of topology changes exceeds a specific threshold. When this threshold value is reached, switch logging entries are triggered as a warning of potential instability within the network. For example&#x3A;</p><p class="example1" id="1126746">For Flat + MSTP CIST instance&#x3A;</p><p class="example2" id="1126770">2&#x30;14 May 19 15&#x3A;26&#x3A;44 U28E_7_12_7 swlogd&#x3A; stpCmm _STPt warn(4) TCN Storm detected on port 1&#47;1&#47;1 for Cist</p><p class="example2" id="1126775"><br/></p><p class="example2" id="1126777">For Flat + MSTP MSTI instance</p><p class="example2" id="1126782">2&#x30;14 May 19 15&#x3A;26&#x3A;44 U28E_7_12_7 swlogd&#x3A; stpCmm _STPt warn(4) TCN Storm detected on port &#x30;&#47;1&#x30; for Msti 1&#x30;&#x30;1</p><p class="example2" id="1126787"><br/></p><p class="example2" id="1126789">For Flat + RSTP instance&#x3A;</p><p class="example2" id="1126804">2&#x30;14 May 19 15&#x3A;26&#x3A;44 U28E_7_12_7 swlogd&#x3A; stpCmm _STPt warn(4) TCN Storm detected on port 1&#47;1&#47;1</p><p class="example2" id="1126809"><br/></p><p class="example2" id="1126811">For Per VLAN + RSTP instance</p><p class="example2" id="1126825">2&#x30;14 May 19 15&#x3A;26&#x3A;44 U28E_7_12_7 swlogd&#x3A; stpCmm _STPt warn(4) TCN Storm detected on port 1&#47;1&#47;1 for VLAN 1&#x30;&#x30;1</p><p class="indented1" id="1127429">For more information about the switch logging utility, see <a href="../n_slog/n_slog.htm#XREF_56315__1_Using_Switch_Logging266" style="color:#0000ff;background-color:transparent;">Chapter&#160;41&#44; “Using Switch Logging.”</a></p><p class="heading3" id="1122128">Loop&#x2D;guard on OmniSwitch</p><p class="text" id="1122129">STP relies on continuous reception or transmission of BPDUs based on the port role. The designated port or primary port transmits BPDUs, and the non&#x2D;designated ports receive BPDUs. When one of the non&#x2D;designated ports in a spanning tree network stop receiving BPDUs, then the STP conceives that the network is loop free. However, when a non&#x2D;designated (<span style="font-weight:Bold;">Alternate</span>, <span style="font-weight:Bold;">Root</span>, or <span style="font-weight:Bold;">Backup</span>) port becomes designated and moves to a forwarding state, a loop is created in the network. </p><p class="text" id="1122130">With Loop Guard, if a switch stops receiving BPDUs on a non&#x2D;designated port, the switch places the port into the STP loop&#x2D;inconsistent blocking state thus preventing the occurrence of loop in the network.</p><p class="text" id="1122131">Loop&#x2D;guard can be configured on individual ports on per&#x2D;port or per&#x2D;VLAN basis. A port can have both roles&#x3A;</p><p class="bullet" id="1122132"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Designated </p><p class="bullet" id="1122133"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Non&#x2D;designated for mutually exclusive set of VLANs or MSTP&#x2D;instances (in MSTP mode) </p><p class="text" id="1122134">If loop&#x2D;guard is enabled on the port, it does not affect the forward or blocking state for a designated port. In case of BPDU timeout, if a loop&#x2D;guard enabled port fails to receive three consecutive BPDUs, STP converts the port explicitly to a blocked port.</p><p class="text" id="1122135">When loop&#x2D;guard is enabled, if a switch stops receiving BPDUs on a non&#x2D;designated port, the switch places the port into the STP loop&#x2D;inconsistent blocking state.</p><p class="text" id="1122136">By default, loop&#x2D;guard is disabled on all the switch ports. User can configure loop&#x2D;guard on any port irrespective of its STP state or role. However, the feature functions only on non&#x2D;designated (Alternate, Root, or Backup) STP ports.</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="146.00px"><td><p class="CellBody_note_text" id="1123399"><span class="Bold">Notes&#x3A;  </span><br/></p><p class="CellBody_note_bullet" id="1123414"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>In the <span style="font-weight:Bold;">flat </span>mode, as there is a single STP instance on all the VLANs, the loop&#x2D;guard state of the ports is same across all the VLANs on the switch.</p><p class="CellBody_note_bullet" id="1123432"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>In <span style="font-weight:Bold;">MSTP</span> mode, there is a single STP instance for each MSTI instance. In this case, loop&#x2D;guard state of port is same across all the VLANs of a given MSTP instance. Hence if a loop&#x2D;guard error occurs on any single port, it affects all the other ports related to the MSTI. </p><p class="CellBody_note_bullet" id="1123450"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>In <span style="font-weight:Bold;">1X1</span> mode, there is a single STP instance assigned for each VLAN. Hence if a loop&#x2D;guard error occurs on any single VLAN, it does not affect the other VLANs. </p></td></tr></table></div></p><p class="heading3" id="1096065">Topology <a id="index_1096064" name="index_1096064"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:application%20examples" id="Spanning_Tree_Algorithm_and_Protocol_application_examples" name="Spanning_Tree_Algorithm_and_Protocol_application_examples"></a><a data-indexterm="application%20examples:Spanning%20Tree%20Algorithm%20and%20Protocol" id="application_examples_Spanning_Tree_Algorithm_and_Protocol" name="application_examples_Spanning_Tree_Algorithm_and_Protocol"></a>Examples</p><p class="text" id="1092438">The following diagram shows an example of a physical network topology that incorporates data path redundancy to ensure fault tolerance. These redundant paths, however, create loops in the network configuration. If a device connected to Switch A sends broadcast packets, Switch A floods the packets out all of its active ports. The switches connected to Switch A in turn floods the broadcast packets out their active ports, and Switch A eventually receives the same packets back and the cycle starts over again. This causes severe congestion on the network, often referred to as a <span class="Times_italics" style="font-style:Italic;background-color:transparent;">broadcast storm</span>.<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_32.svg" height="293.235881" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="430.183085"></object></p><p class="Figure_Title_NumOne" id="1092493">Figure 6&#x2D;1 &#x3A;  Physical Topology Example</p><p class="text" id="1053595">The Spanning Tree Algorithm prevents network loops by ensuring that there is always only one active link between any two switches. This is done by transitioning one of the redundant links into a blocking state, leaving only one link actively forwarding traffic. If the active link goes down, then the Spanning Tree will transition one of the blocked links to the forwarding state to take over for the downed link. If a new switch is added to the network, the Spanning Tree topology is automatically recalculated to include the monitoring of links to the new switch. </p><p class="text" id="1056888">The following diagram shows the logical connectivity of the same physical topology as determined by the Spanning Tree Algorithm&#x3A;<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_37.svg" height="416.236308" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="538.016846"></object></p><p class="FigureTitle" id="1057649">Figure 6&#x2D;2 &#x3A;  Active Spanning Tree <a id="index_1075775" name="index_1075775"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:topology" id="Spanning_Tree_Algorithm_and_Protocol_topology" name="Spanning_Tree_Algorithm_and_Protocol_topology"></a>Topology Example</p><p class="text" id="1057650">In the above active Spanning Tree topology example, the following configuration decisions were made as a result of calculations performed by the Spanning Tree Algorithm&#x3A;</p><p class="bullet" id="1057651"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Switch D is the root bridge because its bridge ID has a priority value of 1&#x30; (the lower the priority value, the higher the priority the bridge has in the Spanning Tree). If all four switches had the same priority, then the switch with the lowest MAC address in its bridge ID would become the root.</p><p class="bullet" id="1056937"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Switch A is the designated bridge for Switch B, because it provides the best path for Switch B to the root bridge.</p><p class="bullet" id="1056938"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port 2&#47;9 on Switch A is a designated port, because it connects the LAN from Switch B to Switch A.</p><p class="bullet" id="1057475"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>All ports on Switch D are designated ports, because Switch D is the root and each port connects to a LAN.</p><p class="bullet" id="1056939"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Ports 2&#47;1&#x30;, 3&#47;1, and 3&#47;8 are the root ports for Switches A, B, and C, respectively, because they offer the shortest path towards the root bridge.</p><p class="bullet" id="1057000"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The port 3&#47;9 connection on Switch C to port 2&#47;2 on Switch D is in a discarding (blocking) state, as the connection these ports provides is redundant (backup) and has a higher path cost value than the 2&#47;3 to 3&#47;8 connection between the same two switches. As a result, a network loop is avoided.</p><p class="bullet" id="1070598"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The port 3&#47;2 connection on Switch B to port 3&#47;1&#x30; on Switch C is also in a discarding (blocking) state, as the connection these ports provides has a higher path cost to root Switch D than the path between Switch B and Switch A. As a result, a network loop is avoided.</p><p class="heading1" id="1114402"><a id="XREF_34979__MST_General_Overview159" name="XREF_34979__MST_General_Overview159"></a><a id="index_1114401" name="index_1114401"></a><a data-indexterm="MST" id="MST" name="MST"></a>MST General Overview</p><p class="text" id="1114403">The Multiple Spanning Tree (MST) feature allows for the mapping of one or more VLANs to a single Spanning Tree instance, referred to as a Multiple Spanning Tree Instance (MSTI), when the switch is running in the flat Spanning Tree mode. MST uses the Multiple Spanning Tree Algorithm and Protocol (MSTP) to define the Spanning Tree path for each MSTI. In addition, MSTP provides the ability to group switches into MST Regions. An MST Region appears as a single, flat Spanning Tree instance to switches outside the region.</p><p class="text" id="1114404">This section provides an overview of the MST feature that includes the following topics&#x3A;</p><p class="bullet" id="1114408"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_19680__How_MSTP_Works159" style="color:#0000ff;background-color:transparent;">How MSTP Works</a>.</p><p class="bullet" id="1114412"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_95488__Comparing_MSTP_with_STP_and_RSTP159" style="color:#0000ff;background-color:transparent;">Comparing MSTP with STP and RSTP</a>.</p><p class="bullet" id="1114416"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_27417__What_is_a_Multiple_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Instance (MSTI)</a>.</p><p class="bullet" id="1114420"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_40612__What_is_a_Multiple_Spanning_Tree_Region159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Region</a>.</p><p class="bullet" id="1114424"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_83721__What_is_the_Common_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is the Internal Spanning Tree (IST) Instance</a>.</p><p class="bullet" id="1115814"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_70483__What_is_the_Common_and_Internal_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is the Common and Internal Spanning Tree Instance</a>.</p><p class="bullet" id="1115815"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><a  href="#XREF_82370__MST_Configuration_Overview159" style="color:#0000ff;background-color:transparent;">MST Configuration Overview</a>.</p><p class="heading2" id="1115818"><a id="XREF_19680__How_MSTP_Works159" name="XREF_19680__How_MSTP_Works159">How </a><a id="index_1115817" name="index_1115817"></a><a data-indexterm="mst:MSTP" id="MST_MSTP" name="MST_MSTP"></a>MSTP Works</p><p class="text" id="1114432">MSTP,<span style="color:#ff00ff;">&#160;</span>as defined in the IEEE 8&#x30;2.1Q 2&#x30;&#x30;5 standard, is an enhancement to the IEEE 8&#x30;2.1Q Common Spanning Tree (CST). The CST is a single spanning tree that uses 8&#x30;2.1D (STP) or 8&#x30;2.1w (RSTP) to provide a loop&#x2D;free network topology. </p><p class="text" id="1114436">The OmniSwitch flat spanning tree mode applies a single CST instance on a per switch basis. The per&#x2D;VLAN mode is an OmniSwitch proprietary implementation that applies a single spanning tree instance on a per VLAN basis. MSTP is only supported in the flat mode and allows for the configuration of additional Spanning Tree instances instead of just the one CST.</p><p>On an MSTP flat mode OmniSwitch, the CST is represented by the Common and Internal Spanning Tree (CIST) instance &#x30; and exists on all switches. Up to 17 instances, including the CIST, are supported. Each additional instance created is referred to as a Multiple Spanning Tree Instance (MSTI). An MSTI represents a configurable association between a single Spanning Tree instance and a set of VLANs. <div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="86.00px"><td><p class="CellBody_note_text" id="1119608"><span class="Bold">Note.  </span>Although MSTP provides the ability to define MSTIs while running in the flat mode, port state and role computations are automatically calculated by the CST algorithm across all MSTIs. However, it is possible to configure the priority and&#47;or path cost of a port for a particular MSTI so that a port remains in a forwarding state for an MSTI instance, even if it is blocked as a result of automatic CST computations for other instances. </p></td></tr></table></div></p><p class="text" id="1114446">The following diagrams help to further explain how MSTP works by comparing how port states are determined on per&#x2D;VLAN STP&#47;RSTP mode, flat mode STP&#47;RSTP, and flat mode MSTP switches. </p><p class="text" id="1114476"><object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_42.svg" height="154.663676" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="357.569275"></object></p><p class="FigureTitle" id="1114477">Figure 6&#x2D;3 &#x3A;  Per&#x2D;VLAN Mode STP&#47;RSTP</p><p class="text" id="1114478">In the above per&#x2D;VLAN mode example&#x3A;</p><p class="bullet" id="1114479"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Both switches are running in the per&#x2D;VLAN mode (one Spanning Tree instance per VLAN).</p><p class="bullet" id="1114480"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLAN 1&#x30;&#x30; and VLAN 2&#x30;&#x30; are each associated with their own Spanning Tree instance.</p><p><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The connection between 3&#47;1 and 2&#47;1 is left in a forwarding state because it is part of the VLAN 1&#x30;&#x30; Spanning Tree instance and is the only connection for that instance. <div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1119631"><span class="Bold">Note.  </span>If additional switches containing a VLAN 1&#x30;&#x30; are connected to the switches in this diagram, then the 3&#47;1 to 2&#47;1 port connection gets into blocking state. The port connection is converted to blocking state, only if the VLAN 1&#x30;&#x30; Spanning Tree instance determines it is required, to avoid a network loop. </p></td></tr></table></div></p><p class="bullet" id="1114484"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The connections between 4&#47;8 and 5&#47;2 and 4&#47;2 and 5&#47;1 are seen as redundant because they are both controlled by the VLAN 2&#x30;&#x30; Spanning Tree instance and connect to the same switches. The VLAN 2&#x30;&#x30; Spanning Tree instance determines which connection provides the best data path and transitions the other connection to a blocking state.</p><p class="screen2" id="1120931"><object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_43.svg" height="158.663981" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="357.569275"></object></p><p class="FigureTitle" id="1114515">Figure 6&#x2D;4 &#x3A;  Flat Mode STP&#47;RSTP (8&#x30;2.1D&#47;8&#x30;2.1w)</p><p class="text" id="1114516">In the above flat mode STP&#47;RSTP example&#x3A;</p><p class="bullet" id="1114517"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Both switches are running in the flat mode. As a result, a single flat mode Spanning Tree instance applies to the entire switch and compares port connections across VLANs to determine which connection provides the best data path. </p><p class="bullet" id="1114518"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The connection between 3&#47;1 and 2&#47;1 is left forwarding because the flat mode instance determined that this connection provides the best data path between the two switches.</p><p class="bullet" id="1114519"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The 4&#47;8 to 5&#47;2 connection and the 4&#47;2 to 5&#47;1 connection are considered redundant connections so they are both blocked in favor of the 3&#47;1 to 2&#47;1 connection.</p><p class="text" id="1114600"><object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_44.svg" height="231.664307" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="579.570231"></object></p><p class="FigureTitle" id="1114601">Figure 6&#x2D;5 &#x3A;  Flat Mode MSTP </p><p class="text" id="1114602">In the above flat mode MSTP example&#x3A;</p><p class="bullet" id="1114603"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Both switches are running in the flat mode and using MSTP.</p><p class="bullet" id="1114604"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLANs 1&#x30;&#x30; and 15&#x30; are <span class="Times_italics" style="font-style:Italic;background-color:transparent;">not</span> associated with an MSTI. They are controlled by the default CIST instance &#x30; that exists on every switch.</p><p class="bullet" id="1114605"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLANs 2&#x30;&#x30; and 25&#x30; are associated with MSTI 2 so their traffic can traverse a path different from that determined by the CIST.</p><p class="bullet" id="1114606"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Ports are blocked the same way they were blocked in the flat mode STP&#47;RSTP example; all port connections are compared to each other across VLANs to determine which connection provides the best path.</p><p class="indented1" id="1119654">However, because VLANs 2&#x30;&#x30; and 25&#x30; are associated to MSTI 2, it is possible to change the port path cost for ports 2&#47;12, 3&#47;6, 4&#47;8 and&#47;or 5&#47;2 so that they provide the best path for MSTI 2 VLANs, but do not carry CIST VLAN traffic or cause CIST ports to transition to a blocking state.</p><p class="indented1" id="1119663">Another alternative is to assign all VLANs to an MSTI, leaving no VLANs controlled by the CIST. As a result, the CIST BPDU contains only MSTI information.</p><p class="text" id="1114610">See <a  href="#XREF_35880__Sample_MSTI_Configuration159" style="color:#0000ff;background-color:transparent;">Sample MSTI Configuration</a> for more information about how to direct VLAN traffic over separate data paths using MSTP.</p><p class="heading2" id="1114612"><a id="XREF_95488__Comparing_MSTP_with_STP_and_RSTP159" name="XREF_95488__Comparing_MSTP_with_STP_and_RSTP159">Comparing MSTP with STP and RSTP</a></p><p class="z_Top_of_Form" id="1114613"><a id="159_z_Top_of_Form_1114613" name="159_z_Top_of_Form_1114613"></a><br/></p><p class="text" id="1114614">Using MSTP has the following items in common with STP (8&#x30;2.1D) and RSTP (8&#x30;2.1w) protocols&#x3A;</p><p class="bullet" id="1114615"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Each protocol ensures one data path between any two switches within the network topology. This prevents network loops from occurring while at the same time allowing for redundant path configuration. </p><p class="bullet" id="1114616"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Each protocol provides automatic reconfiguration of the network Spanning Tree topology in the event of a connection failure and&#47;or when a switch is added to or removed from the network.</p><p class="bullet" id="1114617"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>All three protocols are supported in the flat Spanning Tree operating mode.</p><p class="bullet" id="1114618"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The flat mode CST instance automatically determines port states and roles across VLAN port and MSTI associations. This is because the CST instance is active on all ports and only one BPDU is used to forward information for all MSTIs.</p><p class="bullet" id="1114619"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP is based on RSTP.</p><p class="text" id="1114620">Using MSTP differs from STP and RSTP as follows&#x3A;</p><p class="bullet" id="1114621"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP is only supported when the switch is running in the flat Spanning Tree mode. STP and RSTP are supported in both the per&#x2D;VLAN and flat modes.</p><p class="bullet" id="1114622"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP allows for the configuration of up to 16 Multiple Spanning Tree Instances (MSTI) in addition to the CST instance. Flat mode STP and RSTP protocols only use the single CST instance for the entire switch. See <a  href="#XREF_27417__What_is_a_Multiple_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Instance (MSTI)</a> for more information.</p><p class="bullet" id="1114626"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP applies a single Spanning Tree instance to an MSTI ID number that represents a set of VLANs; a one to many association. STP and RSTP in the flat mode apply one Spanning Tree instance to all VLANs; a one to all association. STP and RSTP in the per&#x2D;VLAN mode apply a single Spanning Tree instance to each existing VLAN; a one to one association. </p><p class="bullet" id="1114627"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The port priority and path cost parameters are configurable for an individual MSTI that represents the VLAN associated with the port. </p><p class="bullet" id="1114628"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The flat mode 8&#x30;2.1D or 8&#x30;2.1w CST is identified as instance 1. When using MSTP, the CST is <br/>identified as CIST (Common and Internal Spanning Tree) instance &#x30;. See <a  href="#XREF_70483__What_is_the_Common_and_Internal_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is the Common and Internal Spanning Tree Instance</a> for more information.</p><p class="bullet" id="1114632"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP allows the segmentation of switches within the network into MST regions. Each region is seen as a single virtual bridge to the rest of the network, even though multiple switches can belong to the one region. See <a  href="#XREF_40612__What_is_a_Multiple_Spanning_Tree_Region159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Region</a> for more information.</p><p class="bullet" id="1114636"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>MSTP has lower overhead than a per&#x2D;VLAN configuration. In per&#x2D;VLAN mode, because each VLAN is assigned a separate Spanning Tree instance, BPDUs are forwarded on the network for each VLAN. MSTP only forwards one BPDU for the CST that contains information for all configured MSTI on the switch. </p><p class="heading2" id="1114639"><a id="XREF_27417__What_is_a_Multiple_Spanning_Tree_Instance159" name="XREF_27417__What_is_a_Multiple_Spanning_Tree_Instance159">What is a </a><a id="index_1114638" name="index_1114638"></a><a data-indexterm="mst:%20MSTI" id="MST__MSTI" name="MST__MSTI"></a>Multiple Spanning Tree Instance (MSTI)</p><p class="text" id="1114643">An MSTI is a single Spanning Tree instance that represents a group of VLANs. The OmniSwitch supports up to 16 MSTIs on one switch. This number is in addition to the Common and Internal Spanning Tree (CIST) instance &#x30;, which is also known as MSTI &#x30;. The CIST instance exists on every switch. By default, all VLANs not mapped to an MSTI are associated with the CIST instance. See <a  href="#XREF_70483__What_is_the_Common_and_Internal_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is the Common and Internal Spanning Tree Instance</a> for more information.</p><p class="heading2" id="1114649"><a id="XREF_40612__What_is_a_Multiple_Spanning_Tree_Region159" name="XREF_40612__What_is_a_Multiple_Spanning_Tree_Region159">What is a </a><a id="index_1114648" name="index_1114648"></a><a data-indexterm="mst:%20Multiple%20Spanning%20Tree%20Region" id="MST__Multiple_Spanning_Tree_Region" name="MST__Multiple_Spanning_Tree_Region"></a>Multiple Spanning Tree Region</p><p class="text" id="1114650">A Multiple Spanning Tree region represents a group of MSTP switches. An MST region appears as a single, flat mode instance to switches outside the region. A switch can belong to only one region at a time. The region a switch belongs to is identified by the following configurable attributes, as defined by MSTP.</p><p class="bullet" id="1114651"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Region name </span>&#x2013; An alphanumeric string up to 32 characters. </p><p class="bullet" id="1114652"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Region revision level </span>&#x2013; A numerical value between &#x30; and 65535.</p><p class="bullet" id="1114653"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">VLAN to MSTI table </span>&#x2013; Generated when VLANs are associated with MSTIs. Identifies the VLAN to MSTI mapping for the switch.</p><p class="text" id="1114654">Switches that share the same values for the configuration attributes described above belong to the same region. For example, in the diagram below&#x3A;</p><p class="bullet" id="1114655"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Switches A, B, and C all belong to the same region because they all are configured with the same region name, revision level, and have the same VLANs mapped to the same MSTI.</p><p class="bullet" id="1114656"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The CST for the entire network sees Switches A, B, and C as one virtual bridge that is running a single Spanning Tree instance. As a result, CST blocks the path between Switch C and Switch E instead of blocking a path between the MST region switches to avoid a network loop.</p><p class="bullet" id="1114657"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The paths between Switch A and Switch C and the redundant path between Switch B and Switch C were blocked as a result of the Internal Spanning Tree (IST) computations for the MST Region. See <a  href="#XREF_83721__What_is_the_Common_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is the Internal Spanning Tree (IST) Instance</a><a id="XREF_65153__What_is_the_Internal_Spanning_Tree_Instance159" name="XREF_65153__What_is_the_Internal_Spanning_Tree_Instance159"></a> for more information.<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_45.svg" height="321.664530" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="611.569906"></object></p><p class="FigureTitle" id="1114695">Figure 6&#x2D;6 &#x3A;  Multiple Spanning Tree region </p><p class="text" id="1129263">In addition to the attributes described above, the MST maximum hops parameter defines the number of bridges authorized to propagate MST BPDU information. In essence, this value defines the size of the region in that once the maximum number of hops is reached, the BPDU is discarded. </p><p class="text" id="1114696">The maximum number of hops for the region is not one of the attributes that defines membership in the region. See <a  href="#XREF_71371__Sample_MST_Region_Configuration159" style="color:#0000ff;background-color:transparent;">Sample MST Region Configuration</a> for a tutorial on how to configure MST region parameters.</p><p class="heading2" id="1114700">What is the Common Spanning Tree</p><p class="text" id="1114701">The Common Spanning Tree (CST) is the overall network Spanning Tree topology resulting from STP, RSTP, and&#47;or MSTP calculations to provide a single data path through the network. The CST provides connectivity between MST regions and other MST regions and&#47;or Single Spanning Tree (SST) switches. For example, in the above diagram, CST calculations detected a network loop created by the connections between Switch D, Switch E, and the MST Region. As a result, one of the paths was blocked. </p><p class="heading2" id="1114704"><a id="XREF_83721__What_is_the_Common_Spanning_Tree_Instance159" name="XREF_83721__What_is_the_Common_Spanning_Tree_Instance159">What is the </a><a id="index_1114703" name="index_1114703"></a><a data-indexterm="mst:Internal%20Spanning%20Tree%20(IST)%20Instance" id="MST_Internal_Spanning_Tree_(IST)_Instance" name="MST_Internal_Spanning_Tree_(IST)_Instance"></a>Internal Spanning Tree (IST) Instance </p><p class="text" id="1114705">The IST instance determines and maintains the CST topology between MST switches that belong to the same MST region. In other words, the IST is simply a CST that only applies to MST Region switches while at the same time representing the region as a single Spanning Tree bridge to the network CST. </p><p class="text" id="1114706">As shown in the above diagram, the redundant path between Switch B and Switch C is blocked and the path between Switch A and Switch C is blocked. These blocking decisions were based on the IST computations within the MST region. IST sends and receives BPDU to&#47;from the network CST. MSTI within the region do not communicate with the network CST. As a result, the CST only sees the IST BPDU and treats the MST region as a single Spanning Tree bridge.</p><p class="heading2" id="1114708"><a id="XREF_70483__What_is_the_Common_and_Internal_Spanning_Tree_Instance159" name="XREF_70483__What_is_the_Common_and_Internal_Spanning_Tree_Instance159">What is the Common and Internal Spanning Tree Instance</a></p><p class="text" id="1114709"><a id="159_text_1114709" name="159_text_1114709"></a>The Common and Internal Spanning Tree (CIST) instance is the Spanning Tree calculated by the MST region IST and the network CST. The CIST is represented by the single Spanning Tree flat mode instance that is available on all switches. By default, all VLANs are associated to the CIST until they are mapped to an MSTI. </p><p class="text" id="1114710">When using STP (8&#x30;2.1D) or RSTP (8&#x30;2.1w). When using MSTP, the CIST is also known as instance &#x30; or MSTI &#x30;. </p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1119675"><span class="Bold">Note.  </span>When MSTP is the active flat mode protocol, explicit Spanning Tree bridge commands are required to configure parameter values. Implicit commands are for configuring parameters when the STP or RSTP protocols are in use. See <a  href="#XREF_37314__Using_Spanning_Tree_Configuration_Commands159" style="font-kerning:none;color:#0000ff;background-color:transparent;">Using Spanning Tree Configuration Commands</a> for more information.</p></td></tr></table></div></p><p class="heading2" id="1115768"><a id="XREF_82370__MST_Configuration_Overview159" name="XREF_82370__MST_Configuration_Overview159">MST Configuration Overview</a></p><p class="text" id="1115769"><a id="159_text_1115769" name="159_text_1115769"></a>The following general steps are required to set up a Multiple Spanning Tree (MST) configuration&#x3A;</p><p class="bullet" id="1115770"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Select the flat Spanning Tree mode </span>&#x2013; Each switch runs in the default mode. MSTP is only supported on a flat mode switch. See <a  href="#XREF_33590__Spanning_Tree_Operating_Modes159" style="color:#0000ff;background-color:transparent;">Spanning Tree Operating Modes</a> for more information.</p><p class="bullet" id="1115774"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Select the</span><span class="Times_Bold" style="font-weight:Bold;color:#00ae00;background-color:transparent;">&#160;</span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">MSTP protocol </span>&#x2013; Each switch uses the default protocol. Selecting MSTP activates the Multiple Spanning Tree.<span style="color:#ff00ff;">&#160;</span>See <a  href="#XREF_19680__How_MSTP_Works159" style="color:#0000ff;background-color:transparent;">How MSTP Works</a> for more information.</p><p class="bullet" id="1115778"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Configure an MST region name and revision level </span>&#x2013; Switches that share the same MST region name, revision level, and VLAN to Multiple Spanning Tree Instance (MSTI) mapping belong to the same MST region. See <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;"><a  href="#XREF_40612__What_is_a_Multiple_Spanning_Tree_Region159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Region</a></span> for more information.</p><p class="bullet" id="1115782"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Configure MSTIs </span>&#x2013; Every switch has a default Common and Internal Spanning Tree (CIST) instance &#x30;, which is also referred to as MSTI &#x30;. Configuration of additional MSTI is required to segment switch VLANs into separate instances. See <a  href="#XREF_27417__What_is_a_Multiple_Spanning_Tree_Instance159" style="color:#0000ff;background-color:transparent;">What is a Multiple Spanning Tree Instance (MSTI)</a> for more information.</p><p class="bullet" id="1115786"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Map VLANs to MSTI </span>&#x2013; All existing VLANs are mapped to the default CIST instance &#x30;. Associating a VLAN to an MSTI specifies which Spanning Tree instance determines the best data path for traffic carried on the VLAN. In addition, the VLAN&#x2D;to&#x2D;MSTI mapping is also one of three MST configuration attributes used to determine that the switch belongs to a particular MST region.</p><p class="text" id="1115789">For a tutorial on setting up an example MST configuration, see <a  href="#XREF_71371__Sample_MST_Region_Configuration159" style="color:#0000ff;background-color:transparent;">Sample MST Region Configuration</a> and <a  href="#XREF_35880__Sample_MSTI_Configuration159" style="color:#0000ff;background-color:transparent;">Sample MSTI Configuration</a>.</p><p class="heading2" id="1115829"><a id="XREF_65506__MSTP_Interoperability_and_Migration159" name="XREF_65506__MSTP_Interoperability_and_Migration159">MST </a><a id="index_1115827" name="index_1115827"></a><a data-indexterm="mst:%20Interoperability" id="MST__Interoperability_" name="MST__Interoperability_"></a>Interoperability and <a id="index_1115828" name="index_1115828"></a><a data-indexterm="MST%20:%20Migration" id="MST___Migration" name="MST___Migration"></a>Migration</p><p class="text" id="1115830">Connecting an MSTP switch to a non&#x2D;MSTP flat mode switch is supported. Since the Common and Internal Spanning Tree (CIST) controls the flat mode instance on both switches, STP or RSTP can remain active on the non&#x2D;MSTP switch within the network topology. </p><p class="text" id="1115831">An MSTP switch is part of a Multiple Spanning Tree (MST) Region, which appears as a single, flat mode instance to the non&#x2D;MSTP switch. The port that connects the MSTP switch to the non&#x2D;MSTP switch is referred to as a <span class="Times_italics" style="font-style:Italic;background-color:transparent;"><a id="index_1115832" name="index_1115832"></a><a data-indexterm="boundary%20port" id="boundary_port" name="boundary_port"></a>boundary</span> port. When a boundary port detects an STP (8&#x30;2.1D) or RSTP (8&#x30;2.1w) BPDU, it responds with the appropriate protocol BPDU to provide interoperability between the two switches. This interoperability also serves to indicate the edge of the MST region.</p><p class="text" id="1115833">Interoperability between MSTP switches and per&#x2D;VLAN mode switches is not recommended. The per&#x2D;VLAN mode is a proprietary implementation that creates a separate Spanning Tree instance for each VLAN configured on the switch. The MSTP implementation is in compliance with the IEEE standard and is only supported on flat mode switches. </p><p class="text" id="1115834">Tagged BPDUs transmitted from a per&#x2D;VLAN switch are ignored by a flat mode switch. This can cause a network loop to go undetected. Although it is not recommended, you can also connect a per&#x2D;VLAN switch to a flat mode switch temporarily until migration to MSTP is complete. When a per&#x2D;VLAN switch is connected to a flat mode switch, configure only a fixed, untagged connection between VLAN 1 on both switches. </p><p class="heading3" id="1115836"><a id="index_1115835" name="index_1115835"></a><a data-indexterm="mst:Migration" id="MST_Migration" name="MST_Migration"></a>Migrating from Flat Mode STP&#47;RSTP to Flat Mode MSTP</p><p class="text" id="1115837">Migrating an STP&#47;RSTP flat mode switch to MSTP is relatively transparent. When STP or RSTP is the active protocol, the Common and Internal Spanning Tree (CIST) controls the flat mode instance. If on the same switch the protocol is changed to MSTP, the CIST still controls the flat mode instance. </p><p class="text" id="1115838">Note the following when converting a flat mode STP&#47;RSTP switch to MSTP&#x3A;</p><p class="bullet" id="1115839"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Making a backup copy of the switch <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">boot.cfg</span> file before changing the protocol to MSTP is highly recommended. Having a backup copy makes it easier to revert to the non&#x2D;MSTP configuration. Once MSTP is active, commands are written in their explicit form and not compatible with previous releases of Spanning Tree. </p><p class="bullet" id="1115840"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When converting multiple switches, change the protocol to MSTP first on every switch before starting to configure Multiple Spanning Tree Instances (MSTI).</p><p class="bullet" id="1115841"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Once the protocol is changed, MSTP features are available for configuration. Multiple Spanning Tree Instances (MSTI) are now configurable for defining data paths for VLAN traffic. See <a  href="#XREF_19680__How_MSTP_Works159" style="color:#0000ff;background-color:transparent;">How MSTP Works</a> for more information.</p><p class="bullet" id="1115845"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Using explicit Spanning Tree commands to define the MSTP configuration is required. Implicit commands are for configuring STP and RSTP. See <a  href="#XREF_37314__Using_Spanning_Tree_Configuration_Commands159" style="color:#0000ff;background-color:transparent;">Using Spanning Tree Configuration Commands</a> for more information.</p><p class="bullet" id="1115849"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>STP and RSTP use a 16&#x2D;bit port path cost (PPC) and MSTP uses a 32&#x2D;bit PPC. When the protocol is changed to MSTP, the bridge priority and PPC values for the flat mode CIST instance are reset to their default values. </p><p class="bullet" id="1115852"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>It is possible to configure the switch to use 32&#x2D;bit PPC value for all protocols (see the <a href="../c_stp/c_stp.htm#XREF_97321__bridge_path_cost_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree path-cost-mode</a> command page for more information). If this is the case, then the PPC for the CIST is not reset when the protocol is changed to&#47;from MSTP.</p><p class="bullet" id="1115854"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>This implementation of MSTP is compliant with the IEEE 8&#x30;2.1Q 2&#x30;&#x30;5 standard and thus provides interconnectivity with MSTP compliant systems.</p><p class="heading3" id="1115857"><a id="XREF_11279__Migrating_from_1x1_Mode_to_Flat_Mode_MSTP159" name="XREF_11279__Migrating_from_1x1_Mode_to_Flat_Mode_MSTP159"></a><a id="index_1115856" name="index_1115856"></a><a data-indexterm="mst:Migration" id="MST_Migration" name="MST_Migration"></a>Migrating from Per&#x2D;VLAN Mode to Flat Mode MSTP</p><p class="text" id="1115861">As previously described, the per&#x2D;VLAN mode is an OmniSwitch proprietary implementation that applies one Spanning Tree instance to each VLAN. For example, if five VLANs exist on the switch, then their are five Spanning Tree instances active on the switch, unless Spanning Tree is disabled on one of the VLANs.</p><p class="text" id="1115862">Note the following when converting a per&#x2D;VLAN mode STP&#47;RSTP switch to flat mode MSTP&#x3A;</p><p class="bullet" id="1115863"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Making a backup copy of the switch <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">boot.cfg</span> file before changing the protocol to MSTP is highly recommended. Having a backup copy makes it easier to revert to the non&#x2D;MSTP configuration. Once MSTP is active, commands are written in their explicit form and not compatible with previous releases of Spanning Tree.</p><p class="bullet" id="1115864"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Using MSTP requires changing the switch mode from per&#x2D;VLAN to flat. When the mode is changed from per&#x2D;VLAN to flat, ports still retain their VLAN associations but are now part of a single, flat mode Spanning Tree instance that spans across all VLANs. As a result, a path that was forwarding traffic in the per&#x2D;VLAN mode transitions to a blocking state after the mode is changed to flat.</p><p class="bullet" id="1115865"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Once the protocol is changed, MSTP features are available for configuration. Multiple Spanning Tree Instances (MSTI) are now configurable for defining data paths for VLAN traffic. See <a  href="#XREF_19680__How_MSTP_Works159" style="color:#0000ff;background-color:transparent;">How MSTP Works</a> for more information.</p><p class="bullet" id="1115869"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Note that STP&#47;RSTP use a 16&#x2D;bit port path cost (PPC) and MSTP uses a 32&#x2D;bit PPC. When the protocol is changed to MSTP, the bridge priority and PPC values for the flat mode CIST instance are reset to their default values. </p><p class="bullet" id="1115872"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>It is possible to configure the switch to use 32&#x2D;bit PPC value for all protocols (see the <a href="../c_stp/c_stp.htm#XREF_97321__bridge_path_cost_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree path-cost-mode</a> command page for more information). If this is the case, then the PPC for the CIST is not reset when the protocol is changed to&#47;from MSTP.</p><p class="bullet" id="1115874"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>This implementation of MSTP is compliant with the IEEE 8&#x30;2.1Q 2&#x30;&#x30;5 standard and thus provides interconnectivity with MSTP compliant systems.</p><p class="heading1" id="1006596"><a id="XREF_33590__Spanning_Tree_Operating_Modes159" name="XREF_33590__Spanning_Tree_Operating_Modes159">Spanning Tree Operating Modes</a></p><p class="text" id="1078242"><a id="159_text_1078242" name="159_text_1078242"></a>The switch can operate in one of two Spanning Tree <a id="index_1078241" name="index_1078241"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:flat%20operating%20mode" id="Spanning_Tree_Algorithm_and_Protocol_flat_operating_mode" name="Spanning_Tree_Algorithm_and_Protocol_flat_operating_mode"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:1x1%20operating%20mode" id="Spanning_Tree_Algorithm_and_Protocol_1x1_operating_mode" name="Spanning_Tree_Algorithm_and_Protocol_1x1_operating_mode"></a>modes&#x3A; <span class="Times_italics" style="font-style:Italic;background-color:transparent;">flat</span> and <span class="Times_italics" style="font-style:Italic;background-color:transparent;">per&#x2D;VLAN</span>. Both modes apply to the entire switch and determine whether a single Spanning Tree instance is applied across multiple VLANs (flat mode) or a single instance is applied to each VLAN (per&#x2D;VLAN mode). A switch runs on the default mode when it is first turned on. </p><p class="text" id="1110511">Use the <a id="index_1110507" name="index_1110507"></a><a data-indexterm="%3Cindex%3Ebridge%20mode%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_mode%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_mode%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_43473__bridge_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mode</a> command to select the Flat or Per&#x2D;VLAN Spanning Tree mode.The switch operates in one mode or the other, however, it is not necessary to reboot the switch when changing modes. </p><p class="heading2" id="1110519">Using Flat Spanning Tree Mode</p><p class="text" id="1078246">Before selecting the flat Spanning Tree mode, consider the following&#x3A;</p><p class="bullet" id="1078247"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>If STP (8&#x30;2.1D) is the active protocol, then there is one Spanning Tree instance for the entire switch; port states are determined across VLANs. If MSTP (8&#x30;2.1s) is the active protocol, then multiple instances up to a total of 17 are allowed. Port states, however, are still determined across VLANs.</p><p class="bullet" id="1078248"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Multiple connections between switches are considered redundant paths even if they are associated with different VLANs. </p><p class="bullet" id="1078249"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Spanning Tree parameters are configured for the single flat mode instance. For example, if Spanning Tree is disabled on VLAN 1, then it is disabled for all VLANs. Disabling STP on any other VLAN, however, only exclude ports associated with that VLAN from the Spanning Tree Algorithm.</p><p class="bullet" id="1078250"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Fixed (untagged) and 8&#x30;2.1Q tagged ports are supported in each VLAN. BPDU, however, are always untagged.</p><p class="bullet" id="1078251"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When the Spanning Tree mode is changed from per&#x2D;VLAN to flat, ports still retain their VLAN associations but are now part of a single Spanning Tree instance that spans across all VLANs. As a result, a path that was forwarding traffic in the per&#x2D;VLAN mode can transition to a blocking state after the mode is changed to flat.</p><p class="text" id="1078252">To change the Spanning Tree operating mode to flat, enter the following command&#x3A;</p><p class="example1" id="1078253">&#x2D;&#x3E; spantree mode flat</p><p class="text" id="1078254">The following diagram shows a flat mode switch with STP (8&#x30;2.1D) as the active protocol. All ports, regardless of their default VLAN configuration or tagged VLAN assignments, are considered part of one Spanning Tree instance. To see an example of a flat mode switch with MSTP (8&#x30;2.1s) as the active protocol, see <a  href="#XREF_34979__MST_General_Overview159" style="color:#0000ff;background-color:transparent;">MST General Overview</a>.</p><p class="text" id="1074243"><object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_51.svg" height="259.751668" style="max-width: 100% ;height: auto;border:1pt solid #000000;display:block;margin:auto;" type="image/svg+xml" width="545.651469"></object></p><p class="FigureTitle" id="1036660">Figure 6&#x2D;7 &#x3A;  <a id="index_1075778" name="index_1075778"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:flat%20operating%20mode" id="Spanning_Tree_Algorithm_and_Protocol_flat_operating_mode" name="Spanning_Tree_Algorithm_and_Protocol_flat_operating_mode"></a>Flat Spanning Tree Example</p><p class="text" id="1036547">In the above example, if port 8&#47;3 connects to another switch and port 1&#x30;&#47;5 connects to that same switch, the Spanning Tree Algorithm would detect a redundant path and transition one of the ports into a blocking state. The same holds true for the tagged ports.</p><p class="heading2" id="1016666">Using Per&#x2D;VLAN Spanning Tree Mode</p><p class="text" id="1024295">Before selecting the Per&#x2D;VLAN Spanning Tree operating mode, consider the following&#x3A;</p><p class="bullet" id="1033810"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>A single Spanning Tree instance is enabled for each VLAN configured on the switch. For example, if there are five VLANs configured on the switch, then there are five separate Spanning Tree instances, each with its own root VLAN. In essence, a VLAN is a virtual bridge. The VLAN has its own bridge ID and configurable STP parameters, such as protocol, priority, hello time, max age, and forward delay. </p><p class="bullet" id="1033927"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port state is determined on a per VLAN basis. For example, port connections in VLAN 1&#x30; are only examined for redundancy within VLAN 1&#x30; across all switches. If a port in VLAN 1&#x30; and a port in VLAN 2&#x30; both connect to the same switch within their respective VLANs, they are not considered redundant data paths and STP does not block them. However, if two ports within VLAN 1&#x30; both connect to the same switch, then the STP transition one of these ports to a blocking state.</p><p class="bullet" id="1033930"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Fixed (untagged) ports participate in the single Spanning Tree instance that applies to their configured default VLAN. </p><p class="bullet" id="1036769"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>8&#x30;2.1Q tagged ports participate in an 8&#x30;2.1Q Spanning Tree instance that allows the Spanning Tree to extend across tagged VLANs. As a result, a tagged port can participate in more than one Spanning Tree instance; one for each VLAN that the port carries.</p><p class="bullet" id="1036770"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>If a VLAN contains both fixed and tagged ports, then a hybrid of the two Spanning Tree instances (single and 8&#x30;2.1Q) is applied. If a VLAN appears as a tag on a port, then the BPDU for that VLAN are also tagged. However, if a VLAN appears as the configured default VLAN for the port, then BPDU are not tagged and the single Spanning Tree instance applies.</p><p class="text" id="1033988">To change the Spanning Tree operating mode to per&#x2D;VLAN, enter the following command&#x3A;</p><p class="example1" id="1033989">&#x2D;&#x3E; spantree mode per&#x2D;vlan</p><p class="text" id="1034004">The following diagram shows a switch running in the per&#x2D;VLAN Spanning Tree mode and shows Spanning Tree participation for both fixed and tagged ports. <object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_52.svg" height="334.251953" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="592.984985"></object></p><p class="FigureTitle" id="1034002">Figure 6&#x2D;8 &#x3A;  Per VLAN (single and 8&#x30;2.1Q) Spanni<a id="index_1075779" name="index_1075779"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:1x1%20operating%20mode" id="Spanning_Tree_Algorithm_and_Protocol_1x1_operating_mode" name="Spanning_Tree_Algorithm_and_Protocol_1x1_operating_mode"></a>ng Tree Example</p><p class="text" id="1102244">In the above example, STP2 is a single Spanning Tree instance since VLAN 5 contains only fixed ports. STP 3 and STP 4 are a combination of single and 8&#x30;2.1Q Spanning Tree instances because VLAN 2 contains both fixed and tagged ports. On ports where VLAN 2 is the default VLAN, BPDU are not tagged. on ports where VLAN 2 is a tagged VLAN, BPDU are also tagged.</p><p class="heading2" id="1102266">Using Per&#x2D;VLAN Spanning Tree Mode with PVST+</p><p class="text" id="1103148">In order to interoperate with Cisco&apos;s proprietary Per Vlan Spanning Tree (PVST+) mode, the OmniSwitch per&#x2D;VLAN Spanning Tree mode allows OmniSwitch ports to transmit and receive either the standard IEEE BPDUs or Cisco&apos;s proprietary PVST+ BPDUs. When the PVST+ mode is enabled, a user port operates in the default mode initially until it detects a PVST+ BPDU, which automatically enables the port to operate in the Cisco PVST+ compatible mode. </p><p class="text" id="1116789">The PVST+ compatibility mode allows OmniSwitch ports to operate in the per&#x2D;VLAN mode when connected to another OmniSwitch or in the Cisco PVST+ mode when connected to a Cisco switch. As a result, both the OmniSwitch per&#x2D;VLAN and Cisco PVST+ modes can co&#x2D;exist on the same OmniSwitch <span class="Times_italics" style="font-style:Italic;background-color:transparent;">and</span> interoperate correctly with a Cisco switch using the standard Spanning Tree protocols (STP or RSTP). </p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1119730"><span class="Bold">Note.  </span><span style="font-kerning:none;">In the flat Spanning Tree mode, both the OmniSwitch and Cisco switches can interoperate seamlessly using the standard MSTP protocol.</span></p></td></tr></table></div></p><p class="heading2" id="1102493">OmniSwitch PVST+ Interoperability</p><p class="heading4" id="1102494">Native VLAN and OmniSwitch Default VLAN</p><p class="text" id="1102495">Cisco uses the standard IEEE BPDU format for the native VLAN (VLAN 1) over an 8&#x30;2.1Q trunk. Thus, by default the Common Spanning Tree (CST) instance of the native VLAN 1 for all Cisco switches and the STP instance for the default VLAN of a port on an OmniSwitch interoperates and successfully creates a loop&#x2D;free topology.</p><p class="heading4" id="1102437">8&#x30;2.1Q Tagged VLANs</p><p class="text" id="1102438">For 8&#x30;2.1Q tagged VLANs, Cisco uses a proprietary frame format which differs from the standard IEEE BPDU format used by the OmniSwitch per&#x2D;VLAN mode, thus preventing Spanning Tree topologies for tagged VLANs from interoperating over the 8&#x30;2.1Q trunk.</p><p class="text" id="1102440">In order to interoperate with Cisco PVST+ mode, the current OmniSwitch per&#x2D;VLAN mode has an option to recognize Cisco&apos;s proprietary PVST+ BPDUs. This allows any user port on an OmniSwitch to send and receive PVST+ BPDUs, so that loop&#x2D;free topologies for the tagged VLANs can be created between OmniSwitch and Cisco switches.</p><p class="heading4" id="1102442">Configuration Overview</p><p class="text" id="1102443">The <a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a> command is used to enable or disable the PVST+ interoperability mode globally for all switch ports and link aggregates or on a per&#x2D;port&#47;link aggregate basis. By default, PVST+ compatibility is disabled.</p><p class="text" id="1116836">To globally enable or disable PVST+ interoperability, enter the following commands&#x3A;</p><p class="example1" id="1116856">&#x2D;&#x3E; spantree pvst+compatibility enable</p><p class="example2" id="1116852">&#x2D;&#x3E; spantree pvst+compatibility disable</p><p class="text" id="1102447">To enable or disable PVST+ interoperability for a specific port or link aggregate, use the <a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">port</span> or <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">linkagg</span> parameter. For example&#x3A;</p><p class="example1" id="1116905">&#x2D;&#x3E; spantree pvst+compatibility port 1&#47;3 enable</p><p class="example2" id="1116903">&#x2D;&#x3E; spantree pvst+compatibility port 2&#47;24 disable</p><p class="example2" id="1116904">&#x2D;&#x3E; spantree pvst+compatibility linkagg 3 enable</p><p class="example2" id="1102456">&#x2D;&#x3E; spantree pvst+compatibility linkagg 1&#x30; disable</p><p class="text" id="1102459">The following causes a port to exit from the enabled state&#x3A;</p><p class="bullet" id="1102460"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The link status of the port changes.</p><p class="bullet" id="1102461"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The administrative status of the port changes.</p><p class="bullet" id="1102462"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The PVST+ status of the port is disabled or set to auto.</p><p class="text" id="1102477">To configure a port or link aggregate to automatically detect</p><p class="text" id="1116919">The <a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a><span style="font-weight:Bold;">&#160;</span>command also provides an <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">auto</span> option to configure the port to handle IEEE BPDUs initially (i.e., disable state). Once a PVST+ BPDU is received, it handles the PVST+ BPDUs and IEEE BPDUs for a Cisco native VLAN. For example&#x3A;</p><p class="example1" id="1102479">&#x2D;&#x3E; spantree pvst+compatibility port 1&#47;3 auto</p><p class="example2" id="1119928">&#x2D;&#x3E; spantree pvst+compatibility linkagg 3 auto</p><p class="text" id="1103270">The following show command displays the PVST+ status.</p><p class="example1" id="1103281">&#x2D;&#x3E; show spantree mode</p><p class="example2" id="1113182">Spanning Tree Global Parameters</p><p class="example2" id="1119934">Current Running Mode  &#x3A; per&#x2D;vlan, </p><p class="example2" id="1119937">Current Protocol      &#x3A; N&#47;A (Per VLAN), </p><p class="example2" id="1119940">Path Cost Mode        &#x3A; 32 BIT,</p><p class="example2" id="1119943">Auto Vlan Containment &#x3A; N&#47;A </p><p class="example2" id="1119946">Cisco PVST+ mode      &#x3A; Enabled</p><p class="example2" id="1113194">Vlan Consistency check&#x3A; Disabled</p><p class="heading3" id="1102597">BPDU Processing in PVST+ Mode</p><p class="text" id="1102598">An OmniSwitch port operating in PVST+ mode processes BPDUs as follows&#x3A;</p><p class="text" id="1102600">If the default VLAN of a port is VLAN 1 then&#x3A;</p><p class="bullet" id="1102601"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Send and receive IEEE untagged BPDUs for VLAN 1</p><p class="bullet" id="1102602"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Don&apos;t send and receive PVST+ tagged BPDUs for VLAN 1</p><p class="bullet" id="1102603"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Send and receive tagged PVST+ BPDUs for other tagged VLANs.</p><p class="text" id="1102606">If the default VLAN of a port is not VLAN 1 then&#x3A;</p><p class="bullet" id="1102607"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Send and receive IEEE untagged BPDUs for VLAN 1</p><p class="bullet" id="1102655"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Don&apos;t send and receive PVST+ tagged BPDUs for VLAN 1</p><p class="bullet" id="1102656"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Send and receive untagged PVST+ BPDUs for the port&apos;s default VLAN</p><p class="bullet" id="1102657"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Send and receive tagged PVST+ BPDUs for other tagged VLANs</p><p class="heading3" id="1102613">Recommendations and Requirements for PVST+ Configurations</p><p class="bullet" id="1102614"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>It is mandatory that all the Cisco switches have the MAC Reduction Mode feature enabled in order to interoperate with an OmniSwitch in PVST+ mode. This avoids any unexpected election of a root bridge.</p><p class="bullet" id="1102848"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>You can assign the priority value only in the multiples of 4&#x30;96 to be compatible with the Cisco MAC Reduction mode; any other values result in an error message. Also, the existing per vlan priority values are restored when changing from PVST+ mode back to per&#x2D;VLAN mode. For more information on priority, refer to <a  href="#XREF_52388__Configuring_VLAN_Bridge_Priority159" style="color:#0000ff;background-color:transparent;">Configuring the Bridge Priority</a>. </p><p class="bullet" id="1102849"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>In a mixed OmniSwitch and Cisco environment, it is highly recommended to enable PVST+ mode on all OmniSwitches in order to maintain the same root bridge for the topology. It is possible that the new root bridge might be elected as a result of inconsistencies of MAC reduction mode when connecting an OmniSwitch that does not support Cisco PVST+ mode to an OmniSwitch with the PVST+ mode enabled. In this case, the root bridge priority must be changed manually to maintain the same root bridge. For more information on priority, refer to <a  href="#XREF_52388__Configuring_VLAN_Bridge_Priority159" style="color:#0000ff;background-color:transparent;">Configuring the Bridge Priority</a>.</p><p class="bullet" id="1102620"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>A Cisco switch running in PVST mode (another Cisco proprietary mode prior to 8&#x30;2.1q standard) is not compatible with an OmniSwitch running in per&#x2D;VLAN PVST+ mode. </p><p class="bullet" id="1102622"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Both Cisco and OmniSwitch support two default path cost modes; long or short. It is recommended that the same default path cost mode be configured in the same way on all switches so that the path costs for similar interface types are consistent when connecting ports between OmniSwitch and Cisco Switches. For more information on path cost mode, refer to <a  href="#XREF_12774__Configuring_the_Path_Cost_Mode159" style="color:#0000ff;background-color:transparent;">Configuring the Path Cost Mode</a>.</p><p class="bullet" id="1102628"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Dynamic aggregate link (LACP) functions properly between OmniSwitch and Cisco switches. The Cisco switches send the BPDUs only on one physical link of the aggregate, similar to the OmniSwitch Primary port functionality. The path cost assigned to the aggregate link is not the same between OmniSwitch and Cisco switches since vendor&#x2D;specific formulas are used to derive the path cost. Manual configuration is recommended to match the Cisco path cost assignment for an aggregate link. For more information on the configuration of path cost for aggregate links, refer to <a  href="#XREF_97526__Path_Cost_for_Link_Aggregate_Ports159" style="color:#0000ff;background-color:transparent;">Path Cost for Link Aggregate Ports</a>.</p><p>The table below shows the default Spanning Tree values.<div align="left"><table class="Cmds_Overview" style="max-width: 100% ;height: auto;"><col width="193.92px"/><col width="194.00px"/><col width="204.00px"/><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102741">Parameters</p></td><td><p class="CellBody" id="1102743" style="font-weight:Bold;">OmniSwitch</p></td><td><p class="CellBody" id="1102745" style="font-weight:Bold;">Cisco</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102747" style="font-weight:normal;">Mac Reduction Mode</p></td><td><p class="CellBody" id="1102749">Enabled</p></td><td><p class="CellBody" id="1102751">Disabled</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102753" style="font-weight:normal;">Bridge Priority</p></td><td><p class="CellBody" id="1102755">32768</p></td><td><p class="CellBody" id="1102757">32768</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102759" style="font-weight:normal;">Port Priority</p></td><td><p class="CellBody" id="1102761">128</p></td><td><p class="CellBody" id="1102763">32 (catOS) &#47; 128 (IOS)</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102765">Port Path Cost</p></td><td><p class="CellBody" id="1102767">IEEE Port Speed Table</p></td><td><p class="CellBody" id="1102769">IEEE Port Speed Table</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102771" style="font-weight:normal;">Aggregate Path Cost</p></td><td><p class="CellBody" id="1102773">Proprietary Table</p></td><td><p class="CellBody" id="1102775">Avg Path Cost &#47; NumPorts</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102777" style="font-weight:normal;">Default Path Cost Mode</p></td><td><p class="CellBody" id="1102779">Short (16&#x2D;bit)</p></td><td><p class="CellBody" id="1102781">Short (16&#x2D;bit)</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102783" style="font-weight:normal;">Max Age</p></td><td><p class="CellBody" id="1102785">2&#x30;</p></td><td><p class="CellBody" id="1102787">2&#x30;</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102789" style="font-weight:normal;">Hello Time</p></td><td><p class="CellBody" id="1102791">2</p></td><td><p class="CellBody" id="1102793">2</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102795" style="font-weight:normal;">Forward Delay Time</p></td><td><p class="CellBody" id="1102797">15</p></td><td><p class="CellBody" id="1102799">15</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1102801" style="font-weight:normal;">Default Protocol</p></td><td><p class="CellBody" id="1102803">RSTP (1w) Per Vlan</p></td><td><p class="CellBody" id="1102805">PVST+ (1d) Per Switch</p></td></tr></table></div></p><p class="heading1" id="1114771"><a id="XREF_10950__Configuring_STP_VLAN_Parameters159" name="XREF_10950__Configuring_STP_VLAN_Parameters159"></a><a id="XREF_37314__Using_Spanning_Tree_Configuration_Commands159" name="XREF_37314__Using_Spanning_Tree_Configuration_Commands159">Using Spanning Tree Configuration Commands</a></p><p class="text" id="1114775"><a id="159_text_1114775" name="159_text_1114775"></a>The OmniSwitch Spanning Tree implementation uses commands that contain one of the following keywords to specify the type of Spanning Tree instance to modify&#x3A;</p><p class="bullet" id="1114776"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist </span>&#x2013; command applies to the Common and Internal Spanning Tree instance. The CIST is the single Spanning Tree flat mode instance that is available on all switches. When using STP or RSTP, the CIST is also known as instance 1 or bridge 1. </p><p class="bullet" id="1114838"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">msti </span>&#x2013; command applies to the specified Multiple Spanning Tree Instance. When using MSTP (8&#x30;2.1s), the CIST instance is also known as MSTI &#x30;.</p><p class="bullet" id="1114839"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan </span>&#x2013; command applies to the specified VLAN instance.</p><p class="text" id="1114840">These commands (referred to as explicit commands) allow the configuration of a particular Spanning Tree instance independent of which mode and&#47;or protocol is currently active on the switch. The configuration, however, does not go active until the switch is changed to the appropriate mode. For example, if the switch is running in the per&#x2D;VLAN mode, the following explicit command changes the MSTI 3 priority to 12288&#x3A;</p><p class="example1" id="1114780">&#x2D;&#x3E; spantree msti 3 priority 12288</p><p class="text" id="1114781">Even though the above command is accepted in the per&#x2D;VLAN mode, the new priority value does not take effect until the switch mode is changed to flat mode. </p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="86.00px"><td><p class="CellBody_note_text" id="1119956"><span class="Bold">Note.  </span><span style="font-kerning:none;">When a snapshot is taken of the switch configuration, the explicit form of all Spanning Tree commands is captured. For example, if the priority of MSTI 2 was changed from the default value to a priority of 16384, then </span><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">spantree msti 2 priority 16384 </span><span style="font-kerning:none;">is the command captured to reflect this in the snapshot file. In addition, explicit commands are captured for both flat and per&#x2D;VLAN mode configurations.</span></p></td></tr></table></div></p><p class="heading1" id="1114765">Configuring STP Bridge Parameters</p><p class="text" id="1078271">The Spanning Tree software is active on all switches by default and uses default bridge and port parameter values to calculate a loop free topology. It is only necessary to configure these parameter values if it is necessary to change how the topology is calculated and maintained.</p><p class="text" id="1078272">Note the following when configuring Spanning Tree bridge parameters&#x3A;</p><p class="bullet" id="1078273"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When a switch is running in the per&#x2D;VLAN Spanning Tree mode, each VLAN is in essence a virtual bridge with its own Spanning Tree instance and configurable bridge parameters. </p><p class="bullet" id="1078274"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>When the switch is running in the flat mode and STP (8&#x30;2.1D) or RSTP (8&#x30;2.1w) is the active protocol, bridge parameter values are only configured for the flat mode instance. </p><p class="bullet" id="1078275"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>If MSTP (8&#x30;2.1s) is the active protocol, then the priority value is configurable for each Multiple Spanning Tree Instance (MSTI). All other parameters, however, are still only configured for the flat mode instance and are applied across all MSTIs.</p><p class="bullet" id="1078276"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Bridge parameter values for a VLAN instance are not active unless Spanning Tree is enabled on the VLAN and at least one active port is assigned to the VLAN. Use the <a id="index_1094787" name="index_1094787"></a><a data-indexterm="%3Cindex%3Evlan%20svlan%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Evlan_svlan%3Cdefault_para_font%3E_command" name="%3Cindex%3Evlan_svlan%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_62748__spantree_vlan_admin-state" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan admin-state</a><span style="color:#ff00ff;">&#160;</span>command to enable or disable a VLAN Spanning Tree instance. </p><p class="bullet" id="1078280"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>If Spanning Tree is disabled on a VLAN, active ports associated with that VLAN are excluded from Spanning Tree calculations and remain in a forwarding state.</p><p class="bullet" id="1078281"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Note that when a switch is running in the flat mode, disabling Spanning Tree on VLAN 1 disables the instance for all VLANs and all active ports are then excluded from any Spanning Tree calculations and remain in a forwarding state. </p><p class="text" id="1078298">The following is a summary of Spanning Tree bridge configuration commands. For more information about these commands, see the <span class="Times_italics" style="font-style:Italic;background-color:transparent;"><span data-keyref="CLI Reference Guide">OmniSwitch AOS Release 8 CLI Reference Guide</span>.</span>&#160;<div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="192.00px"/><col width="384.00px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1114911">Commands</p></th><th><p class="CellHeading" id="1114913">Used for ...</p></th></tr></thead><tr height="39.33px"><td><p class="CellBody" id="1114918" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="color:#0000ff;background-color:transparent;">spantree protocol</a></span><span style="font-weight:normal;">&#160;</span></p></td><td><p class="CellBody" id="1114920">Configuring the protocol for the flat mode CIST instance or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1114925" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="color:#0000ff;background-color:transparent;">spantree priority</a></span></p></td><td><p class="CellBody" id="1114927">Configuring the priority value for the flat mode CIST instance, a Multiple Spanning Tree Instance (MSTI), or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1114932" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_97193__bridge_hello_time" style="color:#0000ff;background-color:transparent;">spantree hello-time</a></span></p></td><td><p class="CellBody" id="1114934">Configuring the hello time value for the flat mode CIST instance or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1114939" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_17450__spantree_max-age" style="color:#0000ff;background-color:transparent;">spantree max-age</a></span></p></td><td><p class="CellBody" id="1114941">Configuring the maximum age time value for the flat mode CIST instance or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1114946"><a href="../c_stp/c_stp.htm#XREF_83537__spantree_forward-delay" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree forward-delay</a></p></td><td><p class="CellBody" id="1114948">Configuring the forward delay time value for the flat mode CIST instance or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1114953" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_22333__bridge" style="color:#0000ff;background-color:transparent;">spantree bpdu-switching</a></p></td><td><p class="CellBody" id="1114955">Configuring the BPDU switching status for a VLAN.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1114960" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_97321__bridge_path_cost_mode" style="color:#0000ff;background-color:transparent;">spantree path-cost-mode</a></span></p></td><td><p class="CellBody" id="1114962">Configuring the automatic selection of a 16&#x2D;bit path cost for STP&#47;RSTP ports and a 32&#x2D;bit path cost for MSTP ports or sets all path costs to use a 32&#x2D;bit value.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1114966" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_97899__bridge_auto-vlan-containment" style="color:#0000ff;background-color:transparent;">spantree auto-vlan-containment</a></p></td><td><p class="CellBody" id="1114969">Enables or disables Auto VLAN Containment (AVC) for 8&#x30;2.1s instances. </p></td></tr><tr height="23.33px"><td><p class="CellBody_cli_cmd" id="1114974" style="font-kerning:none;color:#ff00ff;"><span style="font-weight:normal;color:#000000;"><a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a></span></p></td><td><p class="CellBody" id="1114976">Enables or disables PVST+ mode on the switch.</p></td></tr></table></div></p><p class="text" id="1079839">The following sections provide information and procedures for using the bridge configuration commands and also includes command examples.</p><p class="heading2" id="1095226"><a id="XREF_18311__Selecting_the_VLAN_Bridge_Protocol_(802_1D_or_802_1w)159" name="XREF_18311__Selecting_the_VLAN_Bridge_Protocol_(802_1D_or_802_1w)159">Selecting the Spantree Protocol</a></p><p class="text" id="1095228"><a id="159_text_1095228" name="159_text_1095228"></a><a id="index_1095227" name="index_1095227"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:802.1D%20standard%20protocol" id="Spanning_Tree_bridge_parameters_802_1D_standard_protocol" name="Spanning_Tree_bridge_parameters_802_1D_standard_protocol"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:802.1w%20rapid%20reconfiguration%20protocol" id="Spanning_Tree_bridge_parameters_802_1w_rapid_reconfiguration_protocol" name="Spanning_Tree_bridge_parameters_802_1w_rapid_reconfiguration_protocol"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:802.1s%20multiple%20spanning%20tree%20protocol" id="_Spanning_Tree_bridge_parameters_802_1s_multiple_spanning_tree_protocol" name="_Spanning_Tree_bridge_parameters_802_1s_multiple_spanning_tree_protocol"></a>The switch supports three Spanning Tree protocols&#x3A; STP, RSTP (the default), MSTP. To configure the Spanning Tree protocol for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree protocol</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameter. For example, the following command changes the protocol to RSTP for VLAN 455&#x3A;</p><p class="example1" id="1078470">&#x2D;&#x3E; spantree vlan 455 protocol rstp</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1119982"><span class="Bold">Note.  </span><span style="font-kerning:none;">When configuring the protocol value for a VLAN instance, MSTP is not an available option. This protocol is only supported on the flat mode instance.</span></p></td></tr></table></div></p><p class="text" id="1115209">To configure the protocol for the flat mode CIST instance, use either the <a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree protocol</a> command or the <a id="index_1115210" name="index_1115210"></a><a data-indexterm="%3Cindex%3Ebridge%20cist%20hello%20time%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree protocol</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> parameter. Note that both commands are available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following commands configure the protocol for the flat mode instance to MSTP&#x3A;</p><p class="example1" id="1078481">&#x2D;&#x3E; spantree cist protocol mstp</p><p class="example2" id="1120080">&#x2D;&#x3E; spantree protocol mstp</p><p class="heading2" id="1078503"><a id="XREF_52388__Configuring_VLAN_Bridge_Priority159" name="XREF_52388__Configuring_VLAN_Bridge_Priority159">Configuring the Bridge Priority</a></p><p class="text" id="1078505"><a id="159_text_1078505" name="159_text_1078505"></a>A bridge is identified within the Spanning Tree by its <a id="index_1078504" name="index_1078504"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:bridge%20ID" id="Spanning_Tree_Algorithm_and_Protocol_bridge_ID" name="Spanning_Tree_Algorithm_and_Protocol_bridge_ID"></a>bridge ID (an eight byte hex number). The first two bytes of the bridge ID contain a priority value and the remaining six bytes contain a bridge MAC address. </p><p class="text" id="1078507">The <a id="index_1078506" name="index_1078506"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:priority" id="Spanning_Tree_bridge_parameters_priority" name="Spanning_Tree_bridge_parameters_priority"></a>bridge priority is used to determine which bridge serves as the root of the Spanning Tree. The lower the priority value, the higher the priority. If more than one bridge have the same priority, then the bridge with the lowest MAC address becomes the root.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1120005"><span class="Bold">Note.  </span><span style="font-kerning:none;">Configuring a Spanning Tree bridge instance with a priority value that causes the instance to become the root is recommended, instead of relying on the comparison of switch base MAC addresses to determine the root.</span></p></td></tr></table></div></p><p class="text" id="1078510">If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then a priority value is assigned to each VLAN instance. If the switch is running in the flat Spanning Tree mode, the priority is assigned to the flat mode instance or a Multiple Spanning Tree Instance (MSTI). In both cases, the default priority value is assigned. Note that priority value for an MSTI must be a multiple of 4&#x30;96.</p><p class="text" id="1078514">To change the bridge priority value for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1094791" name="index_1094791"></a><a data-indexterm="%3Cindex%3Ebridge%20priority%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_priority%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_priority%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameter. For example, the following command changes the priority for VLAN 455 to 2559&#x30;&#x3A;</p><p class="example1" id="1078515">&#x2D;&#x3E; spantree vlan 455 priority 2559&#x30;</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1120031"><span class="Bold">Note.  </span><span style="font-kerning:none;">If PVST+ mode is enabled on the switch, then the priority values can be assigned only in the multiples of 4&#x30;96 to be compatible with the Cisco MAC Reduction mode; any other values result in an error message. </span></p></td></tr></table></div></p><p class="text" id="1115156">To change the bridge priority value for the flat mode CIST instance, use either the <a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command or the <a id="index_1115158" name="index_1115158"></a><a data-indexterm="%3Cindex%3Ebridge%20cist%20hello%20time%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> parameter. Note that both commands are available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following commands change the bridge priority value for the flat mode instance to 12288&#x3A;</p><p class="example1" id="1109521">&#x2D;&#x3E; spantree cist priority 12288</p><p class="example2" id="1120077">&#x2D;&#x3E; spantree priority 12288</p><p class="text" id="1115111">The bridge priority value is also configurable for a Multiple Spanning Tree Instance (MSTI). To configure this value for an MSTI, use the <a id="index_1094792" name="index_1094792"></a><a data-indexterm="%3Cindex%3Ebridge%20msti%20priority%20%3C%20default%20para%20font%20%3Ecommand" id="%3Cindex%3Ebridge_msti_priority_%3C_default_para_font_%3Ecommand" name="%3Cindex%3Ebridge_msti_priority_%3C_default_para_font_%3Ecommand"></a><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">msti</span> parameter and specify a priority value that is a multiple of 4&#x30;96. For example, the following command configures the priority value for MSTI 1&#x30; to 6144&#x30;&#x3A;</p><p class="example1" id="1078534">&#x2D;&#x3E; spantree msti 1&#x30; priority 6144&#x30;</p><p class="heading2" id="1078547"><a id="XREF_60948__Configuring_VLAN_Bridge_Hello_Time159" name="XREF_60948__Configuring_VLAN_Bridge_Hello_Time159">Configuring the Bridge Hello Time</a></p><p class="text" id="1078549"><a id="159_text_1078549" name="159_text_1078549"></a>The <a id="index_1078548" name="index_1078548"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:hello%20time" id="Spanning_Tree_bridge_parameters_hello_time" name="Spanning_Tree_bridge_parameters_hello_time"></a>bridge hello time interval is the number of seconds a bridge waits between transmissions of Configuration <a id="index_1078550" name="index_1078550"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Bridge%20Protocol%20Data%20Units" id="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units" name="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units"></a>BPDU. When a bridge is attempting to become the root or if it has become the root or a designated bridge, it sends Configuration BPDU out all forwarding ports once every hello time value. </p><p class="text" id="1113266">The hello time propagated in a <a id="index_1078551" name="index_1078551"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:root%20bridge" id="Spanning_Tree_Algorithm_and_Protocol_root_bridge" name="Spanning_Tree_Algorithm_and_Protocol_root_bridge"></a>root bridge Configuration BPDU is the value used by all other bridges in the tree for their own hello time. Therefore, if this value is changed for the root bridge, all other bridges associated with the same STP instance adopt this value as well. <div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120054"><span class="Bold">Note.  </span><span style="font-kerning:none;">Lowering the hello time interval improves the robustness of the Spanning Tree algorithm. Increasing the hello time interval lowers the overhead of Spanning Tree processing.</span></p></td></tr></table></div></p><p class="text" id="1078554">If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then a hello time value is defined for each VLAN instance. If the switch is running in the flat Spanning Tree mode, then a hello time value is defined for the single flat mode instance. In both cases, the default hello time value is used.</p><p class="text" id="1078557">To change the bridge hello time value for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1094793" name="index_1094793"></a><a data-indexterm="%3Cindex%3Ebridge%20hello%20time%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_hello_time%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_hello_time%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_97193__bridge_hello_time" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree hello-time</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameter. For example, the following command changes the hello time for VLAN 455 to 5 seconds&#x3A;</p><p class="example1" id="1110683">&#x2D;&#x3E; spantree vlan 455 hello&#x2D;time 5</p><p class="text" id="1078568">To change the bridge hello time value for the flat mode CIST instance, use either the <a href="../c_stp/c_stp.htm#XREF_97193__bridge_hello_time" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree hello-time</a> command or the <a href="../c_stp/c_stp.htm#XREF_97193__bridge_hello_time" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree hello-time</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> parameter. Note that both commands are available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following commands change the hello time value for the flat mode instance to 1&#x30;&#x3A;</p><p class="example1" id="1078572">&#x2D;&#x3E; spantree hello&#x2D;time 1&#x30;</p><p class="example2" id="1120083">&#x2D;&#x3E; spantree cist hello&#x2D;time 1&#x30;</p><p class="text" id="1078574">Note that the bridge hello time is not configurable for Multiple Spanning Tree Instances (MSTI). These instances inherit the hello time from the flat mode instance (CIST).</p><p class="heading2" id="1078579"><a id="XREF_88052__Configuring_VLAN_Bridge_Max_Age_Time159" name="XREF_88052__Configuring_VLAN_Bridge_Max_Age_Time159">Configuring the Bridge Max&#x2D;Age Time</a></p><p class="text" id="1078581"><a id="159_text_1078581" name="159_text_1078581"></a><a id="index_1078580" name="index_1078580"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:maximum%20age%20time" id="Spanning_Tree_bridge_parameters_maximum_age_time" name="Spanning_Tree_bridge_parameters_maximum_age_time"></a>The bridge max&#x2D;age time specifies how long, in seconds, the bridge retains Spanning Tree information it receives from Configuration <a id="index_1078582" name="index_1078582"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Bridge%20Protocol%20Data%20Units" id="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units" name="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units"></a>BPDU. When a bridge receives a BPDU, it updates its configuration information and the max age timer is reset. If the max age timer expires before the next BPDU is received, the bridge attempts to become the root, designated bridge, or change its root port.</p><p class="text" id="1078584">The max&#x2D;age time propagated in a <a id="index_1078583" name="index_1078583"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:root%20bridge" id="Spanning_Tree_Algorithm_and_Protocol_root_bridge" name="Spanning_Tree_Algorithm_and_Protocol_root_bridge"></a>root bridge Configuration BPDU is the value used by all other bridges in the tree for their own max&#x2D;age time. Therefore, if this value is changed for the root bridge, all other VLANs associated with the same instance adopt this value as well. </p><p>If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then a max&#x2D;age time value is defined for each VLAN instance. If the switch is running in the flat Spanning Tree mode, then the max&#x2D;age value is defined for the flat mode instance. In both cases, the default max&#x2D;age time is used.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="22.00px"><td><p class="CellBody_note_text" id="1120086"><span class="Bold">Note.  </span><span style="font-kerning:none;">Configuring a low max&#x2D;age time can cause Spanning Tree to reconfigure the topology more often.</span></p></td></tr></table></div></p><p class="text" id="1078589">To change the bridge max&#x2D;age time value for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1094805" name="index_1094805"></a><a data-indexterm="%3Cindex%3Ebridge%20max%20age%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_max_age%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_max_age%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_17450__spantree_max-age" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree max-age</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameter. For example, the following command changes the max&#x2D;age time for VLAN 455 to 1&#x30; seconds&#x3A;</p><p class="example1" id="1078591">&#x2D;&#x3E; spantree vlan 455 max&#x2D;age 1&#x30;</p><p class="text" id="1115270">To change the max&#x2D;age time value for the flat mode CIST instance, use either the <a href="../c_stp/c_stp.htm#XREF_17450__spantree_max-age" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree max-age</a> command or the <a id="index_1115271" name="index_1115271"></a><a data-indexterm="%3Cindex%3Ebridge%20cist%20hello%20time%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_17450__spantree_max-age" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree max-age</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> parameter. Note that both commands are available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following commands change the max&#x2D;age time value for the flat mode instance to 1&#x30;&#x3A;</p><p class="example1" id="1078604">&#x2D;&#x3E; spantree max&#x2D;age 1&#x30;</p><p class="example2" id="1120112">&#x2D;&#x3E; spantree cist max&#x2D;age 1&#x30;</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120118"><span class="Bold">Note.  </span><span style="font-kerning:none;">The max&#x2D;age time is not configurable for Multiple Spanning Tree Instances (MSTI). These instances inherit the max&#x2D;age time from the flat mode instance (CIST).</span></p></td></tr></table></div></p><p class="heading2" id="1078611"><a id="XREF_99943__Configuring_VLAN_Bridge_Forward_Delay_Time159" name="XREF_99943__Configuring_VLAN_Bridge_Forward_Delay_Time159">Configuring the Forward Delay Time for the Switch</a></p><p class="text" id="1078613"><a id="159_text_1078613" name="159_text_1078613"></a>The <a id="index_1078612" name="index_1078612"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:forward%20delay%20time" id="Spanning_Tree_bridge_parameters_forward_delay_time" name="Spanning_Tree_bridge_parameters_forward_delay_time"></a>bridge forward delay time specifies how long, in seconds, a port remains in the learning state while it is transitioning to a forwarding state. In addition, when a topology change occurs, the forward delay time value is used to <a id="index_1078614" name="index_1078614"></a><a data-indexterm="MAC%20addresses:aging%20time" id="MAC_addresses_aging_time" name="MAC_addresses_aging_time"></a>age out all dynamically learned addresses in the MAC address forwarding table. For more information about the MAC address table, see <a href="../n_srclrn/n_srclrn.htm#XREF_59738__1_Managing_Source_Learning" style="color:#0000ff;background-color:transparent;">Chapter 3&#44; “Managing Source Learning.”</a>&#160;</p><p class="text" id="1078620">The forward delay time propagated in a <a id="index_1078618" name="index_1078618"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:root%20bridge" id="Spanning_Tree_Algorithm_and_Protocol_root_bridge" name="Spanning_Tree_Algorithm_and_Protocol_root_bridge"></a>root bridge Configuration <a id="index_1078619" name="index_1078619"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:Bridge%20Protocol%20Data%20Units" id="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units" name="Spanning_Tree_Algorithm_and_Protocol_Bridge_Protocol_Data_Units"></a>BPDU is the value used by all other bridges in the tree for their own forward delay time. Therefore, if this value is changed for the root bridge, all other bridges associated with the same instance adopt this value as well.</p><p>If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then a forward delay time value is defined for each VLAN instance. If the switch is running in the flat Spanning Tree mode, then the forward delay time value is defined for the flat mode instance. In both cases, the default forward delay time is used.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120141"><span class="Bold">Note.  </span><span style="font-kerning:none;">Specifying a low forward delay time can cause temporary network loops, because packets can get forwarded before Spanning Tree configuration or change notices have reached all nodes in the network.</span></p></td></tr></table></div></p><p class="text" id="1117632">To change the bridge forward delay time value for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1117633" name="index_1117633"></a><a data-indexterm="%3Cindex%3Ebridge%20forward%20delay%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_forward_delay%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_forward_delay%3Cdefault_para_font%3E_command"></a><span style="color:#ff00ff;"><a href="../c_stp/c_stp.htm#XREF_83537__spantree_forward-delay" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree forward-delay</a></span><span style="color:#ff00ff;">&#160;</span>command with the vlan <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">parameter</span>. For example, the following command changes the forward delay time for VLAN 455 to 1&#x30; seconds&#x3A;</p><p class="example1" id="1115305">&#x2D;&#x3E; spantree vlan 455 forward&#x2D;delay 1&#x30;</p><p class="text" id="1115329">To change the forward&#x2D;delay time value for the flat mode CIST instance, use either the <a href="../c_stp/c_stp.htm#XREF_83537__spantree_forward-delay" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree forward-delay</a> command or the <a id="index_1115330" name="index_1115330"></a><a data-indexterm="%3Cindex%3Ebridge%20cist%20hello%20time%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_cist_hello_time%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_83537__spantree_forward-delay" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree forward-delay</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> parameter. Note that both commands are available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following commands change the forward&#x2D;delay time value for the flat mode instance to 1&#x30;&#x3A;</p><p class="example1" id="1078640">&#x2D;&#x3E; spantree forward&#x2D;delay 1&#x30;</p><p class="example2" id="1120167">&#x2D;&#x3E; spantree cist forward&#x2D;delay 1&#x30;</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120173"><span class="Bold">Note.  </span><span style="font-kerning:none;">The forward delay time is not configurable for Multiple Spanning Tree Instances (MSTI). These instances inherit the forward delay time from the flat mode instance (CIST).</span></p></td></tr></table></div></p><p class="heading2" id="1078654">Enabling&#47;Disabling the VLAN BPDU Switching Status</p><p class="text" id="1078655">BPDU are not switched on ports associated with VLANs that have Spanning Tree disabled. This can result in a network loop if the VLAN has redundant paths to one or more other switches. Allowing VLANs that have Spanning Tree disabled to forward BPDU to all ports in the VLAN, can help to avoid this problem. </p><p class="text" id="1109869">To enable or disable the switching of Spanning Tree BPDU for all VLAN and CIST instances when the switch is running in the per&#x2D;VLAN mode, use the <a href="../c_stp/c_stp.htm#XREF_22333__bridge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree bpdu-switching</a> command&#x3A;</p><p class="example1" id="1109878">&#x2D;&#x3E; spantree bpdu&#x2D;switching enable</p><p class="example2" id="1120196">&#x2D;&#x3E; spantree bpdu&#x2D;switching disable</p><p class="text" id="1109992">To enable or disable the switching of Spanning Tree BPDU for only the CIST instance when the switch is running in the flat mode, use the <a href="../c_stp/c_stp.htm#XREF_22333__bridge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree bpdu-switching</a> command&#x3A;</p><p class="example1" id="1110023">&#x2D;&#x3E; spantree cist bpdu&#x2D;switching enable</p><p class="example2" id="1120204">&#x2D;&#x3E; spantree cist bpdu&#x2D;switching disable</p><p class="text" id="1078657"><a id="index_1078656" name="index_1078656"></a><a data-indexterm="%3Cindex%3Ebridge%20slot/port%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_slot/port%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_slot_port%3Cdefault_para_font%3E_command"></a>To enable or disable BPDU switching on a VLAN, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameter along with <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree bpdu&#x2D;switching</span><span style="font-family : Courier New ; font-size : 9.00pt;">&#160;</span>command<span style="font-family : Courier New ; font-size : 9.00pt;">.</span>For example, the following commands enable BPDU switching on VLAN 1&#x30; and disable it on VLAN 2&#x30;&#x3A;</p><p class="example1" id="1078658">&#x2D;&#x3E; spantree vlan 1&#x30; bpdu&#x2D;switching enable</p><p class="example2" id="1120207">&#x2D;&#x3E; spantree vlan 2&#x30; bpdu&#x2D;switching disable</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120213"><span class="Bold">Note.  </span><span style="font-kerning:none;">Disabling BPDU switching on a Spanning Tree disabled VLAN must not cause network loops to go undetected.</span></p></td></tr></table></div></p><p class="heading2" id="1078662"><a id="XREF_12774__Configuring_the_Path_Cost_Mode159" name="XREF_12774__Configuring_the_Path_Cost_Mode159">Configuring the Path Cost Mode</a></p><p class="text" id="1078663"><a id="159_text_1078663" name="159_text_1078663"></a>The path cost mode controls whether the switch uses a 16&#x2D;bit port path cost (PPC) or a 32&#x2D;bit PPC. When a 32&#x2D;bit PPC switch connects to a 16&#x2D;bit PPC switch, the 32&#x2D;bit switch has a higher PPC value that advertises an inferior path cost to the 16&#x2D;bit switch. In this case, it is desirable to set the 32&#x2D;bit switch to use STP or RSTP with a 16&#x2D;bit PPC value. </p><p class="text" id="1078664">The path cost mode is automatically set to use a 16&#x2D;bit value for all ports that are associated with an STP instance or an RSTP instance and a 32&#x2D;bit value for all ports associated with an MSTP value. It is also possible to set the path cost mode to always use a 32&#x2D;bit regardless of which protocol is active.</p><p class="text" id="1078668">To change the path cost mode, use the <a id="index_1094810" name="index_1094810"></a><a data-indexterm="%3Cindex%3Ebridge%20path%20cost%20mode%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_path_cost_mode%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_path_cost_mode%3Cdefault_para_font%3E_command"></a><a id="index_1111750" name="index_1111750"></a><a data-indexterm="%3Cindex%3Ebridge%20max%20age%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_max_age%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_max_age%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_97321__bridge_path_cost_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree path-cost-mode</a> command and specify either <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">auto</span> (uses PPC value based on protocol) or <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">32bit</span> (always use a 32&#x2D;bit PPC value). For example, the following command changes the default path cost mode from auto to 32&#x2D;bit&#x3A;</p><p class="example1" id="1078669">&#x2D;&#x3E; spantree path&#x2D;cost&#x2D;mode 32bit</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="70.00px"><td><p class="CellBody_note_text" id="1120239"><span class="Bold">Note.  </span><span style="font-kerning:none;">Cisco supports two default path cost modes&#x3A; long or short just like in OmniSwitch per&#x2D;VLAN implementation. If you have configured PVST+ mode in the OmniSwitch, it is recommended that the same default path cost mode must be configured in the same way in all the switches, so that, the path costs for similar interface types are consistent when connecting ports between OmniSwitch and Cisco switches.</span></p></td></tr></table></div></p><p class="heading2" id="1078652">Using Automatic VLAN Containment</p><p class="text" id="1079761">In a Multiple Spanning Tree (MST) configuration, it is possible for a port that belongs to a VLAN that is not a member of an instance to become the root port for that instance. This can cause a topology change that could lead to a loss of connectivity between VLANs&#47;switches. Enabling <a id="index_1084496" name="index_1084496"></a><a data-indexterm="Spanning%20Tree%20bridge%20parameters:automatic%20VLAN%20containment" id="Spanning_Tree_bridge_parameters_automatic_VLAN_containment" name="Spanning_Tree_bridge_parameters_automatic_VLAN_containment"></a>Automatic VLAN Containment (AVC) helps to prevent this from happening by making such a port an undesirable choice for the root. </p><p class="text" id="1080001">When AVC is enabled, it identifies undesirable ports and automatically configures them with an infinite path cost value. For example, in the following diagram a link exists between VLAN 2 on two different switches. The ports that provide this link belong to default VLAN 1 but are tagged with VLAN 2. In addition, VLAN 2 is mapped to MSTI 1 on both switches.<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_53.svg" height="151.664103" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="579.569906"></object></p><p class="FigureTitle" id="1080085">Figure 6&#x2D;9 &#x3A;  Automatic VLAN Containment &#x2D; AVC not enabled</p><p class="text" id="1129289">In the above diagram, port 4&#47;2 is the Root port and port 5&#47;1 is a Designated port for MSTI 1. AVC is not enabled. If another link with the same speed and lower port numbers is added to default VLAN 1 on both switches, the new link becomes the root for MSTI 1 and the tagged link between VLAN 2 is blocked, as shown below&#x3A;<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_54.svg" height="150.664103" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="579.569906"></object></p><p class="FigureTitle" id="1080004">Figure 6&#x2D;1&#x30; &#x3A;  Automatic VLAN Containment &#x2D; AVC enabled</p><p class="text" id="1129311">If AVC was enabled in the above example, AVC would have assigned the new link an infinite path cost value that would make this link undesirable as the root for MSTI 1. </p><p class="text" id="1091550">Balancing VLANs across links according to their Multiple Spanning Tree Instance (MSTI) grouping is highly recommended to ensure that there is not a loss of connectivity during any possible topology changes. Enabling AVC on the switch is another way to prevent undesirable ports from becoming the root for an MSTI.</p><p class="text" id="1080191">To change the default status of the AVC on the switch and to globally enable this feature for all MSTIs, use the <a id="index_1094811" name="index_1094811"></a><a data-indexterm="%3Cindex%3Ebridge%20auto-vlan-containment%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_auto-vlan-containment%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_auto-vlan-containment%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_97899__bridge_auto-vlan-containment" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree auto-vlan-containment</a> command. Once AVC is globally enabled, then it is possible to disable AVC for individual MSTIs using the same command. For example, the following commands globally enable AVC and then disable it for MSTI 1&#x30;&#x3A;</p><p class="example1" id="1080208">&#x2D;&#x3E; spantree auto&#x2D;vlan&#x2D;containment enable<br/>&#x2D;&#x3E; spantree msti 1&#x30; auto&#x2D;vlan&#x2D;containment disable</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1120265"><span class="Bold">Note.  </span><span style="font-kerning:none;">An administratively set port path cost takes precedence and prevents AVC configuration of the path cost. The exception to this is if the port path cost is administratively set to zero, which resets the path cost to the default value. In addition, AVC does not have any effect on root bridges.</span></p></td></tr></table></div></p><p class="heading1" id="1037293"><a id="XREF_80803__Configuring_STP_Port_Parameters159" name="XREF_80803__Configuring_STP_Port_Parameters159">Configuring STP Port Parameters</a></p><p class="text" id="1078674"><a id="159_text_1078674" name="159_text_1078674"></a>The following sections provide information and procedures for using CLI commands to configure <a id="index_1078673" name="index_1078673"></a><a data-indexterm="Spanning%20Tree%20port%20parameters" id="Spanning_Tree_port_parameters" name="Spanning_Tree_port_parameters"></a>STP port parameters. These parameters determine the behavior of a port for a specific Spanning Tree instance.</p><p class="text" id="1095827">When a switch is running in the per&#x2D;VLAN STP mode, each VLAN is in essence a virtual STP bridge with its own STP instance and configurable parameters. To change STP port parameters while running in this mode, a VLAN ID is specified to identify the VLAN STP instance associated with the specified port. When a switch is running in the flat Spanning Tree mode, VLAN 1 is specified for the VLAN ID.</p><p class="text" id="1095829">Only <a id="index_1095828" name="index_1095828"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:bridged%20ports" id="Spanning_Tree_Algorithm_and_Protocol_bridged_ports" name="Spanning_Tree_Algorithm_and_Protocol_bridged_ports"></a><a data-indexterm="ports:Spanning%20Tree%20parameters" id="ports_Spanning_Tree_parameters" name="ports_Spanning_Tree_parameters"></a>bridged ports participate in the Spanning Tree Algorithm. A port is considered bridged if it meets all the following criteria&#x3A;</p><p class="bullet" id="1078678"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port is either a fixed (non&#x2D;mobile) port, an 8&#x30;2.1Q tagged port, or a link aggregate logical port.</p><p class="bullet" id="1078679"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Spanning tree is enabled on the port.</p><p class="bullet" id="1078680"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port is assigned to a VLAN that has Spanning Tree enabled.</p><p class="bullet" id="1078681"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port state (forwarding or blocking) is dynamically determined by the Spanning Tree Algorithm, not manually set.</p><p class="text" id="1078695">The following is a summary of Spanning Tree port configuration commands. For more information about these commands, see the <span class="Times_italics" style="font-style:Italic;background-color:transparent;"><span data-keyref="CLI Reference Guide">OmniSwitch AOS Release 8 CLI Reference Guide</span>. </span><div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="201.60px"/><col width="384.00px"/><thead><tr height="28.67px"><th><p class="CellHeading" id="1122171">Commands</p></th><th><p class="CellHeading" id="1122173">Used for ...</p></th></tr></thead><tr height="39.33px"><td><p class="CellBody" id="1122178" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_91523__bridge_cist_slot/port" style="color:#0000ff;background-color:transparent;">spantree cist</a></span></p></td><td><p class="CellBody" id="1122180">Configuring the port Spanning Tree status for the single flat mode instance.</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1122185" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_54312__bridge_1x1_slot/port" style="color:#0000ff;background-color:transparent;">spantree vlan</a></span></p></td><td><p class="CellBody" id="1122187">Configuring the port Spanning Tree status for a VLAN instance.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1122192" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="color:#0000ff;background-color:transparent;">spantree priority</a></span></p></td><td><p class="CellBody" id="1122194">Configuring the priority value for the flat mode CIST instance, a Multiple Spanning Tree Instance (MSTI), or a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1122329" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="color:#0000ff;background-color:transparent;">spantree loop-guard</a></span></p></td><td><p class="CellBody" id="1122331">Enables or disables the STP loop&#x2D;guard on a port or link aggregate.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122199" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_93352__bridge_cist_slot/port_path_cost" style="color:#0000ff;background-color:transparent;">spantree cist path-cost</a></p></td><td><p class="CellBody" id="1122201">Configuring the port path cost value for the single flat mode instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122206" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_92334__bridge_msti_slot/port_path_cost" style="color:#0000ff;background-color:transparent;">spantree msti path-cost</a></p></td><td><p class="CellBody" id="1122208">Configuring the port path cost value for a Multiple Spanning Tree Instance (MSTI).</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1122213" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_33850__bridge_1x1_slot/port_path_cost" style="color:#0000ff;background-color:transparent;">spantree vlan path-cost</a></span></p></td><td><p class="CellBody" id="1122215">Configuring the port path cost value for a VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122220" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_38782__bridge_cist_slot/port_mode" style="color:#0000ff;background-color:transparent;">spantree cist mode</a></p></td><td><p class="CellBody" id="1122222">Configuring the port Spanning Tree mode (dynamic or manual) for the single flat mode instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122227" style="font-weight:Bold;"><span style="font-weight:normal;"><a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="color:#0000ff;background-color:transparent;">spantree loop-guard</a></span></p></td><td><p class="CellBody" id="1122229">Configuring the port Spanning Tree mode (dynamic or manual) for a VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122234" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_97366__bridge_cist_slot/port_connection" style="color:#0000ff;background-color:transparent;">spantree cist connection</a></p></td><td><p class="CellBody" id="1122236">Configuring the port connection type for the single flat mode instance.</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1122241" style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_13508__bridge_1x1_slot/port_connection" style="color:#0000ff;background-color:transparent;">spantree vlan connection</a></p></td><td><p class="CellBody" id="1122243">Configuring the port connection type for a VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122248"><a href="../c_stp/c_stp.htm#XREF_66602__bridge_cist_slot/port_admin-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist admin-edge</a></p></td><td><p class="CellBody" id="1122250">Configures the connection type for a port or an aggregate of ports for the flat mode Common and Internal Spanning Tree (CIST).</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122255"><a href="../c_stp/c_stp.htm#XREF_11133__bridge_1x1_slot/port_admin-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan admin-edge</a></p></td><td><p class="CellBody" id="1122257">Configures the connection type for a port or an aggregate of ports for a per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1122262"><a href="../c_stp/c_stp.htm#XREF_22421__bridge_cist_slot/port_auto-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist auto-edge</a></p></td><td><p class="CellBody" id="1122264">Configures a port or an aggregate of ports for the flat mode Common and Internal Spanning Tree (CIST) as an edge port, automatically. </p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122269"><a href="../c_stp/c_stp.htm#XREF_68621__bridge_1x1_slot/port_auto-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan auto-edge</a></p></td><td><p class="CellBody" id="1122271">Configures a port or an aggregate of ports for the per&#x2D;VLAN mode VLAN instance as an edge port, automatically.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1122276"><a href="../c_stp/c_stp.htm#XREF_50004__bridge_cist_slot/port_restricted-role" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist restricted-role</a></p></td><td><p class="CellBody" id="1122278">Configures the restricted role status for a port or an aggregate of ports for the flat mode Common and Internal Spanning Tree (CIST) as a restricted role port.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122283"><a href="../c_stp/c_stp.htm#XREF_10118__bridge_1x1_slot/port_restricted-role" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan restricted-role</a></p></td><td><p class="CellBody" id="1122285">Configures a port or an aggregate of ports for the per&#x2D;VLAN mode VLAN instance as a restricted role port.</p></td></tr><tr height="55.33px"><td><p class="CellBody" id="1122290"><a href="../c_stp/c_stp.htm#XREF_73431__bridge_cist_slot/port_restricted-tcn" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist restricted-tcn</a></p></td><td><p class="CellBody" id="1122292">Configures a port or an aggregate of ports for the flat mode Common and Internal Spanning Tree (CIST) to support the restricted TCN capability.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122297"><a href="../c_stp/c_stp.htm#XREF_45282__bridge_1x1_slot/port_restricted-tcn" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan restricted-tcn</a></p></td><td><p class="CellBody" id="1122299">Configures a port or an aggregate of ports for the per&#x2D;VLAN mode VLAN instance to support the restricted TCN capability.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122304"><a href="../c_stp/c_stp.htm#XREF_44594__bridge_cist_txholdcount" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist txholdcount</a></p></td><td><p class="CellBody" id="1122306">Limits the transmission of BPDU through a given port for the flat mode Common and Internal Spanning Tree (CIST).</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1122311"><a href="../c_stp/c_stp.htm#XREF_69949__bridge_1x1_txholdcount" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan txholdcount</a></p></td><td><p class="CellBody" id="1122313">Limits the transmission of BPDU through a given port for the per&#x2D;VLAN mode VLAN instance.</p></td></tr><tr height="39.33px"><td><p class="CellBody_cli_cmd" id="1122318"><a href="../c_stp/c_stp.htm#XREF_98747__spantree_pvst+compatibility" style="font-kerning:none;color:#0000ff;background-color:transparent;">spantree pvst+compatibility</a></p></td><td><p class="CellBody" id="1122320">Configures the type of BPDU to be used on a port when PVST+ mode is enabled.</p></td></tr></table></div></p><p class="text" id="1078856">The following sections provide information and procedures for using Spanning Tree port configuration commands and also includes command examples.</p><p class="heading2" id="1078876">Enabling&#47;Disabling Spanning Tree on a Port</p><p class="text" id="1078877">Spanning Tree is automatically enabled on all eligible ports. When Spanning Tree is disabled on a port, the port is put in a forwarding state for the specified instance. For example, if a port is associated with both VLAN 1&#x30; and VLAN 2&#x30; and Spanning Tree is disabled on the port for VLAN 2&#x30;, the port state is set to forwarding for VLAN 2&#x30;. However, the VLAN 1&#x30; instance still controls the port state as it relates to VLAN 1&#x30;. This example assumes the switch is running in the per&#x2D;VLAN Spanning Tree mode.</p><p class="text" id="1078878">If the switch is running in the flat Spanning Tree mode, then disabling the port Spanning Tree status applies across all VLANs associated with the port. The flat mode instance is specified as the instance associated with the port, even if the port is associated with multiple VLANs. </p><p class="text" id="1078881">To change the port Spanning Tree status for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_54312__bridge_1x1_slot/port" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan</a> command. For example, the following commands enable Spanning Tree on port 8&#47;1 for VLAN 1&#x30; and disable STP on port 6&#47;2 for VLAN 2&#x30;&#x3A;</p><p class="example1" id="1078883">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;1 enable</p><p class="example2" id="1120298">&#x2D;&#x3E; spantree vlan 2&#x30; port 6&#47;2 disable</p><p class="text" id="1078892">To change the port Spanning Tree status for the flat mode instance, use the <a href="../c_stp/c_stp.htm#XREF_91523__bridge_cist_slot/port" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist</a> command. Note that this command is available when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following command disables the Spanning Tree status on port 1&#47;24 for the flat mode instance&#x3A;</p><p class="example1" id="1078896">&#x2D;&#x3E; spantree cist port 1&#47;24 disable</p><p class="heading3" id="1078899">Spanning Tree on <a id="index_1078898" name="index_1078898"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:link%20aggregate%20ports" id="Spanning_Tree_port_parameters_link_aggregate_ports" name="Spanning_Tree_port_parameters_link_aggregate_ports"></a><a data-indexterm="link%20aggregation:Spanning%20Tree%20parameters" id="link_aggregation_Spanning_Tree_parameters" name="link_aggregation_Spanning_Tree_parameters"></a>Link Aggregate Ports</p><p class="text" id="1109195">Physical ports that belong to a link aggregate do not participate in the Spanning Tree Algorithm. Instead, the algorithm is applied to the aggregate logical link (virtual port) that represents a collection of physical ports. </p><p class="text" id="1109196">To enable or disable the Spanning Tree status for a link aggregate, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree vlan </span>or<span class="Times_Bold" style="font-weight:Bold;background-color:transparent;"> spantree cist </span>commands described above but specify a link aggregate control (ID) number instead of a slot and port. For example, the following command disables Spanning Tree for the link aggregate 1&#x30; association with VLAN 755&#x3A;</p><p class="example1" id="1078902">&#x2D;&#x3E; spantree vlan 755 linkagg 1&#x30; disable</p><p class="text" id="1109203">For more information about configuring an aggregate of ports, see <a href="../n_omchnl/n_omchnl.htm#XREF_55650__1_Configuring_Link_Aggregation23" style="color:#0000ff;background-color:transparent;">Chapter&#160;9&#44; “Configuring Static Link Aggregation&#44;”</a> and <a href="../n_lacp/n_lacp.htm#XREF_55650__1_Configuring_Link_Aggregation27" style="color:#0000ff;background-color:transparent;">Chapter&#160;10&#44; “Configuring Dynamic Link Aggregation.”</a></p><p class="heading2" id="1122343">Enabling&#47;Disabling Loop&#x2D;guard</p><p class="text" id="1122344">By default, loop&#x2D;guard is disabled on ports associated with VLANs that have Spanning Tree enabled. This feature, when enabled prevents inconsistencies that cause network loops.</p><p class="text" id="1122348">Use the <span style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree loop-guard</a></span> command to enable or disable loop&#x2D;guard on a port or link aggregate. For example, the following commands enable and disable loop&#x2D;guard on port 1&#47;2 of chassis 1&#x3A;</p><p class="screen2" id="1122349"><br/></p><p class="screen2" id="1122350">&#x2D;&#x3E; spantree port 1&#47;1&#47;2 loop&#x2D;guard enable</p><p class="screen2" id="1122351">&#x2D;&#x3E; spantree port 1&#47;1&#47;2 loop&#x2D;guard disable</p><p class="text" id="1122352">To enable or disable loop&#x2D;guard on a link aggregate&#x3A;</p><p class="screen2" id="1122353"><br/></p><p class="screen2" id="1122354">&#x2D;&#x3E; spantree linkagg 1 loop&#x2D;guard enable</p><p class="screen2" id="1122355">&#x2D;&#x3E; spantree linkagg 1 loop&#x2D;guard disable</p><p class="note" id="1122356"><span class="Times_Bold">Note </span><br/></p><p class="note_text" id="1122360">Use the <a href="../c_stp/c_stp.htm#XREF_36476__bridge_port_10gig_os8800optimized" style="font-weight:Bold;color:#0000ff;background-color:transparent;">show spantree</a> and related commands to view the loop&#x2D;guard related information for per&#x2D;port, per&#x2D;VLAN, CIST or MSTI instances.</p><p class="heading2" id="1118680"><a id="XREF_11777__Configuring_Port_Priority159" name="XREF_11777__Configuring_Port_Priority159">Configuring Port Priority</a></p><p class="text" id="1078916"><a id="159_text_1078916" name="159_text_1078916"></a>A bridge port is identified within the Spanning Tree by its <a id="index_1078915" name="index_1078915"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20ID" id="Spanning_Tree_Algorithm_and_Protocol_port_ID" name="Spanning_Tree_Algorithm_and_Protocol_port_ID"></a>Port ID (a 16&#x2D;bit or 32&#x2D;bit hex number). The first 4 bits of the Port ID contain a priority value and the remaining 12 bits contain the physical switch port number. The <a id="index_1078917" name="index_1078917"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:priority" id="Spanning_Tree_port_parameters_priority" name="Spanning_Tree_port_parameters_priority"></a>port priority is used to determine which port offers the best path to the root when multiple paths have the same path cost. The port with the highest priority (lowest numerical priority value) is selected and the others are put into a blocking state. If the priority values are the same for all ports in the path, then the port with the lowest physical switch port number is selected.</p><p class="text" id="1078918">Spanning Tree is automatically enabled on a port and the default port priority value is set. If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then the port priority applies to the specified VLAN instance associated with the port. If the switch is running in the flat Spanning Tree mode, then the port priority applies across all VLANs associated with the port. The flat mode instance is specified as the port instance, even if the port is associated with multiple VLANs. </p><p class="text" id="1078921">To change the port priority value for a VLAN regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1094813" name="index_1094813"></a><a data-indexterm="%3Cindex%3Ebridge%20slot/port%20priority%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_slot/port_priority%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_slot_port_priority%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">port</span> parameters. For example, the following command sets the priority value as 3 for the port 1&#x30;&#47;1 association with VLAN ID 1&#x30;&#x3A;</p><p class="example1" id="1078923">&#x2D;&#x3E; spantree vlan 1&#x30; port 1&#x30;&#47;1 priority 3</p><p class="text" id="1078932">To change the port priority value for the flat mode instance, use the <a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span> and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">port</span> parameters. Note that this command is available when the switch is running in either per&#x2D;VLAN or flat mode. An instance number is not required. For example, the following command changes the priority value for port 1&#47;24 for the flat mode instance to 15&#x3A;</p><p class="example1" id="1078936">&#x2D;&#x3E; spantree cist port 1&#47;24 priority 15</p><p class="text" id="1078938">The port priority value is also configurable for a Multiple Spanning Tree Instance (MSTI). To configure this value for an MSTI, use the <a href="../c_stp/c_stp.htm#XREF_21448__bridge_priority" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree priority</a> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">msti</span> and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">port</span> parameters. For example, the following command configures the priority value for port 1&#47;12 for MSTI 1&#x30; to 5&#x3A;</p><p class="example1" id="1078942">&#x2D;&#x3E; spantree msti 1&#x30; port 1&#47;12 priority 5</p><p class="text" id="1117043">Note that configuring the port priority value for a MSTI is allowed in both modes (per&#x2D;VLAN and flat) only when the Spanning Tree protocol is set to MSTP. </p><p class="heading3" id="1078948">Port Priority on <a id="index_1078947" name="index_1078947"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:link%20aggregate%20ports" id="Spanning_Tree_port_parameters_link_aggregate_ports" name="Spanning_Tree_port_parameters_link_aggregate_ports"></a><a data-indexterm="link%20aggregation:Spanning%20Tree%20parameters" id="link_aggregation_Spanning_Tree_parameters" name="link_aggregation_Spanning_Tree_parameters"></a>Link Aggregate Ports</p><p class="text" id="1078949">Physical ports that belong to a link aggregate do not participate in the Spanning Tree Algorithm. Instead, the algorithm is applied to the aggregate logical link (virtual port) that represents a collection of physical ports. </p><p class="text" id="1078950">To change the priority for a link aggregate, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree priority </span>command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">cist</span>, <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">msti</span>, or <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> parameters, as described above but specify a link aggregate control number instead of a slot and port number. For example, the following command sets the priority for the link aggregate 1&#x30; association with VLAN 755 to 9&#x3A;</p><p class="example1" id="1078951">&#x2D;&#x3E; spantree vlan 755 linkagg 1&#x30; priority 9</p><p class="text" id="1078954">For more information about configuring an aggregate of ports, see <a href="../n_omchnl/n_omchnl.htm#XREF_55650__1_Configuring_Link_Aggregation23" style="color:#0000ff;background-color:transparent;">Chapter&#160;9&#44; “Configuring Static Link Aggregation&#44;”</a> and <a href="../n_lacp/n_lacp.htm#XREF_55650__1_Configuring_Link_Aggregation27" style="color:#0000ff;background-color:transparent;">Chapter&#160;10&#44; “Configuring Dynamic Link Aggregation.”</a></p><p class="heading2" id="1078973"><a id="XREF_44531__Configuring_Port_Path_Cost159" name="XREF_44531__Configuring_Port_Path_Cost159">Configuring Port Path Cost</a></p><p class="text" id="1078975" style="margin-top : 4.00pt;"><a id="159_text_1078975" name="159_text_1078975"></a>The <a id="index_1078974" name="index_1078974"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:path%20cost" id="Spanning_Tree_port_parameters_path_cost" name="Spanning_Tree_port_parameters_path_cost"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:path%20cost" id="Spanning_Tree_Algorithm_and_Protocol_path_cost" name="Spanning_Tree_Algorithm_and_Protocol_path_cost"></a>path cost value specifies the contribution of a port to the path cost towards the root bridge that includes the port. The root path cost is the sum of all path costs along this same path and is the value advertised in Configuration BPDU transmitted from active Spanning Tree ports. The lower the cost value, the closer the switch is to the root.</p><p class="text" id="1078976">The type of path cost value used depends on which path cost mode is active (automatic or 32&#x2D;bit). If the path cost mode is set to automatic, a 16&#x2D;bit value is used when STP or RSTP is the active protocol and a 32&#x2D;bit value is used when MSTP is the active protocol. If the mode is set to 32&#x2D;bit, then a 32&#x2D;bit path cost value is used regardless of which protocol is active. See <a  href="#XREF_12774__Configuring_the_Path_Cost_Mode159" style="color:#0000ff;background-color:transparent;">Configuring the Path Cost Mode</a> for more information.</p><p class="text" id="1078980">If a 32&#x2D;bit path cost value is in use and the <span class="Times_italics" style="font-style:Italic;background-color:transparent;">path_cost</span> is set to zero, the following IEEE 8&#x30;2.1t recommended default path cost values based on link speed are used&#x3A;</p><p><span style="font-size : 12.00pt;"><div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="96.00px"/><col width="172.80px"/><col width="307.20px"/><thead><tr height="45.33px"><th><p class="CellHeading" id="1128103" style="text-align:center;">Link Speed</p></th><th><p class="CellHeading" id="1128105" style="text-align:center;">32&#x2D;bit Path Cost <br/>Physical Port</p></th><th><p class="CellHeading" id="1128107" style="text-align:center;">32&#x2D;bit Path Cost <br/>Link Aggregate (2&#47;4&#47;8&#47;16 Port)</p></th></tr></thead><tr height="23.33px"><td><p class="CellBody" id="1128109" style="text-align:center;">1&#x30; Mbps</p></td><td><p class="CellBody" id="1128111" style="text-align:center;">2&#x30;&#x30;&#x30;&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128113" style="text-align:center;">12&#x30;&#x30;&#x30;&#x30;&#x30;, 8&#x30;&#x30;&#x30;&#x30;&#x30;, 6&#x30;&#x30;&#x30;&#x30;&#x30;, 4&#x30;&#x30;&#x30;&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128115" style="text-align:center;">1&#x30;&#x30; Mbps</p></td><td><p class="CellBody" id="1128117" style="text-align:center;">2&#x30;&#x30;&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128119" style="text-align:center;">12&#x30;&#x30;&#x30;&#x30;, 8&#x30;&#x30;&#x30;&#x30;, 6&#x30;&#x30;&#x30;&#x30;, 4&#x30;&#x30;&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128121" style="text-align:center;">1G</p></td><td><p class="CellBody" id="1128123" style="text-align:center;">2&#x30;&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128125" style="text-align:center;">18&#x30;&#x30;&#x30;, 16&#x30;&#x30;&#x30;, 14&#x30;&#x30;&#x30;, 12&#x30;&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128127" style="text-align:center;">2.5G</p></td><td><p class="CellBody" id="1128129" style="text-align:center;">8&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128131" style="text-align:center;">76&#x30;&#x30;, 72&#x30;&#x30;, 68&#x30;&#x30;, 64&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128133" style="text-align:center;">5G</p></td><td><p class="CellBody" id="1128135" style="text-align:center;">4&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128137" style="text-align:center;">38&#x30;&#x30;, 36&#x30;&#x30;, 34&#x30;&#x30;, 32&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128139" style="text-align:center;">1&#x30;G</p></td><td><p class="CellBody" id="1128141" style="text-align:center;">2&#x30;&#x30;&#x30;</p></td><td><p class="CellBody" id="1128143" style="text-align:center;">19&#x30;&#x30;, 18&#x30;&#x30;, 17&#x30;&#x30;, 16&#x30;&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128145" style="text-align:center;">25G</p></td><td><p class="CellBody" id="1128147" style="text-align:center;">8&#x30;&#x30;</p></td><td><p class="CellBody" id="1128149" style="text-align:center;">78&#x30;, 76&#x30;, 74&#x30;, 72&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128151" style="text-align:center;">4&#x30;G</p></td><td><p class="CellBody" id="1128153" style="text-align:center;">5&#x30;&#x30;</p></td><td><p class="CellBody" id="1128155" style="text-align:center;">48&#x30;, 46&#x30;, 44&#x30;, 42&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128157" style="text-align:center;">5&#x30;G</p></td><td><p class="CellBody" id="1128159" style="text-align:center;">4&#x30;&#x30;</p></td><td><p class="CellBody" id="1128161" style="text-align:center;">38&#x30;, 36&#x30;, 34&#x30;, 32&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1128163" style="text-align:center;">1&#x30;&#x30;G</p></td><td><p class="CellBody" id="1128165" style="text-align:center;">2&#x30;&#x30;</p></td><td><p class="CellBody" id="1128167" style="text-align:center;">18&#x30;, 16&#x30;, 14&#x30;, 12&#x30;</p></td></tr></table></div></span></p><p class="text" id="1128095"><br/></p><p class="text" id="1128097">Is a 16&#x2D;bit path cost value is in use and the <span class="Times_italics" style="font-style:Italic;background-color:transparent;">path_cost</span> is set to zero, the following IEEE 8&#x30;2.1D recommended default <a id="index_1079004" name="index_1079004"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:path%20cost" id="Spanning_Tree_Algorithm_and_Protocol_path_cost" name="Spanning_Tree_Algorithm_and_Protocol_path_cost"></a>path cost values based on link speed are used&#x3A;<div align="left"><table class="Defaults_Table" style="max-width: 100% ;height: auto;"><col width="96.00px"/><col width="172.80px"/><col width="307.20px"/><thead><tr height="45.33px"><th><p class="CellHeading" id="1079007" style="text-align:center;">Link Speed</p></th><th><p class="CellHeading" id="1079009" style="text-align:center;">16&#x2D;bit Path Cost <br/>Physical Port</p></th><th><p class="CellHeading" id="1127866" style="text-align:center;">16&#x2D;bit Path Cost Link Aggregate (2&#47;4&#47;8&#47;16 Port)</p></th></tr></thead><tr height="23.33px"><td><p class="CellBody" id="1079012" style="text-align:center;">1&#x30; Mbps</p></td><td><p class="CellBody" id="1079014" style="text-align:center;">1&#x30;&#x30;</p></td><td><p class="CellBody" id="1127868" style="text-align:center;">6&#x30;, 4&#x30;, 3&#x30;, 2&#x30;</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079016" style="text-align:center;">1&#x30;&#x30; Mbps</p></td><td><p class="CellBody" id="1079018" style="text-align:center;">19</p></td><td><p class="CellBody" id="1127870" style="text-align:center;">12, 9, 7, 5</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079020" style="text-align:center;">1G</p></td><td><p class="CellBody" id="1079022" style="text-align:center;">4</p></td><td><p class="CellBody" id="1127872" style="text-align:center;">3</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079024" style="text-align:center;">2.5G</p></td><td><p class="CellBody" id="1079026" style="text-align:center;">4</p></td><td><p class="CellBody" id="1127874" style="text-align:center;">3</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079028" style="text-align:center;">5G</p></td><td><p class="CellBody" id="1079030" style="text-align:center;">3</p></td><td><p class="CellBody" id="1127876" style="text-align:center;">2</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079032" style="text-align:center;">1&#x30;G</p></td><td><p class="CellBody" id="1079034" style="text-align:center;">2</p></td><td><p class="CellBody" id="1127878" style="text-align:center;">1</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1127974" style="text-align:center;">25G</p></td><td><p class="CellBody" id="1127976" style="text-align:center;">1</p></td><td><p class="CellBody" id="1127978" style="text-align:center;">1</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1127968" style="text-align:center;">4&#x30;G</p></td><td><p class="CellBody" id="1127970" style="text-align:center;">1</p></td><td><p class="CellBody" id="1127972" style="text-align:center;">1</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1127962" style="text-align:center;">5&#x30;G</p></td><td><p class="CellBody" id="1127964" style="text-align:center;">1</p></td><td><p class="CellBody" id="1127966" style="text-align:center;">1</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1127956" style="text-align:center;">1&#x30;&#x30;G</p></td><td><p class="CellBody" id="1127958" style="text-align:center;">1</p></td><td><p class="CellBody" id="1127960" style="text-align:center;">1</p></td></tr></table></div></p><p class="text" id="1079035">Spanning Tree is automatically enabled on a port and the path cost is set to the default value. If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then the port path cost applies to the specified VLAN instance associated with the port. If the switch is running in the flat Spanning Tree mode, then the port path cost applies across all VLANs associated with the port. The flat mode instance is specified as the port instance, even if the port is associated with other VLANs. </p><p class="text" id="1079044">The <a id="index_1094815" name="index_1094815"></a><a data-indexterm="%3Cindex%3Ebridge%201x1%20slot/port%20path%20cost%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_1x1_slot/port_path_cost%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_1x1_slot_port_path_cost%3Cdefault_para_font%3E_command"></a><a href="../c_stp/c_stp.htm#XREF_33850__bridge_1x1_slot/port_path_cost" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan path-cost</a> command configures the port path cost value for a VLAN instance when the switch is running in either mode (per&#x2D;VLAN or flat). For example, the following command configures a 16&#x2D;bit path cost value for port 8&#47;1 for VLAN 1&#x30; to 19 (the port speed is 1&#x30;&#x30; MB, 19 is the recommended value)&#x3A;</p><p class="example1" id="1109935">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;1 path&#x2D;cost 19</p><p class="text" id="1079049">To change the port path cost value for the flat mode instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_93352__bridge_cist_slot/port_path_cost" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist path-cost</a> command. For example, the following command configures a 32&#x2D;bit path cost value for port 1&#47;24 for the flat mode instance to 2&#x30;,&#x30;&#x30;&#x30; (the port speed is 1 GB, 2&#x30;,&#x30;&#x30;&#x30; is the recommended value)&#x3A;</p><p class="example1" id="1079053">&#x2D;&#x3E; spantree cist port 1&#47;24 path&#x2D;cost 2&#x30;&#x30;&#x30;&#x30;</p><p class="text" id="1079055">The port path cost value is also configurable for a Multiple Spanning Tree Instance (MSTI). To configure this value for an MSTI, use the <a href="../c_stp/c_stp.htm#XREF_92334__bridge_msti_slot/port_path_cost" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti path-cost</a> command and specify the MSTI ID for the instance number. For example, the following command configures the path cost value for port 1&#47;12 for MSTI 1&#x30; to 19&#x3A;</p><p class="example1" id="1079059">&#x2D;&#x3E; spantree msti 1&#x30; port 1&#47;12 path&#x2D;cost 19</p><p class="text" id="1117064">Note that configuring the port path cost value for a MSTI is allowed in both modes (per&#x2D;VLAN and flat) only when the Spanning Tree protocol is set to MSTP. </p><p class="heading3" id="1079065"><a id="XREF_97526__Path_Cost_for_Link_Aggregate_Ports159" name="XREF_97526__Path_Cost_for_Link_Aggregate_Ports159">Path Cost for </a><a id="index_1079064" name="index_1079064"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:link%20aggregate%20ports" id="Spanning_Tree_port_parameters_link_aggregate_ports" name="Spanning_Tree_port_parameters_link_aggregate_ports"></a><a data-indexterm="link%20aggregation:Spanning%20Tree%20parameters" id="link_aggregation_Spanning_Tree_parameters" name="link_aggregation_Spanning_Tree_parameters"></a>Link Aggregate Ports</p><p class="text" id="1079066">Physical ports that belong to a link aggregate do not participate in the Spanning Tree Algorithm. Instead, the algorithm is applied to the aggregate logical link (virtual port) that represents a collection of physical ports. Spanning Tree is automatically enabled on the aggregate logical link and the path cost value is set to the default value using the tables above. </p><p class="text" id="1079239">To change the path cost value for a link aggregate, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree cist path cost</span>, <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree msti path cost</span>, or <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree vlan path cost</span> command with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">linkagg</span> parameter and a link aggregate control (ID) number. For example, the following command sets the path cost for link aggregate 1&#x30; associated with VLAN 755 to 19&#x3A;</p><p class="example1" id="1079240">&#x2D;&#x3E; spantree vlan 755 linkagg 1&#x30; path&#x2D;cost 19</p><p class="text" id="1079243">For more information about configuring an aggregate of ports, see <a href="../n_omchnl/n_omchnl.htm#XREF_55650__1_Configuring_Link_Aggregation23" style="color:#0000ff;background-color:transparent;">Chapter&#160;9&#44; “Configuring Static Link Aggregation&#44;”</a> and <a href="../n_lacp/n_lacp.htm#XREF_55650__1_Configuring_Link_Aggregation27" style="color:#0000ff;background-color:transparent;">Chapter&#160;10&#44; “Configuring Dynamic Link Aggregation.”</a></p><p class="heading2" id="1079259"><a id="XREF_34280__Configuring_Port_Mode159" name="XREF_34280__Configuring_Port_Mode159">Configuring Port Mode</a></p><p class="text" id="1079261" style="margin-top : 4.00pt;"><a id="159_text_1079261" name="159_text_1079261"></a>There are two <a id="index_1079260" name="index_1079260"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:mode" id="Spanning_Tree_port_parameters_mode" name="Spanning_Tree_port_parameters_mode"></a>port modes supported&#x3A; manual and dynamic. Manual mode indicates that the port was set by the user to a forwarding or blocking state. The port operates in the state selected until the state is manually changed again or the port mode is changed to dynamic. Ports operating in a manual mode state do not participate in the Spanning Tree Algorithm. Dynamic mode indicates that the active Spanning Tree Algorithm determines <a id="index_1079262" name="index_1079262"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20states" id="Spanning_Tree_Algorithm_and_Protocol_port_states" name="Spanning_Tree_Algorithm_and_Protocol_port_states"></a>port state.</p><p class="text" id="1079263" style="margin-top : 4.00pt;">Spanning Tree is automatically enabled on the port and the port operates in the default mode. If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then the port mode applies to the specified VLAN instance associated with the port. If the switch is running in the flat Spanning Tree mode, then the port mode applies across all VLANs associated with the port. The flat mode instance is specified as the port instance, even if the port is associated with other VLANs. </p><p class="text" id="1079266">To change the port Spanning Tree mode for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_58185__bridge_1x1_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree loop-guard</a> command. For example, the following command sets the mode for port 8&#47;1 for VLAN 1&#x30; to forwarding.</p><p class="example1" id="1079268">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;1 mode forwarding</p><p class="text" id="1079277">To change the port Spanning Tree mode for the flat mode instance, use the <a href="../c_stp/c_stp.htm#XREF_38782__bridge_cist_slot/port_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist mode</a> command. Note that the command is available when the switch is running in either mode (per&#x2D;VLAN or flat) and an instance number is not required. For example, the following command configures the Spanning Tree mode on port 1&#47;24 for the flat mode instance&#x3A;</p><p class="example1" id="1111201">&#x2D;&#x3E; spantree cist port 1&#47;24 mode blocking</p><p class="heading3" id="1111203">Mode for <a id="index_1111202" name="index_1111202"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:link%20aggregate%20ports" id="Spanning_Tree_port_parameters_link_aggregate_ports" name="Spanning_Tree_port_parameters_link_aggregate_ports"></a><a data-indexterm="link%20aggregation:Spanning%20Tree%20parameters" id="link_aggregation_Spanning_Tree_parameters" name="link_aggregation_Spanning_Tree_parameters"></a>Link Aggregate Ports</p><p class="text" id="1079285">Physical ports that belong to a link aggregate do not participate in the Spanning Tree Algorithm. Instead, the algorithm is applied to the aggregate logical link (virtual port) that represents a collection of physical ports. </p><p class="text" id="1117092">To change the port mode for a link aggregate, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree vlan mode </span>or the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree cist mode </span>command described above, but specify a link aggregate control (ID) number instead of a slot and port. For example, the following command sets the port mode for link aggregate 1&#x30; associated with VLAN 755 to blocking&#x3A;</p><p class="example1" id="1079286">&#x2D;&#x3E; spantree vlan 755 linkagg 1&#x30; mode blocking</p><p class="text" id="1079289">For more information about configuring an aggregate of ports, see <a href="../n_omchnl/n_omchnl.htm#XREF_55650__1_Configuring_Link_Aggregation23" style="color:#0000ff;background-color:transparent;">Chapter&#160;9&#44; “Configuring Static Link Aggregation&#44;”</a> and <a href="../n_lacp/n_lacp.htm#XREF_55650__1_Configuring_Link_Aggregation27" style="color:#0000ff;background-color:transparent;">Chapter&#160;10&#44; “Configuring Dynamic Link Aggregation.”</a></p><p class="heading2" id="1079302"><a id="XREF_44674__Configuring_Port_Connection_Type159" name="XREF_44674__Configuring_Port_Connection_Type159">Configuring Port Connection Type</a></p><p class="text" id="1079305"><a id="159_text_1079305" name="159_text_1079305"></a>Specifying a <a id="index_1079303" name="index_1079303"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:connection%20type" id="Spanning_Tree_port_parameters_connection_type" name="Spanning_Tree_port_parameters_connection_type"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:port%20connection%20types" id="Spanning_Tree_Algorithm_and_Protocol_port_connection_types" name="Spanning_Tree_Algorithm_and_Protocol_port_connection_types"></a>port connection type is done when using the <a id="index_1079304" name="index_1079304"></a><a data-indexterm="rstp:port%20connection%20types" id="RSTP_port_connection_types" name="RSTP_port_connection_types"></a>Rapid Spanning Tree Algorithm and Protocol (RSTP), as defined in the IEEE 8&#x30;2.1w standard. RSTP transitions a port from a blocking state directly to forwarding, bypassing the listening and learning states, to provide a rapid reconfiguration of the Spanning Tree in the event of a path or root bridge failure. Rapid transition of a port state depends on the configurable connection type of the port. These types are defined as follows&#x3A;</p><p class="bullet" id="1079306"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Point&#x2D;to&#x2D;point LAN segment (port connects directly to another switch).</p><p class="bullet" id="1079307"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>No point&#x2D;to&#x2D;point shared media LAN segment (port connects to multiple switches).</p><p class="bullet" id="1117152"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Edge port (port is at the edge of a bridged LAN, does not receive BPDU and has only one MAC address learned). Edge ports, however, will operationally revert to a point to point or a no point to point connection type if a BPDU is received on the port. </p><p class="text" id="1117153">A port is considered connected to a point&#x2D;to&#x2D;point LAN segment if the port belongs to a link aggregate of ports, or if auto negotiation determines if the port must run in full duplex mode, or if full duplex mode was administratively set. Otherwise, that port is considered connected to a no point&#x2D;to&#x2D;point LAN segment.</p><p>Rapid transition of a designated port to forwarding can only occur if the port connection type is defined as a point to point or an edge port. Defining a port connection type as a point to point or as an edge port makes the port eligible for rapid transition, regardless of what actually connects to the port. However, an alternate port is always allowed to transition to the role of root port regardless of the alternate port connection type.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="86.00px"><td><p class="CellBody_note_text" id="1120307"><span class="Bold">Note.  </span><span style="font-kerning:none;">Configure ports that will connect to a host (PC, workstation, server, etc.) as edge ports so that these ports will transition directly to a forwarding state and not trigger an unwanted topology change when a device is connected to the port. If a port is configured as a point to point or no point to point connection type, the switch will assume a topology change when this port goes active and will flush and relearn all learned MAC addresses for the port&#x2019;s assigned VLAN. </span></p></td></tr></table></div></p><p class="text" id="1079314">If the switch is running in the per&#x2D;VLAN Spanning Tree mode, then the connection type applies to the specified VLAN instance associated with the port. If the switch is running in the flat Spanning Tree mode, then the connection type applies across all VLANs associated with the port. The flat mode instance is referenced as the port instance, even if the port is associated with other VLANs. </p><p class="text" id="1117145">By default, Spanning Tree is automatically enabled on the port, the connection type is set to auto point&#x2D;to&#x2D;point, and auto edge port detection is enabled. The auto point&#x2D;to&#x2D;point setting determines the connection type based on the operational status of the port. The auto edge port setting determines the operational edge port status for the port. </p><p class="text" id="1117171">The <a href="../c_stp/c_stp.htm#XREF_13508__bridge_1x1_slot/port_connection" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan connection</a> and <a href="../c_stp/c_stp.htm#XREF_97366__bridge_cist_slot/port_connection" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist connection</a> commands are used to configure the port connection type for a VLAN instance or the CIST instance. See <a  href="#XREF_64566__Configuring_the_Edge_Port_Status159" style="color:#0000ff;background-color:transparent;">Configuring the Edge Port Status</a> for information about configuring the auto edge port status for a port.</p><p class="text" id="1079317">To change the port connection type for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a id="index_1094816" name="index_1094816"></a><a data-indexterm="%3Cindex%3Ebridge%20slot/port%20connection%20%3Cdefault%20para%20font%3E%20command" id="%3Cindex%3Ebridge_slot/port_connection_%3Cdefault_para_font%3E_command" name="%3Cindex%3Ebridge_slot_port_connection_%3Cdefault_para_font%3E_command"></a><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree vlan connection</span> command. For example, the following command defines the connection type for port 8&#47;1 associated with VLAN 1&#x30;.</p><p class="example1" id="1079319">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;1 connection autoptp</p><p class="text" id="1079327">To change the port Spanning Tree mode for the flat mode instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree cist connection</span> command. For example, the following command configures the connection type for port 1&#47;24 for the flat mode instance&#x3A;</p><p class="example1" id="1079332">&#x2D;&#x3E; spantree cist port 1&#47;24 connection ptp</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120333"><span class="Bold">Note.  </span><span style="font-kerning:none;">The </span><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">spantree vlan connection</span><span style="font-kerning:none;"> and </span><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">spantree cist connection</span><span style="font-kerning:none;"> commands only configure one port at a time. </span></p></td></tr></table></div></p><p class="heading3" id="1079336">Connection Type on <a id="index_1079335" name="index_1079335"></a><a data-indexterm="Spanning%20Tree%20port%20parameters:link%20aggregate%20ports" id="Spanning_Tree_port_parameters_link_aggregate_ports" name="Spanning_Tree_port_parameters_link_aggregate_ports"></a><a data-indexterm="link%20aggregation:Spanning%20Tree%20parameters" id="link_aggregation_Spanning_Tree_parameters" name="link_aggregation_Spanning_Tree_parameters"></a>Link Aggregate Ports</p><p class="text" id="1113497">Physical ports that belong to a link aggregate do not participate in the Spanning Tree Algorithm. Instead, the algorithm is applied to the aggregate logical link (virtual port) that represents a collection of physical ports. To change the port connection type for a link aggregate, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">spantree vlan connection </span>or<span class="Times_Bold" style="font-weight:Bold;background-color:transparent;"> the spantree cist connection </span>command described above, but specify a link aggregate control (ID) number instead of a slot and port. For example, the following command defines the connection type for the link aggregate 1&#x30; association with VLAN 755&#x3A;</p><p class="example1" id="1113498">&#x2D;&#x3E; spantree vlan 755 linkagg 1&#x30; connection autoptp</p><p class="text" id="1113501">For more information about configuring an aggregate of ports, see <a href="../n_omchnl/n_omchnl.htm#XREF_55650__1_Configuring_Link_Aggregation23" style="color:#0000ff;background-color:transparent;">Chapter&#160;9&#44; “Configuring Static Link Aggregation&#44;”</a> and <a href="../n_lacp/n_lacp.htm#XREF_55650__1_Configuring_Link_Aggregation27" style="color:#0000ff;background-color:transparent;">Chapter&#160;10&#44; “Configuring Dynamic Link Aggregation.”</a></p><p class="heading2" id="1095923"><a id="XREF_64566__Configuring_the_Edge_Port_Status159" name="XREF_64566__Configuring_the_Edge_Port_Status159">Configuring the Edge Port Status</a></p><p class="text" id="1096362"><a id="159_text_1096362" name="159_text_1096362"></a>There are two methods for determining the edge port status for a port or link aggregate&#x3A; </p><p class="bullet" id="1117239"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Configuring the automatic edge (auto edge) port status. The status (enabled or disabled) of this Spanning Tree port parameter specifies whether or not the Spanning Tree automatically determines the operational edge port status for a port. This method is enabled by default.</p><p class="bullet" id="1117258"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Configuring the administrative edge (admin edge) port status. The status (enabled or disabled) of this Spanning Tree port parameter is used to determine the edge port status when the auto edge port status is disabled. This method is disabled by default.</p><p class="text" id="1117227">To configure the edge port status for the flat mode instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_22421__bridge_cist_slot/port_auto-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist auto-edge</a> command or the <a href="../c_stp/c_stp.htm#XREF_66602__bridge_cist_slot/port_admin-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist admin-edge</a> command. For example&#x3A;</p><p class="example1" id="1117306">&#x2D;&#x3E; spantree cist port 8&#47;23 auto&#x2D;edge enable</p><p class="example2" id="1117305">&#x2D;&#x3E; spantree cist port 8&#47;23 admin&#x2D;edge disable</p><p class="text" id="1117273">To configure the edge port status for a VLAN instance regardless of which mode (per&#x2D;VLAN or flat) is active for the switch, use the <a href="../c_stp/c_stp.htm#XREF_68621__bridge_1x1_slot/port_auto-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan auto-edge</a> command or the <a href="../c_stp/c_stp.htm#XREF_11133__bridge_1x1_slot/port_admin-edge" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan admin-edge</a> command. For example&#x3A;</p><p class="example1" id="1117328">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;23 auto&#x2D;edge enable</p><p class="example2" id="1117317">&#x2D;&#x3E; spantree vlan 1&#x30; port 8&#47;23 admin&#x2D;edge disable</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="22.00px"><td><p class="CellBody_note_text" id="1120369"><span class="Bold">Note.  </span><span style="font-kerning:none;">If </span><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">auto&#x2D;edge</span><span style="font-kerning:none;"> is enabled on a port, then the </span><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">admin&#x2D;edge</span><span style="font-kerning:none;"> value is overridden.</span></p></td></tr></table></div></p><p class="heading2" id="1097663">Restricting Port Roles (Root Guard)</p><p class="text" id="1097664">All ports are automatically eligible for root port selection. A port in a CIST&#47;MSTI instance or per&#x2D;VLAN instance can be prevented from becoming the root port by restricting the role of the port (also referred to as enabling root guard). This is done using the <a href="../c_stp/c_stp.htm#XREF_50004__bridge_cist_slot/port_restricted-role" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist restricted-role</a> command or the <a href="../c_stp/c_stp.htm#XREF_10118__bridge_1x1_slot/port_restricted-role" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan restricted-role</a> command regardless of which mode (per&#x2D;VLAN or flat) is active for the switch. For example&#x3A;</p><p class="example1" id="1117424">&#x2D;&#x3E; spantree cist port 1&#47;2 restricted&#x2D;role enable</p><p class="example2" id="1117425">&#x2D;&#x3E; spantree cist linkagg 1&#x30; restricted&#x2D;role enable</p><p class="example2" id="1104282">&#x2D;&#x3E; spantree vlan 1&#x30;&#x30; port 8&#47;1 restricted&#x2D;role enable</p><p class="example2" id="1117429">&#x2D;&#x3E; spantree vlan 2&#x30; linkagg 1 restricted&#x2D;role enable</p><p class="text" id="1104247">Note that the above commands also provide optional syntax; <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">restricted&#x2D;role</span> or <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">root&#x2D;guard</span>. For example, the following two commands perform the same function&#x3A;</p><p class="example1" id="1104263">&#x2D;&#x3E; spantree vlan port 2&#47;1 restricted&#x2D;role enable</p><p class="example2" id="1104283">&#x2D;&#x3E; spantree vlan port 2&#47;1 root&#x2D;guard enable</p><p class="text" id="1096710">When root guard is enabled for a port, it cannot become the root port, even if it is the most likely candidate for becoming the root port. However, this same port is designated as the alternate port when the root port is selected.</p><p class="text" id="1117354">Enabling the restricted role status is used by network administrators to prevent bridges external to the core region of the network from influencing the Spanning Tree topology. However, note that enabling the restricted role status for a port may impact connectivity within the network.</p><p class="heading2" id="1096663"><a id="XREF_96134__Restricting_TCN_Propagation159" name="XREF_96134__Restricting_TCN_Propagation159">Restricting TCN Propagation</a></p><p class="text" id="1097730"><a id="159_text_1097730" name="159_text_1097730"></a>All ports automatically propagate Topology Change Notifications (TCN) or Topology Changes (TC) to other ports. To restrict a port from propagating topology changes and notifications, use the <a href="../c_stp/c_stp.htm#XREF_73431__bridge_cist_slot/port_restricted-tcn" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist restricted-tcn</a> command or the <a href="../c_stp/c_stp.htm#XREF_45282__bridge_1x1_slot/port_restricted-tcn" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan restricted-tcn</a> command regardless of which mode (per&#x2D;VLAN or flat) is active for the switch. For example&#x3A;</p><p class="example1" id="1117405">&#x2D;&#x3E; spantree cist port 2&#47;2 restricted&#x2D;tcn enable</p><p class="example2" id="1117433">&#x2D;&#x3E; spantree cist linkagg 5 restricted&#x2D;tcn enable</p><p class="example2" id="1117406">&#x2D;&#x3E; spantree vlan 1&#x30; port 1&#47;5 restricted&#x2D;tcn enable</p><p class="example2" id="1117434">&#x2D;&#x3E; spantree vlan 2&#x30; linkagg 1 restricted&#x2D;tcn enable</p><p class="text" id="1117408">Enabling the restricted TCN status is used by network administrators to prevent bridges external to the core region of the network from causing unnecessary MAC address flushing in that region. However, note that enabling the restricted TCN status for a port may impact Spanning Tree connectivity.</p><p class="heading2" id="1096865">Limiting BPDU Transmission</p><p class="text" id="1096879">The number of BPDUs to be transmitted per port per second can be limited using the <span style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_44594__bridge_cist_txholdcount" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree cist txholdcount</a></span><span style="font-weight:Bold;">&#160;</span>command<span style="font-weight:Bold;">&#160;</span>for a CIST instance or the <span style="font-weight:Bold;"><a href="../c_stp/c_stp.htm#XREF_69949__bridge_1x1_txholdcount" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree vlan txholdcount</a></span><span style="font-weight:Bold;">&#160;</span>command for a per&#x2D;VLAN instance. Both of these commands apply to all ports and link aggregates and are supported when the switch is running in either the per&#x2D;VLAN mode or the flat mode. For example&#x3A; </p><p class="example1" id="1117451">&#x2D;&#x3E; spantree cist txholdcount 5</p><p class="example2" id="1117452">&#x2D;&#x3E; spantree vlan 1&#x30; txholdcount 5</p><p class="heading1" id="1093180"><a id="XREF_37212__RRSTP_Overview159" name="XREF_37212__RRSTP_Overview159"></a><a id="XREF_41864__Sample_Spanning_Tree_Configuration159" name="XREF_41864__Sample_Spanning_Tree_Configuration159">Sample </a><a id="index_1096383" name="index_1096383"></a><a data-indexterm="%3C$nopage%3ERing%20Rapid%20Spanning%20Tree%20Algorithm%20and%20Protocol:%3Csee%20also%3Esee%3Cdefault%20para%20font%3E%20RRSTP" id="%3C$nopage%3ERing_Rapid_Spanning_Tree_Algorithm_and_Protocol_%3Csee_also%3Esee%3Cdefault_para_font%3E_RRSTP" name="%3C$nopage%3ERing_Rapid_Spanning_Tree_Algorithm_and_Protocol_%3Csee_also%3Esee%3Cdefault_para_font%3E_RRSTP"></a><a id="index_1096384" name="index_1096384"></a><a data-indexterm="RRSTP" id="RRSTP" name="RRSTP"></a><a id="index_1091392" name="index_1091392"></a><a data-indexterm="Spanning%20Tree%20Algorithm%20and%20Protocol:application%20examples" id="Spanning_Tree_Algorithm_and_Protocol_application_examples" name="Spanning_Tree_Algorithm_and_Protocol_application_examples"></a><a data-indexterm="application%20examples:Spanning%20Tree%20Algorithm%20and%20Protocol" id="application_examples_Spanning_Tree_Algorithm_and_Protocol" name="application_examples_Spanning_Tree_Algorithm_and_Protocol"></a>Spanning Tree Configuration</p><p class="text" id="1070362">This section provides an example network configuration in which the Spanning Tree Algorithm and Protocol has calculated a loop&#x2D;free topology. In addition, a tutorial is also included that provides steps on how to configure the example network topology using the Command Line Interface (CLI).</p><p class="text" id="1079350">Note that the following example network configuration illustrates using switches operating in the per&#x2D;VLAN Spanning Tree mode and using RSTP (8&#x30;2.1w) to calculate a single data path between VLANs. See <a  href="#XREF_34979__MST_General_Overview159" style="color:#0000ff;background-color:transparent;">MST General Overview</a> for an overview and examples of using MSTP (8&#x30;2.1s).</p><p class="heading2" id="1070363">Example Network Overview</p><p class="text" id="1066883">The following diagram shows a four&#x2D;switch network configuration with an active Spanning Tree topology, which was calculated based on both configured and default Spanning Tree parameter values&#x3A;<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_55.svg" height="393.236267" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="581.016988"></object></p><p class="FigureTitle" id="1070192">Figure 6&#x2D;11 &#x3A;  <a id="XREF_28380__Example_Active_Spanning_Tree_Topology159" name="XREF_28380__Example_Active_Spanning_Tree_Topology159">Example Active Spanning Tree Topology</a></p><p class="text" id="1070645"><a id="159_text_1070645" name="159_text_1070645"></a>In the above example topology&#x3A; </p><p class="bullet" id="1070646"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Each switch is operating in the per&#x2D;VLAN Spanning Tree mode by default. </p><p class="bullet" id="1070649"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Each switch configuration has a VLAN 255 defined. The Spanning Tree administrative status for this VLAN was enabled by default when the VLAN was created. </p><p class="bullet" id="1070667"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLAN 255 on each switch is configured to use the 8&#x30;2.1w (rapid reconfiguration) Spanning Tree Algorithm and Protocol.</p><p class="bullet" id="1070470"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Ports 2&#47;1&#x2D;3, 2&#47;8&#x2D;1&#x30;, 3&#47;1&#x2D;3, and 3&#47;8&#x2D;1&#x30; provide connections to other switches and are all assigned to VLAN 255 on their respective switches. The Spanning Tree administrative status for each port is enabled by default.</p><p class="bullet" id="1070502"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The path cost for each port connection defaults to a value based on the link speed. For example, the connection between Switch B and Switch C is a 1&#x30;&#x30; Mbps link, which defaults to a path cost of 19.</p><p class="bullet" id="1070526"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLAN 255 on Switch D is configured with a Bridge ID priority value of 1&#x30;, which is less than the same value for VLAN 255 configured on the other switches. As a result, VLAN 255 was elected the Spanning Tree root bridge for the VLAN 255 broadcast domain. </p><p class="bullet" id="1070685"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>A root port is identified for VLAN 255 on each switch, except the root VLAN 255 switch. The root port identifies the port that provides the best path to the root VLAN. </p><p class="bullet" id="1070525"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>VLAN 255 on Switch A was elected the designated bridge because it offers the best path cost for Switch B to the root VLAN 255 on Switch D.</p><p class="bullet" id="1070696"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Port 2&#47;9 on Switch A is the designated port for the Switch A to Switch B connection because Switch A is the designated bridge for Switch B.</p><p class="bullet" id="1070605"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Redundant connections exist between Switch D and Switch C. Ports 2&#47;2 and 3&#47;9 are in a discarding (blocking) state because this connection has a higher path cost than the connection provided through ports 2&#47;3 and 3&#47;8. As a result, a network loop condition is avoided.</p><p class="bullet" id="1075154"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>Redundant connections also exist between Switch A and Switch B. Although the path cost value for both of these connections is the same, ports 2&#47;8 and 3&#47;3 are in a discarding state because their port priority values (not shown) are higher than the same values for ports 2&#47;1&#x30; and 3&#47;1. </p><p class="bullet" id="1070533"><span class="Bullet_Character">&#x2022;&#160;&#160;&#160; </span>The ports that provide the connection between Switch B and Switch C are in a discarding (blocking) state, because this connection has a higher path cost than the other connections leading to the root VLAN 255 on Switch D. As a result, a network loop is avoided. </p><p class="heading2" id="1070194"><a id="XREF_59540__Example_Network_Configuration_Steps159" name="XREF_59540__Example_Network_Configuration_Steps159">Example Network Configuration Steps</a></p><p class="text" id="1070507"><a id="159_text_1070507" name="159_text_1070507"></a>The following steps provide a quick tutorial that configures the active Spanning Tree network topology shown in the diagram on <a  href="#XREF_28380__Example_Active_Spanning_Tree_Topology159" style="color:#0000ff;background-color:transparent;">page 6-43</a>. </p><p class="step_first" id="1070195"><span class="Futura_Bold">1&#160;&#160;&#160; </span>Create VLAN 255 on Switches A, B, C, and D with &#x201c;Marketing IP Network&#x201d; for the VLAN description on each switch using the following command&#x3A;</p><p class="example1" id="1070564">&#x2D;&#x3E; vlan 255 name &quot;Marketing IP Network&quot;</p><p class="step_next" id="1070198"><span class="Futura_Bold">2&#160;&#160;&#160; </span>Assign the switch ports that provide connections between each switch to VLAN 255. For example, the following commands entered on Switches A, B, C, and D, respectively, assign the ports shown in the example network diagram on <a  href="#XREF_28380__Example_Active_Spanning_Tree_Topology159" style="color:#0000ff;background-color:transparent;">page 6-43</a> to VLAN 255&#x3A;</p><p class="example1" id="1117483">&#x2D;&#x3E; vlan 255 members port 2&#47;8&#x2D;1&#x30; untagged</p><p class="example2" id="1117477">&#x2D;&#x3E; vlan 255 members port 3&#47;1&#x2D;3 untagged</p><p class="example2" id="1117478">&#x2D;&#x3E; vlan 255 members port 3&#47;8&#x2D;1&#x30; untagged</p><p class="example2" id="1117479">&#x2D;&#x3E; vlan 255 members port 2&#47;1&#x2D;3&#160;&#160;&#160; untagged</p><p class="step_next" id="1070697"><span class="Futura_Bold">3&#160;&#160;&#160; </span>Change the Spanning Tree protocol for VLAN 255 to RSTP (Rapid Spanning Tree Protocol) on each switch using the following command&#x3A;</p><p class="example1" id="1070199">&#x2D;&#x3E; spantree vlan 255 protocol rstp</p><p class="step_next" id="1070200"><span class="Futura_Bold">4&#160;&#160;&#160; </span>Change the bridge priority value for VLAN 255 on Switch D to <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">1&#x30; </span>using the following command (leave the priority for VLAN 255 on the other three switches set to the default value)&#x3A;</p><p class="example1" id="1070201">&#x2D;&#x3E; spantree vlan 255 priority 1&#x30;</p><p class="text" id="1071130">VLAN 255 on Switch D has the lowest Bridge ID priority value of all four switches, which qualifies it as the Spanning Tree root VLAN for the VLAN 255 broadcast domain.</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="633.33px"><td><p class="CellBody_note_text" id="1120420" style="font-kerning:none;"><span class="Bold">Note.  </span>To verify the VLAN 255 Spanning Tree configuration on each switch use the following <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show</span> commands. The following outputs are for example purposes only and not match values shown in the sample network configuration&#x3A;</p><p class="screen" id="1120456"><br/></p><p class="screen2" id="1124384">&#x2D;&#x3E; show spantree vlan 255</p><p class="screen2" id="1124043">Spanning Tree Parameters for Vlan 255</p><p class="screen2" id="1124044">  Spanning Tree Status &#x3A;                   ON,</p><p class="screen2" id="1124045">  Protocol             &#x3A;       IEEE Rapid STP,</p><p class="screen2" id="1124046">  mode                 &#x3A; Per VLAN (1 STP per Vlan),</p><p class="screen2" id="1124047">  Priority             &#x3A;       32768 (&#x30;x8&#x30;&#x30;&#x30;),</p><p class="screen2" id="1124048">  Bridge ID            &#x3A;   8&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;e&#x30;&#x3A;b1&#x3A;e7&#x3A;&#x30;9&#x3A;a3,</p><p class="screen2" id="1124113">  Designated Root      &#x3A;   8&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;e&#x30;&#x3A;b1&#x3A;e7&#x3A;&#x30;9&#x3A;a3,</p><p class="screen2" id="1124114">  Cost to Root Bridge  &#x3A;                    8,</p><p class="screen2" id="1124115">  Root Port            &#x3A;               1&#47;1&#47;48,</p><p class="screen2" id="1124052">  TxHoldCount          &#x3A;                    3,</p><p class="screen2" id="1124053">  Topology Changes     &#x3A;                  1&#x30;1,</p><p class="screen2" id="1124054">  Topology age         &#x3A;             &#x30;1&#x3A;&#x30;5&#x3A;3&#x30;,</p><p class="screen2" id="1124055">  Topology Change Port &#x3A;               1&#47;1&#47;48,</p><p class="screen2" id="1124056">    Current Parameters (seconds)</p><p class="screen2" id="1124057">      Max Age              &#x3D;    2&#x30;,</p><p class="screen2" id="1124058">      Forward Delay        &#x3D;    15,</p><p class="screen2" id="1124059">      Hello Time           &#x3D;     2</p><p class="screen2" id="1124060">    Parameters system uses when attempting to become root</p><p class="screen2" id="1124061">      System Max Age       &#x3D;    2&#x30;,</p><p class="screen2" id="1124062">      System Forward Delay &#x3D;    15,</p><p class="screen2" id="1124267">      System Hello Time    &#x3D;     2</p><p class="screen" id="1124268"><br/></p><p class="screen2" id="1124393">&#x2D;&#x3E; show spantree vlan 255 ports</p><p class="screen2" id="1124394">Spanning Tree Port Summary for Vlan 1</p><p class="screen2" id="1124395">        Oper  Path   Desig      Prim. Op  Op  Loop</p><p class="screen2" id="1124396">Port     St   Cost    Cost Role Port  Cnx Edg Guard Desig Bridge ID        Note</p><p class="screen2" id="1124397">&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;+&#x2D;&#x2D;&#x2D;&#x2D;&#x2D;</p><p class="screen2" id="1124398">  1&#47;1&#47;1 FORW     1&#x30;&#x30;     8 DESG 1&#47;1&#47;1 PTP  NO  DIS  8&#x30;&#x30;&#x30;&#x2D;e8&#x3A;e7&#x3A;32&#x3A;a4&#x3A;63&#x3A;21</p><p class="screen2" id="1124399">  1&#47;1&#47;2  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;2  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124400">  1&#47;1&#47;4  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;4  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124401">  1&#47;1&#47;5  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;5  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124402">  1&#47;1&#47;6  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;6  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124403">  1&#47;1&#47;7  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;7  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124404">  1&#47;1&#47;8  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;8  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124405">  1&#47;1&#47;9  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;9  NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p><p class="screen2" id="1124387"> 1&#47;1&#47;12  DIS       &#x30;     &#x30;  DIS 1&#47;1&#47;12 NS  NO  DIS  &#x30;&#x30;&#x30;&#x30;&#x2D;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;&#x3A;&#x30;&#x30;</p></td></tr></table></div></p><p class="heading1" id="1116247"><a id="XREF_71371__Sample_MST_Region_Configuration159" name="XREF_71371__Sample_MST_Region_Configuration159">Sample MST Region Configuration</a></p><p>An MST region identifies a group of MSTP switches that is seen as a single, flat mode instance by other regions and&#47;or non&#x2D;MSTP switches. A region is defined by three attributes&#x3A; name, revision level, and a VLAN&#x2D;to&#x2D;MSTI mapping. Switches configured with the same value for all three of these attributes belong to the same MST region.<div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1120497"><a id="159_CellBody_note_text_1120497" name="159_CellBody_note_text_1120497"></a><span class="Bold">Note.  </span><span style="font-kerning:none;">An additional configurable MST region parameter defines the maximum number of hops authorized for the region but is not considered when determining regional membership.The maximum hops value is the value used by all bridges within the region when the bridge is acting as the root of the MST region.</span></p></td></tr></table></div></p><p class="text" id="1120506">This section provides a tutorial for defining a sample MST region configuration, as shown in the diagram below&#x3A;<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_60.svg" height="321.664530" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="611.569906"></object></p><p class="FigureTitle" id="1129544">Figure 6&#x2D;12 &#x3A;  Sample MST Region Configuration</p><p class="text" id="1116284">In order for switches A, B, and C in the above diagram to belong to the same MST region, they must all share the same values for region name, revision level, and configuration digest (VLAN&#x2D;to&#x2D;MSTI mapping). </p><p class="text" id="1116288">The following steps are performed on each switch to define <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">ALE Marketing</span> as the MST region name, <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">2&#x30;&#x30;&#x30;</span> as the MST region revision level, map exiting VLANs to existing MSTIs, and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">3</span> as the maximum hops value for the region&#x3A;</p><p class="step_first" id="1116292"><span class="Futura_Bold">1&#160;&#160;&#160; </span>Configure an MST Region name using the <a href="../c_stp/c_stp.htm#XREF_97745__bridge_mst_region_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region name</a> command. For example&#x3A;</p><p class="example1" id="1116293">&#x2D;&#x3E; spantree mst region name &#x201c;ALE Marketing&#x201d;</p><p class="step_next" id="1116297"><span class="Futura_Bold">2&#160;&#160;&#160; </span>Configure the MST Region revision level using the <a href="../c_stp/c_stp.htm#XREF_44131__bridge_mst_region_revision_level" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region revision-level</a> command. For example&#x3A;</p><p class="example1" id="1116298">&#x2D;&#x3E; spantree mst region revision&#x2D;level 2&#x30;&#x30;&#x30;</p><p class="step_next" id="1116301"><span class="Futura_Bold">3&#160;&#160;&#160; </span>Map VLANs 1&#x30;&#x30; and 2&#x30;&#x30; to MSTI 2 and VLANs 3&#x30;&#x30; and 4&#x30;&#x30; to MSTI 4 using the <a href="../c_stp/c_stp.htm#XREF_38500__bridge_msti_vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti vlan</a> command to define the configuration digest. For example&#x3A;</p><p class="example1" id="1116303">&#x2D;&#x3E; spantree msti 2 vlan 1&#x30;&#x30; 2&#x30;&#x30;</p><p class="example2" id="1120559">&#x2D;&#x3E; spantree msti 4 vlan 3&#x30;&#x30; 4&#x30;&#x30;</p><p class="indented1" id="1116307">See the <a  href="#XREF_35880__Sample_MSTI_Configuration159" style="color:#0000ff;background-color:transparent;">Sample MSTI Configuration</a> for a tutorial on how to create and map MSTIs to VLANs.</p><p class="step_next" id="1116311"><span class="Futura_Bold">4&#160;&#160;&#160; </span>Configure <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">3</span> as the maximum number of hops for the region using the <a href="../c_stp/c_stp.htm#XREF_62399__bridge_mst_region_max_hops" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mst region max-hops</a> command. For example&#x3A;</p><p class="example1" id="1116312">&#x2D;&#x3E; spantree mst region max&#x2D;hops 3</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="207.33px"><td><p class="CellBody_note_text" id="1120565" style="font-kerning:none;"><span class="Bold">Note.  </span>(<span class="Times_italics" style="font-style:Italic;background-color:transparent;">Optional</span>) Verify the MST region configuration on each switch with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;"><a href="../c_stp/c_stp.htm#XREF_96168__show_spantree_mst_region" style="font-weight:Bold;color:#0000ff;background-color:transparent;">show spantree mst</a></span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">&#160;</span>command. For example&#x3A;</p><p class="screen2" id="1120587"><br/></p><p class="example1" id="1120597">&#x2D;&#x3E; show spantree mst region</p><p class="example2" id="1120631">Configuration Name       &#x3D; ALE Marketing,</p><p class="example2" id="1120634">Revision Level           &#x3D; 2&#x30;&#x30;&#x30;,</p><p class="example2" id="1120637">Configuration Digest     &#x3D; &#x30;x922fb3f 31752d68 67fe1155 d&#x30;ce838&#x30;,</p><p class="example2" id="1120640">Revision Max hops        &#x3D; 3,</p><p class="example2" id="1120643">Cist Instance Number &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160; &#x3D; &#x30; </p><p class="screen2" id="1120593"><br/></p><p class="CellBody_note_text" id="1120608">All switches configured with the exact same values as shown in the above example are considered members of the ALE Marketing MST region.</p></td></tr></table></div></p><p class="heading1" id="1116325"><a id="XREF_35880__Sample_MSTI_Configuration159" name="XREF_35880__Sample_MSTI_Configuration159">Sample MSTI Configuration</a></p><p class="text" id="1116326"><a id="159_text_1116326" name="159_text_1116326"></a>By default, the Spanning Tree software is active on all switches and operating in the per&#x2D;VLAN mode using 8&#x30;2.1w RSTP. A loop&#x2D;free network topology is automatically calculated based on default 8&#x30;2.1w RSTP switch, bridge, and port parameter values. </p><p class="text" id="1116327">Using Multiple Spanning Tree (MST) requires configuration changes to the default Spanning Tree values (mode and protocol) as well as defining specific MSTP parameters and instances. </p><p class="text" id="1116328">The following steps provide a tutorial for setting up a sample MSTP configuration, as shown in the diagram below&#x3A; <object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_66.svg" height="255.664307" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="579.570231"></object></p><p class="FigureTitle" id="1116412">Figure 6&#x2D;13 &#x3A;  <a id="XREF_34739__Flat_Mode_MSTP_(802_1S)159" name="XREF_34739__Flat_Mode_MSTP_(802_1S)159">Flat Mode MSTP Quick Steps Example</a></p><p class="step_first" id="1116413"><a id="159_step_first_1116413" name="159_step_first_1116413"></a><span class="Futura_Bold">1&#160;&#160;&#160; </span>Change the Spanning Tree operating mode, if necessary, on Switch A and Switch B from per&#x2D;VLAN to flat mode using the <a href="../c_stp/c_stp.htm#XREF_43473__bridge_mode" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree mode</a> command. For example&#x3A;</p><p class="example1" id="1116417">&#x2D;&#x3E; spantree mode flat</p><p class="indented1" id="1116418">Note that defining an MSTP configuration requires the use of explicit Spanning Tree commands, which are available in both the flat and per&#x2D;VLAN mode. As a result, this step is optional. See <a  href="#XREF_10950__Configuring_STP_VLAN_Parameters159" style="color:#0000ff;background-color:transparent;">Using Spanning Tree Configuration Commands</a> for more information.</p><p class="step_next" id="1116425"><span class="Futura_Bold">2&#160;&#160;&#160; </span>Change the Spanning Tree protocol to MSTP using the <a href="../c_stp/c_stp.htm#XREF_54053__bridge_protocol" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree protocol</a> command. For example&#x3A; </p><p class="example1" id="1116426">&#x2D;&#x3E; spantree protocol mstp</p><p class="step_next" id="1116430"><span class="Futura_Bold">3&#160;&#160;&#160; </span>Create VLANs 1&#x30;&#x30;, 2&#x30;&#x30;, 3&#x30;&#x30;, and 4&#x30;&#x30; using the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command. For example&#x3A;</p><p class="example1" id="1117470">&#x2D;&#x3E; vlan 1&#x30;&#x30;</p><p class="example2" id="1117464">&#x2D;&#x3E; vlan 15&#x30;</p><p class="example2" id="1117465">&#x2D;&#x3E; vlan 2&#x30;&#x30;</p><p class="example2" id="1117466">&#x2D;&#x3E; vlan 25&#x30;</p><p class="step_next" id="1116435"><span class="Futura_Bold">4&#160;&#160;&#160; </span>Assign switch ports to VLANs, as shown in the above diagram, using the <a href="../c_vlans/c_vlans.htm#XREF_82176__vlan_port_default" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> command. For example, the following commands assign ports 3&#47;1, 4&#47;2, 4&#47;8, and 2&#47;12 to VLANs 1&#x30;&#x30;, 15&#x30;, 2&#x30;&#x30;, and 25&#x30; on Switch A&#x3A;</p><p class="example1" id="1116436">&#x2D;&#x3E; vlan 1&#x30;&#x30; members port 3&#47;1 untagged</p><p class="example2" id="1120656">&#x2D;&#x3E; vlan 15&#x30; members port 4&#47;2 untagged</p><p class="example2" id="1120659">&#x2D;&#x3E; vlan 2&#x30;&#x30; members port 4&#47;8 untagged</p><p class="example2" id="1120662">&#x2D;&#x3E; vlan 25&#x30; members port 2&#47;12 untagged</p><p class="indented1" id="1116437">The following commands assign ports 2&#47;1, 5&#47;1, 5&#47;2, and 3&#47;6 to VLANs 1&#x30;&#x30;, 15&#x30;, 2&#x30;&#x30;, and 25&#x30; on Switch B&#x3A;</p><p class="example1" id="1117476">&#x2D;&#x3E; vlan 1&#x30;&#x30; members port 2&#47;1 untagged</p><p class="example2" id="1117459">&#x2D;&#x3E; vlan 15&#x30; members port 5&#47;1 untagged</p><p class="example2" id="1117458">&#x2D;&#x3E; vlan 2&#x30;&#x30; members port 5&#47;2 untagged</p><p class="example2" id="1117457">&#x2D;&#x3E; vlan 25&#x30; members port 3&#47;6 untagged</p><p class="step_next" id="1116442"><span class="Futura_Bold">5&#160;&#160;&#160; </span>Create one MSTI using the <a href="../c_stp/c_stp.htm#XREF_25471__bridge_msti" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti</a> command. For example&#x3A;</p><p class="example1" id="1116443">&#x2D;&#x3E; spantree msti 1</p><p class="step_next" id="1116444"><span class="Futura_Bold">6&#160;&#160;&#160; </span>Assign VLANs 2&#x30;&#x30; and 25&#x30; to MSTI 1. For example&#x3A;</p><p class="example1" id="1116445">&#x2D;&#x3E; spantree msti 1 vlan 1&#x30;&#x30; 2&#x30;&#x30;</p><p class="indented1" id="1116446">All VLANs are associated with the CIST instance. As a result, VLANs 1&#x30;&#x30; and 15&#x30; do not require any configuration to map them to the CIST instance.</p><p class="step_next" id="1116447"><span class="Futura_Bold">7&#160;&#160;&#160; </span>Configure the port path cost (PPC) for all ports on both switches associated with MSTI 1 to a PPC value that is lower than the PPC value for the ports associated with the CIST instance using the <a href="../c_stp/c_stp.htm#XREF_92334__bridge_msti_slot/port_path_cost" style="font-weight:Bold;color:#0000ff;background-color:transparent;">spantree msti path-cost</a> command. For example, the PPC for ports associated with the CIST instance is set to the default of 2&#x30;&#x30;,&#x30;&#x30;&#x30; for 1&#x30;&#x30; MB connections. The following commands change the PPC value for ports associated with the MSTI 1 to 2&#x30;,&#x30;&#x30;&#x30;&#x3A;</p><p class="example1" id="1116582">&#x2D;&#x3E; spantree msti 1 port 4&#47;8 path&#x2D;cost 2&#x30;&#x30;&#x30;&#x30;</p><p class="example2" id="1116573">&#x2D;&#x3E; spantree msti 1 port 2&#47;12 path&#x2D;cost 2&#x30;&#x30;&#x30;&#x30;</p><p class="example2" id="1116574">&#x2D;&#x3E; spantree msti 1 port 5&#47;2 path&#x2D;cost 2&#x30;&#x30;&#x30;&#x30;</p><p class="example2" id="1116575">&#x2D;&#x3E; spantree msti 1 port 3&#47;6 path&#x2D;cost 2&#x30;&#x30;&#x30;&#x30;</p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="54.00px"><td><p class="CellBody_note_text" id="1120678"><span class="Bold">Note.  </span><span style="font-kerning:none;">In this example, port connections between VLANs 15&#x30;, 2&#x30;&#x30;, and 25&#x30; are blocked on each switch initially, as shown in the diagram on <a  href="#XREF_34739__Flat_Mode_MSTP_(802_1S)159" style="font-kerning:none;color:#0000ff;background-color:transparent;">page 6-48</a></span><span style="font-kerning:none;">. This is because in flat mode MSTP, each instance is active on all ports resulting in a comparison of connections independent of VLAN and MSTI associations. </span></p></td></tr></table></div></p><p class="text" id="1116457">To avoid this and allow VLAN traffic to flow over separate data paths based on MSTI association, Step 7 of this tutorial configures a superior port path cost value for ports associated with MSTI 1. As a result, MSTI 1 selects one of the data paths between its VLANs as the best path, rather than the CIST data paths, as shown in the diagram on <a  href="#XREF_72195__Flat_Mode_MSTP_(802_1S)_with_Superior_MSTI_1_PPC_Values159" style="color:#0000ff;background-color:transparent;">page 6-50</a>.</p><p class="text" id="1116583">.<object class="imageSettings" data="../assets/os8_nt_-_Web_6-Configuring_Spanning_Tree_Parameters_FOM_SVG_67.svg" height="262.664327" style="max-width: 100% ;height: auto;display:block;margin:auto;" type="image/svg+xml" width="579.570231"></object></p><p class="FigureTitle" id="1116544">Figure 6&#x2D;14 &#x3A;  <a id="XREF_72195__Flat_Mode_MSTP_(802_1S)_with_Superior_MSTI_1_PPC_Values159" name="XREF_72195__Flat_Mode_MSTP_(802_1S)_with_Superior_MSTI_1_PPC_Values159">Flat Mode MSTP with Superior MSTI 1 PPC Values</a></p><p><div align="left"><table class="Note" style="max-width: 100% ;height: auto;"><col width="600.00px"/><tr height="38.00px"><td><p class="CellBody_note_text" id="1120786"><a id="159_CellBody_note_text_1120786" name="159_CellBody_note_text_1120786"></a><span class="Bold">Note.  </span><span style="font-kerning:none;">Of the two data paths available to MSTI 1 VLANs, one is blocked because it is seen as redundant for that instance. In addition, the CIST data path remains available for CIST VLAN traffic.</span></p></td></tr></table></div></p><p class="text" id="1116547">Another solution to this scenario is to assign all VLANs to an MSTI, leaving no VLANs controlled by the CIST. As a result, the CIST BPDU contains only MSTI information. See <a  href="#XREF_19680__How_MSTP_Works159" style="color:#0000ff;background-color:transparent;">How MSTP Works</a> for more information. </p><p class="heading1" id="1091316">Verifying the Spanning Tree Configuration</p><p>To display information about the Spanning Tree configuration on the switch, use the show commands listed below&#x3A;<div align="left"><table class="Related_Cmds" style="max-width: 100% ;height: auto;"><col width="192.00px"/><col width="408.00px"/><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116637"><a href="../c_stp/c_stp.htm#XREF_83306__show_cist_spantree" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree cist</a></p></td><td><p class="CellBody" id="1116639">Displays the Spanning Tree bridge configuration for the flat mode Common and Internal Spanning Tree (CIST) instance.</p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116630"><a href="../c_stp/c_stp.htm#XREF_31294__show_spantree_msti" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree msti</a></p></td><td><p class="CellBody" id="1116632">Displays Spanning Tree bridge information for a Multiple Spanning Tree Instance (MSTI).</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1116652"><a href="../c_stp/c_stp.htm#XREF_14478__show_spantree_1x1" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree vlan</a></p></td><td><p class="CellBody" id="1116654">Displays the Spanning Tree bridge information for a VLAN instance.</p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116623"><a href="../c_stp/c_stp.htm#XREF_98370__show_spantree_cist_ports" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree cist ports</a></p></td><td><p class="CellBody" id="1116625">Displays Spanning Tree port information for the flat mode Common and Internal Spanning Tree (CIST) instance.</p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116616"><a href="../c_stp/c_stp.htm#XREF_56954__show_spantree_msti_ports" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree msti ports</a></p></td><td><p class="CellBody" id="1116618">Displays Spanning Tree port information for a flat mode Multiple Spanning Tree Instance (MSTI).</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1116663"><a href="../c_stp/c_stp.htm#XREF_25065__show_spantree_1x1_ports" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree vlan ports</a></p></td><td><p class="CellBody" id="1116665">Displays Spanning Tree port information for a VLAN instance.</p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116609"><a href="../c_stp/c_stp.htm#XREF_96168__show_spantree_mst_region" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree mst</a></p></td><td><p class="CellBody" id="1116611">&#160;Displays the Multiple Spanning Tree (MST) information for a MST region or the specified port or link aggregate on the switch.</p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116602"><a href="../c_stp/c_stp.htm#XREF_68437__show_spantree_cist_vlan-map" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree cist vlan-map</a></p></td><td><p class="CellBody" id="1116604">Displays the range of VLANs associated with the flat mode Common and Internal Spanning Tree (CIST) instance. </p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116595"><a href="../c_stp/c_stp.htm#XREF_51802__show_spantree_msti_vlan-map" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree msti vlan-map</a></p></td><td><p class="CellBody" id="1116597">Displays the range of VLANs associated with the specified Multiple Spanning Tree Instance (MSTI). </p></td></tr><tr height="38.00px"><td><p class="CellBody_cli_cmd" id="1116588"><a href="../c_stp/c_stp.htm#XREF_99750__show_spantree_map-msti" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree map-msti</a></p></td><td><p class="CellBody" id="1116590">Displays the Multiple Spanning Tree Instance (MSTI) that is associated to the specified VLAN. </p></td></tr><tr height="54.00px"><td><p class="CellBody_cli_cmd" id="1116683"><a href="../c_stp/c_stp.htm#XREF_68908__show_spantree_mode" style="font-kerning:none;color:#0000ff;background-color:transparent;">show spantree mode</a></p></td><td><p class="CellBody" id="1116685">Displays the current global Spanning Tree mode parameter values for the switch, such as the current running mode (per&#x2D;VLAN or flat) for the switch</p></td></tr></table></div></p><p class="text" id="1059019">For more information about the resulting displays from these commands, see the <span class="Times_italics" style="font-style:Italic;background-color:transparent;"><span data-keyref="CLI Reference Guide">OmniSwitch AOS Release 8 CLI Reference Guide</span></span>. An example of the output for the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show spantree vlan </span>and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show spantree vlan ports</span> commands is also given in <a  href="#XREF_59540__Example_Network_Configuration_Steps159" style="color:#0000ff;background-color:transparent;">Example Network Configuration Steps</a>.</p></div>
</body>
</html>